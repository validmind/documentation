<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ValidMind – library_intro_demos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../validmind.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../guide/ValidMind-logo-color.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../guide/overview.html" class="sidebar-item-text sidebar-link">Overview</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../guide/getstarted.html" class="sidebar-item-text sidebar-link">Get started</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/getstarteddeveloper.html" class="sidebar-item-text sidebar-link">As a developer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/getstartedvalidator.html" class="sidebar-item-text sidebar-link">As a validator</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/guide.html" class="sidebar-item-text sidebar-link">Guide</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../guide/reference.html" class="sidebar-item-text sidebar-link">Reference</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../guide/jupyternotebooks.html" class="sidebar-item-text sidebar-link">Jupyter notebooks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/intro.html" class="sidebar-item-text sidebar-link">Environment Preparation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/lending_club_regression.html" class="sidebar-item-text sidebar-link">Environment Preparation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/lending_club.html" class="sidebar-item-text sidebar-link">Lending club</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/send_custom_metrics.html" class="sidebar-item-text sidebar-link">Send Custom Metrics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/explore_x_train_lc.html" class="sidebar-item-text sidebar-link">Send results to ValidMind</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/test_plan_summmary.html" class="sidebar-item-text sidebar-link">Test Plan Summmary</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/library_intro_demos.html" class="sidebar-item-text sidebar-link active">ValidMind Python Client Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/log_image.html" class="sidebar-item-text sidebar-link">ValidMind SDK Introduction</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../guide/developerframework.html" class="sidebar-item-text sidebar-link">Developer framework</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../validmind/api.html" class="sidebar-item-text sidebar-link">Python Library API</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../validmind/data_validation_tests.html" class="sidebar-item-text sidebar-link">Core Library Tests</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../validmind/model_validation_tests_sklearn.html" class="sidebar-item-text sidebar-link">Core Library Tests</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../validmind/test_plans.html" class="sidebar-item-text sidebar-link">Test Plans</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../validmind/vm_models.html" class="sidebar-item-text sidebar-link">ValidMind Models</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/support.html" class="sidebar-item-text sidebar-link">Support</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/glossary.html" class="sidebar-item-text sidebar-link">Glossary</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guide/releasenotes.html" class="sidebar-item-text sidebar-link">Release notes</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#validmind-python-client-introduction" id="toc-validmind-python-client-introduction" class="nav-link active" data-scroll-target="#validmind-python-client-introduction">ValidMind Python Client Introduction</a>
  <ul class="collapse">
  <li><a href="#notebook-requirements" id="toc-notebook-requirements" class="nav-link" data-scroll-target="#notebook-requirements">Notebook Requirements</a></li>
  <li><a href="#installing-the-client-library" id="toc-installing-the-client-library" class="nav-link" data-scroll-target="#installing-the-client-library">Installing the client library</a></li>
  </ul></li>
  <li><a href="#creating-a-new-project" id="toc-creating-a-new-project" class="nav-link" data-scroll-target="#creating-a-new-project">Creating a new project</a>
  <ul class="collapse">
  <li><a href="#initializing-the-client-library" id="toc-initializing-the-client-library" class="nav-link" data-scroll-target="#initializing-the-client-library">Initializing the client library</a></li>
  </ul></li>
  <li><a href="#validmind-client-library-functions" id="toc-validmind-client-library-functions" class="nav-link" data-scroll-target="#validmind-client-library-functions">ValidMind Client Library Functions</a>
  <ul class="collapse">
  <li><a href="#log_metadata" id="toc-log_metadata" class="nav-link" data-scroll-target="#log_metadata"><code>log_metadata</code></a></li>
  <li><a href="#analyze_dataset" id="toc-analyze_dataset" class="nav-link" data-scroll-target="#analyze_dataset"><code>analyze_dataset</code></a></li>
  <li><a href="#evaluate_model" id="toc-evaluate_model" class="nav-link" data-scroll-target="#evaluate_model"><code>evaluate_model</code></a></li>
  </ul></li>
  <li><a href="#training-an-example-model" id="toc-training-an-example-model" class="nav-link" data-scroll-target="#training-an-example-model">Training an Example Model</a>
  <ul class="collapse">
  <li><a href="#log_metadata-1" id="toc-log_metadata-1" class="nav-link" data-scroll-target="#log_metadata-1">log_metadata</a></li>
  <li><a href="#analyze_dataset-1" id="toc-analyze_dataset-1" class="nav-link" data-scroll-target="#analyze_dataset-1"><code>analyze_dataset</code></a></li>
  <li><a href="#preparing-the-training-dataset" id="toc-preparing-the-training-dataset" class="nav-link" data-scroll-target="#preparing-the-training-dataset">Preparing the training dataset</a></li>
  <li><a href="#evaluate_model-1" id="toc-evaluate_model-1" class="nav-link" data-scroll-target="#evaluate_model-1"><code>evaluate_model</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="validmind-python-client-introduction" class="level2">
<h2 class="anchored" data-anchor-id="validmind-python-client-introduction">ValidMind Python Client Introduction</h2>
<p>The ValidMind Python client allows model developers and validators to automatically document different aspects of the model development lifecycle.</p>
<p>For modelers, the client provides the following high level features:</p>
<ul>
<li>Log qualitative data about the model’s conceptual soundness</li>
<li>Log information about datasets and models</li>
<li>Log training and evaluation metrics about datasets and models</li>
<li>Run data quality checks</li>
<li>Run model evaluation tests</li>
</ul>
<p>For validators, the client also provides (TBD) the ability to effectively challenge the model’s performance according to its objective, use case and specific project’s requirements.</p>
<section id="notebook-requirements" class="level3">
<h3 class="anchored" data-anchor-id="notebook-requirements">Notebook Requirements</h3>
<ul>
<li>This notebook and the ValidMind client must be executed on an environment running Python &gt;= 3.8.</li>
</ul>
</section>
<section id="installing-the-client-library" class="level3">
<h3 class="anchored" data-anchor-id="installing-the-client-library">Installing the client library</h3>
<p>While we finish the process of making the library publicly accessible <code>pip</code>, it can be installed with the following command that will direct <code>pip</code> to the S3 bucket that contains the latest version of the client.</p>
<div class="cell" data-cell_id="597ac6a094784a65a8141b342007a768" data-deepnote_cell_height="149.1875" data-deepnote_cell_type="code" data-deepnote_output_heights="[21.1875]" data-execution_millis="361" data-execution_start="1660150142847" data-source_hash="747bb2a4" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load API key and secret from environment variables</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>load_dotenv(<span class="st">'./env'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>True</code></pre>
</div>
</div>
</section>
</section>
<section id="creating-a-new-project" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-new-project">Creating a new project</h2>
<p>Before we test the client library with a dataset and a model, we need to create a new project on the ValidMind dashboard:</p>
<ul>
<li>Navigate to the dashboard and click on the “Create new Project” button</li>
<li>Provide a name and description for the project</li>
<li>Select a model use case</li>
<li>For modeling objective, we only support automated documentation of <code>Binary Clasification</code> models at the moment</li>
</ul>
<p>After creating the project you will be provided with client library setup instructions. We have provided similar instructions below.</p>
<section id="initializing-the-client-library" class="level3">
<h3 class="anchored" data-anchor-id="initializing-the-client-library">Initializing the client library</h3>
<p>Every validation project in the ValidMind dashboard has an associated <code>project identifier</code>. In order to initialize the client, we need to provide the following arguments:</p>
<ul>
<li><code>project</code>: project identifier. The project identifier can be found in the dashboard URL when navigating to a project page, e.g.&nbsp;for <code>/projects/cl1jyvh2c000909lg1rk0a0zb</code> the project identifier is <code>cl1jyvh2c000909lg1rk0a0zb</code></li>
<li><code>api_host</code>: Location of the ValidMind API. This value is already set on this notebook.</li>
<li><code>api_key</code>: Account API key. This can be found in the settings page in the ValidMind dashboard</li>
<li><code>api_secret</code>: Account Secret key. Also found in the settings page in the ValidMind dashboard</li>
</ul>
<div class="cell" data-cell_id="4b874a48418b4a5dbb7f987c8b83be86" data-deepnote_cell_height="94" data-deepnote_cell_type="code" data-execution_millis="1" data-execution_start="1660150145739" data-source_hash="7c7b5350" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lookup your own project id</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># project='cla6walda00001wl6pdzagu9v'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>project<span class="op">=</span><span class="st">'clar3ppjg000f1gmikrfmkld6'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now initialize the client library with the <code>vm.init</code> function:</p>
<div class="cell" data-cell_id="bc1361cd166c4e59a6a461bf41420b62" data-deepnote_cell_height="203.1875" data-deepnote_cell_type="code" data-deepnote_output_heights="[21.1875]" data-execution_millis="5638" data-execution_start="1660150150425" data-source_hash="61ae0397" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> validmind <span class="im">as</span> vm</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>vm.init(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    project<span class="op">=</span>project</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00015-75d09835-7bea-423b-b346-9fc3ed093451" data-deepnote_cell_height="202" data-deepnote_cell_type="code" data-execution_millis="220" data-execution_start="1660150159054" data-source_hash="fb29b98f" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Necessary imports for training our demo models</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="validmind-client-library-functions" class="level2">
<h2 class="anchored" data-anchor-id="validmind-client-library-functions">ValidMind Client Library Functions</h2>
<p>As of version <code>0.8.x</code> of the client library, the following logging and testing functions are available:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>log_metadata</code></td>
<td>Logs free-form metadata text for a given content ID in the model documentation</td>
</tr>
<tr class="even">
<td><code>log_dataset</code></td>
<td>Analyzes a dataset and logs its description, column definitions and summary statistics</td>
</tr>
<tr class="odd">
<td><code>run_dataset_tests</code></td>
<td>Runs dataset quality tests on the input dataset</td>
</tr>
<tr class="even">
<td><code>analyze_dataset</code></td>
<td>Analyzes a dataset, computes summary statistics and runs data quality tests. This function combines <code>log_dataset</code> and <code>run_dataset_tests</code></td>
</tr>
<tr class="odd">
<td><code>log_model</code></td>
<td>Logs information about a model’s framework, architecture, target objective and training parameters</td>
</tr>
<tr class="even">
<td><code>log_training_metrics</code></td>
<td>Extracts and logs training metrics from a pre-trained model</td>
</tr>
<tr class="odd">
<td><code>evaluate_model</code></td>
<td>Extracts metadata and metrics from a train model instances and runs model evaluation tests according to the model objective, use case and specific validation requirements. This function combines <code>log_model</code>, <code>log_training_metrics</code> and an additional set of preconfigured model evaluation tests</td>
</tr>
</tbody>
</table>
<p>In the example model training code in this notebook, we will demonstrate each of the documented client library functions.</p>
<section id="log_metadata" class="level3">
<h3 class="anchored" data-anchor-id="log_metadata"><code>log_metadata</code></h3>
<p>Logs free-form metadata text for a given content ID in the model documentation.</p>
<p>Arguments:</p>
<ul>
<li><code>content_id</code>: Content ID of the model documentation. This is a unique identifier generated by the ValidMind dashboard. See available <code>content_id</code>s in the model training section below</li>
<li><code>text</code>: Free-form text to be logged. A text template can be specified in combination with <code>extra_json</code> (see below)</li>
<li><code>extra_json</code>: (TBD support for this) JSON object containing variables to be substituted in the text template</li>
</ul>
</section>
<section id="analyze_dataset" class="level3">
<h3 class="anchored" data-anchor-id="analyze_dataset"><code>analyze_dataset</code></h3>
<p>Analyzes a dataset and logs its description, column definitions and summary statistics. The following information is extracted from the dataset:</p>
<ul>
<li>Descriptive statistics for numerical and categorical columns</li>
<li>Histograms and value counts for summarizing distribution of values</li>
<li>Pearson correlation matrix for numerical columns</li>
<li>Corelation plots for top 15 correlated features</li>
</ul>
<p>Additionally, it will run a collection of data quality tests such as:</p>
<ul>
<li>Class imbalance test on target column</li>
<li>Duplicate rows and duplicates based on primary key</li>
<li>High cardinality test on categorical columns</li>
<li>Missing values</li>
<li>Highly correlated column pairs</li>
<li>Skewness test</li>
<li>Zeros test (columns with too many zeros)</li>
</ul>
<p>Arguments:</p>
<ul>
<li><code>dataset</code>: Input dataset. Only Pandas DataFrames are supported at the moment</li>
<li><code>dataset_type</code>: Type of dataset, e.g.&nbsp;<code>training</code>, <code>test</code>, <code>validation</code>. Value needs to be set to <code>training</code> for now</li>
<li><code>targets</code>: <code>vm.DatasetTargets</code> describing the label column and its values</li>
<li><code>features</code>: Optional list of properties to specify for some features in the dataset</li>
</ul>
<p>Returns:</p>
<ul>
<li><code>results</code>: List of data quality test results</li>
</ul>
</section>
<section id="evaluate_model" class="level3">
<h3 class="anchored" data-anchor-id="evaluate_model"><code>evaluate_model</code></h3>
<p>Logs the following information about a model:</p>
<ul>
<li>Model framework and architecture (e.g.&nbsp;XGBoost, Random Forest, Logistic Regression, etc.)</li>
<li>Model task details (e.g.&nbsp;binary classification, regression, etc.)</li>
<li>Model hyperparameters (e.g.&nbsp;number of trees, max depth, etc.)</li>
<li>Model performance metrics from training, validation and test dataset</li>
</ul>
<p>Additionally, this function runs model evaluation tests according to the model objective, use case and specific validation requirements. The following tests are available for binary classification models at the moment:</p>
<ul>
<li>Accuracy score</li>
<li>Precision score</li>
<li>Recall score</li>
<li>F1 score</li>
<li>ROC AUC score</li>
<li>ROC AUC curve</li>
<li>Confusion matrix</li>
<li>Precision Recall curve</li>
<li>Permutation feature importance</li>
<li>SHAP global importance</li>
</ul>
<p>Arguments:</p>
<ul>
<li><code>model</code>: Trained model instance. Only Scikit-learn interface compatible models are supported at the moment</li>
<li><code>train_set</code>: Training dataset tuple (x_train, y_train)</li>
<li><code>val_set</code>: Validation dataset tuple (x_val, y_val)</li>
<li><code>test_set</code>: Test dataset tuple (x_test, y_test)</li>
</ul>
</section>
</section>
<section id="training-an-example-model" class="level2">
<h2 class="anchored" data-anchor-id="training-an-example-model">Training an Example Model</h2>
<p>We’ll now train an example model to demonstrate the ValidMind client library functions. The following demo datasets are available to use, and on this notebook we’ll train a model for the Bank Customer Churn dataset.</p>
<div class="cell" data-cell_id="00024-9b9475e8-6d0a-4f2f-b4c7-725fab3c90f0" data-deepnote_cell_height="153" data-deepnote_cell_type="code" data-execution_millis="2448" data-execution_start="1660150188409" data-source_hash="cc430a1a" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bank Customer Churn Dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>churn_dataset <span class="op">=</span> pd.read_csv(<span class="st">"https://vmai.s3.us-west-1.amazonaws.com/datasets/bank_customer_churn.csv"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Health Insurance Cross-Sell Dataset</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>insurance_dataset <span class="op">=</span> pd.read_csv(<span class="st">"https://vmai.s3.us-west-1.amazonaws.com/datasets/health_insurance_cross_sell.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>churn_dataset2 <span class="op">=</span> pd.read_csv(<span class="st">"https://gist.githubusercontent.com/mehdi0501/5b9e64b51ed3bbddbe8f018fc7caf626/raw/ee9b21e5f5308299eb5f4d9dd251bc1b9c5ecc85/churn_test.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>churn_dataset2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>RowNumber</th>
      <th>CustomerId</th>
      <th>Surname</th>
      <th>CreditScore</th>
      <th>Geography</th>
      <th>Gender</th>
      <th>Age</th>
      <th>Tenure</th>
      <th>Balance</th>
      <th>NumOfProducts</th>
      <th>HasCrCard</th>
      <th>IsActiveMember</th>
      <th>EstimatedSalary</th>
      <th>Exited</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>15634602</td>
      <td>Hargrave</td>
      <td>619</td>
      <td>France</td>
      <td>Female</td>
      <td>42</td>
      <td>2</td>
      <td>0.00</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>101348.88</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>15647311</td>
      <td>Hill</td>
      <td>608</td>
      <td>Spain</td>
      <td>Female</td>
      <td>41</td>
      <td>1</td>
      <td>83807.86</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>112542.58</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>15619304</td>
      <td>Onio</td>
      <td>502</td>
      <td>France</td>
      <td>Female</td>
      <td>42</td>
      <td>8</td>
      <td>159660.80</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>113931.57</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>15701354</td>
      <td>Boni</td>
      <td>699</td>
      <td>France</td>
      <td>Female</td>
      <td>39</td>
      <td>1</td>
      <td>0.00</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>93826.63</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>15737888</td>
      <td>Mitchell</td>
      <td>850</td>
      <td>Spain</td>
      <td>Female</td>
      <td>43</td>
      <td>2</td>
      <td>125510.82</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>79084.10</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>churn_dataset.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8000 entries, 0 to 7999
Data columns (total 14 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   RowNumber        8000 non-null   int64  
 1   CustomerId       8000 non-null   int64  
 2   Surname          8000 non-null   object 
 3   CreditScore      8000 non-null   int64  
 4   Geography        8000 non-null   object 
 5   Gender           8000 non-null   object 
 6   Age              8000 non-null   int64  
 7   Tenure           8000 non-null   int64  
 8   Balance          8000 non-null   float64
 9   NumOfProducts    8000 non-null   int64  
 10  HasCrCard        8000 non-null   int64  
 11  IsActiveMember   8000 non-null   int64  
 12  EstimatedSalary  8000 non-null   float64
 13  Exited           8000 non-null   int64  
dtypes: float64(2), int64(9), object(3)
memory usage: 875.1+ KB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>churn_dataset.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="log_metadata-1" class="level3">
<h3 class="anchored" data-anchor-id="log_metadata-1">log_metadata</h3>
<p>Before we start logging information about our dataset, we’d want to send metadata to ValidMind about the model’s conceptual soundness, for example. Model developers have the option to directly populate parts of the dashboard documentation using special <code>content_id</code>s. The following is the list of <code>content_id</code>s supported at the moment:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Content ID</th>
<th>Populates Section</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model_overview</td>
<td>Conceptual Soundness -&gt; Model Overview</td>
</tr>
<tr class="even">
<td>model_selection</td>
<td>Conceptual Soundness -&gt; Model Selection</td>
</tr>
<tr class="odd">
<td>business_case</td>
<td>Conceptual Soundness -&gt; Intended Use and Business Use Case</td>
</tr>
<tr class="even">
<td>feature_selection</td>
<td>Data Preparation -&gt; Feature Selection and Engineering</td>
</tr>
<tr class="odd">
<td>governance_plan</td>
<td>Monitoring and Governance -&gt; Governance Plan</td>
</tr>
<tr class="even">
<td>monitoring_implementation</td>
<td>Monitoring and Governance -&gt; Monitoring Implementation</td>
</tr>
<tr class="odd">
<td>monitoring_plan</td>
<td>Monitoring and Governance -&gt; Monitoring Plan</td>
</tr>
</tbody>
</table>
<p>In the following <code>log_metadata</code> example, we will populate the <code>Model Overview</code> section in the dashboard:</p>
<div class="cell" data-cell_id="a0ef0c732b854f71860615155e2d1aef" data-deepnote_cell_height="356.875" data-deepnote_cell_type="code" data-deepnote_output_heights="[null,21.1875]" data-execution_millis="791" data-execution_start="1660150191341" data-source_hash="218baf64" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model_overview <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">We aim to accomplish the following for this study:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">- Identify and visualize which factors contribute to customer churn</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">- Build a prediction model that will perform the following:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">  - Classify if a customer is going to churn or not</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">  - Preferably and based on model performance, choose a model that will attach a probability</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">  to the churn to make it easier for customer service to target low hanging fruits in their</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="st">  efforts to prevent churn</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>vm.log_metadata(content_id<span class="op">=</span><span class="st">"model_overview"</span>, text<span class="op">=</span>model_overview)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Successfully logged metadata</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>True</code></pre>
</div>
</div>
<p>We can now go to <code>Project Overview -&gt; Documentation -&gt; Model Overview</code> and verify this content has been populated on the dashboard.</p>
</section>
<section id="analyze_dataset-1" class="level3">
<h3 class="anchored" data-anchor-id="analyze_dataset-1"><code>analyze_dataset</code></h3>
<p>After loading the dataset, we can log metadata and summary statistics, and run data quality checks for it using <code>analyze_dataset</code>. Note that the <code>analyze_dataset</code> function expects a <code>targets</code> definition. Additional information about columns can be provided with the <code>features</code> argument.</p>
<div class="cell" data-cell_id="00026-908e24f9-be53-4645-a78f-a42c812aede1" data-deepnote_cell_height="490" data-deepnote_cell_type="code" data-execution_millis="7034" data-execution_start="1660150194903" data-source_hash="3fb0224" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>churn_targets <span class="op">=</span> vm.DatasetTargets(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    target_column<span class="op">=</span><span class="st">"Exited"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    class_labels<span class="op">=</span>{</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0"</span>: <span class="st">"Did not exit"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"1"</span>: <span class="st">"Exited"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>churn_features <span class="op">=</span> [</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span>: <span class="st">"RowNumber"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type_options"</span>: {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"primary_key"</span>: <span class="va">True</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>analyze_results <span class="op">=</span> vm.analyze_dataset(</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    dataset<span class="op">=</span>churn_dataset,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    dataset_type<span class="op">=</span><span class="st">"training"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    targets<span class="op">=</span>churn_targets,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    features<span class="op">=</span>churn_features</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analyzing dataset...
Pandas dataset detected.
Inferring dataset types...
Preparing in-memory dataset copy...
Calculating field statistics...
Calculating feature correlations...
Generating correlation plots...
Successfully logged dataset metadata and statistics.
Running data quality tests...
Running data quality tests for "training" dataset...

Preparing dataset for tests...
Preparing in-memory dataset copy...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 6/6 [00:00&lt;00:00, 22.63it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Test suite has completed.
Sending results to ValidMind...
Successfully logged test results for test: class_imbalance
Successfully logged test results for test: duplicates
Successfully logged test results for test: cardinality
Successfully logged test results for test: missing
Successfully logged test results for test: skewness
Successfully logged test results for test: zeros

Summary of results:

Test             Passed      # Passed    # Errors    % Passed
---------------  --------  ----------  ----------  ----------
class_imbalance  True               1           0         100
duplicates       True               2           0         100
cardinality      False              6           1     85.7143
missing          True              14           0         100
skewness         False              6           1     85.7143
zeros            False              0           2           0
</code></pre>
</div>
</div>
<p>After running <code>analyze_dataset</code>, we can open the ValidMind dashboard on the following section to verify that the dataset and its data quality checks have been documented correctly:</p>
<p><code>Dashboard -&gt; Project Overview -&gt; Documentation -&gt; Data Description</code></p>
</section>
<section id="preparing-the-training-dataset" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-training-dataset">Preparing the training dataset</h3>
<p>We are now going to preprocess and prepare our training, validation and test datasets so we can train an example model and evaluate its performance.</p>
<div class="cell" data-cell_id="00031-7a9fada3-e218-47d7-9fb4-64ce86f7161d" data-deepnote_cell_height="292" data-deepnote_cell_type="code" data-execution_millis="5" data-execution_start="1660150206418" data-source_hash="dbf65f41">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_churn_dataset(df):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop columns with no correlation to target</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    df.drop([<span class="st">"RowNumber"</span>, <span class="st">"CustomerId"</span>, <span class="st">"Surname"</span>, <span class="st">"CreditScore"</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode binary features</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    genders <span class="op">=</span> {<span class="st">"Male"</span>: <span class="dv">0</span>, <span class="st">"Female"</span>: <span class="dv">1</span>}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    df.replace({<span class="st">"Gender"</span>: genders}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encode categorical features</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat([df, pd.get_dummies(df[<span class="st">"Geography"</span>], prefix<span class="op">=</span><span class="st">"Geography"</span>)], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    df.drop(<span class="st">"Geography"</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00032-06140a9c-54e6-41a6-9287-55b8d391b5bf" data-deepnote_cell_height="76" data-deepnote_cell_type="code" data-execution_millis="10" data-execution_start="1660150208846" data-source_hash="2f817a8c">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>preprocessed_churn <span class="op">=</span> preprocess_churn_dataset(churn_dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00033-55dc2dd1-1209-4b1f-809a-322f5a62fa6f" data-deepnote_cell_height="364" data-deepnote_cell_type="code" data-execution_millis="3" data-execution_start="1660150210664" data-source_hash="ec9ea158">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_val_test_split_dataset(df):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    train_df, test_df <span class="op">=</span> train_test_split(df, test_size<span class="op">=</span><span class="fl">0.20</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This guarantees a 60/20/20 split</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    train_ds, val_ds <span class="op">=</span> train_test_split(train_df, test_size<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For training</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    x_train <span class="op">=</span> train_ds.drop(<span class="st">"Exited"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> train_ds.loc[:, <span class="st">"Exited"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    x_val <span class="op">=</span> val_ds.drop(<span class="st">"Exited"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    y_val <span class="op">=</span> val_ds.loc[:, <span class="st">"Exited"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For testing</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    x_test <span class="op">=</span> test_df.drop(<span class="st">"Exited"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> test_df.loc[:, <span class="st">"Exited"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x_train, y_train, x_val, y_val, x_test, y_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00034-d60be9d2-ff35-42e9-babf-9a3a0e854633" data-deepnote_cell_height="81" data-deepnote_cell_type="code" data-execution_millis="24" data-execution_start="1660150212945" data-source_hash="279b84e3">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x_train, y_train, x_val, y_val, x_test, y_test <span class="op">=</span> train_val_test_split_dataset(preprocessed_churn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00035-6c629183-9e67-4fec-afd2-1fa03bb7bdd5" data-deepnote_cell_height="310" data-deepnote_cell_type="code" data-execution_millis="19" data-execution_start="1660150214834" data-source_hash="dc0d58f8">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_churn_dataset(x_train, y_train, x_val, y_val):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    xgb_model <span class="op">=</span> xgb.XGBClassifier(early_stopping_rounds<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    xgb_model.set_params(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        eval_metric<span class="op">=</span>[<span class="st">"error"</span>, <span class="st">"logloss"</span>, <span class="st">"auc"</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    )    </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    xgb_model.fit(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        x_train,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        y_train,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        eval_set<span class="op">=</span>[(x_train, y_train), (x_val, y_val)],</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xgb_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00036-b232a11d-d9d8-479e-b3bd-dfb486eeee2e" data-deepnote_cell_height="76" data-deepnote_cell_type="code" data-execution_millis="679" data-execution_start="1660150217238" data-source_hash="cf70757c">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="op">=</span> train_churn_dataset(x_train, y_train, x_val, y_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00037-2a657d33-e3ac-49f9-b99b-08b265bc83ad" data-deepnote_cell_height="166" data-deepnote_cell_type="code" data-execution_millis="4" data-execution_start="1660150218595" data-source_hash="70065d56">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_accuracy(model, x, y):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict_proba(x)[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> [<span class="bu">round</span>(value) <span class="cf">for</span> value <span class="kw">in</span> y_pred]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> accuracy_score(y, predictions)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">}</span><span class="ss">"</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00038-6ed7400b-0c9e-459e-a0a8-a7cc26efd358" data-deepnote_cell_height="107" data-deepnote_cell_type="code" data-execution_millis="576" data-execution_start="1660150220494" data-source_hash="24509ff3">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model_accuracy(xgb_model, x_val, y_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate_model-1" class="level3">
<h3 class="anchored" data-anchor-id="evaluate_model-1"><code>evaluate_model</code></h3>
<p>Finally, after training our model, we can log its model parameters, collect performance metrics and run model evaluation tests on it using <code>evaluate_model</code>:</p>
<div class="cell" data-cell_id="00045-5290db02-488f-49d1-83bc-94b60b8a70e3" data-deepnote_cell_height="1835.875" data-deepnote_cell_type="code" data-deepnote_output_heights="[null,270,286,286,286]" data-execution_millis="6070" data-execution_start="1660150229353" data-source_hash="5ce751f3">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>eval_results <span class="op">=</span> vm.evaluate_model(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    xgb_model,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    train_set<span class="op">=</span>(x_train, y_train),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    val_set<span class="op">=</span>(x_val, y_val),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    test_set<span class="op">=</span>(x_test, y_test)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running <code>evaluate_model</code>, we can open the ValidMind dashboard on the following sections to verify that the model evaluation test results have been logged correctly:</p>
<ul>
<li><code>Dashboard -&gt; Project Overview -&gt; Documentation -&gt; Model Development -&gt; Model Evaluation</code></li>
<li><code>Dashboard -&gt; Project Overview -&gt; Documentation -&gt; Model Development -&gt; Model Explainability and Interpretability</code></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><em>© Copyright 2023 ValidMind Inc All Rights Reserved.</em></div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/validmind/documentation">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/validmind/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>