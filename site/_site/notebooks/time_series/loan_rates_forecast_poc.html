<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ValidMind â€“ loan_rates_forecast_poc</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../validmind.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../guide/ValidMind-logo-color.svg" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../guide/get-started.html">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/guide.html">
 <span class="menu-text">Guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/developers.html">
 <span class="menu-text">Developers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/faq.html">
 <span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/support.html">
 <span class="menu-text">Support</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#poc-loan-rates-forecast-model" id="toc-poc-loan-rates-forecast-model" class="nav-link active" data-scroll-target="#poc-loan-rates-forecast-model">POC Loan Rates Forecast Model</a></li>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link" data-scroll-target="#executive-summary">1. Executive Summary</a></li>
  <li><a href="#model-information" id="toc-model-information" class="nav-link" data-scroll-target="#model-information">2. Model Information</a></li>
  <li><a href="#conceptual-soundness" id="toc-conceptual-soundness" class="nav-link" data-scroll-target="#conceptual-soundness">3. Conceptual Soundness</a></li>
  <li><a href="#model-development" id="toc-model-development" class="nav-link" data-scroll-target="#model-development">4. Model Development</a>
  <ul class="collapse">
  <li><a href="#data-engineering" id="toc-data-engineering" class="nav-link" data-scroll-target="#data-engineering">4.1. Data Engineering</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">4.1.1. Data Collection</a></li>
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description">4.1.2. Data Description</a></li>
  <li><a href="#data-quality" id="toc-data-quality" class="nav-link" data-scroll-target="#data-quality">4.1.3. Data Quality</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">4.2. Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#univariate-analysis" id="toc-univariate-analysis" class="nav-link" data-scroll-target="#univariate-analysis">4.2.1. Univariate Analysis</a></li>
  <li><a href="#multivariate-analysis" id="toc-multivariate-analysis" class="nav-link" data-scroll-target="#multivariate-analysis">4.2.2. Multivariate Analysis</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">4.2.3. Feature Selection</a></li>
  </ul></li>
  <li><a href="#model-methodology" id="toc-model-methodology" class="nav-link" data-scroll-target="#model-methodology">4.3. Model Methodology</a></li>
  <li><a href="#training-data" id="toc-training-data" class="nav-link" data-scroll-target="#training-data">4.4. Training Data</a>
  <ul class="collapse">
  <li><a href="#sampling" id="toc-sampling" class="nav-link" data-scroll-target="#sampling">4.4.1. Sampling</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">4.5. Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#model-1-loan-rates-and-fedfunds" id="toc-model-1-loan-rates-and-fedfunds" class="nav-link" data-scroll-target="#model-1-loan-rates-and-fedfunds">Model 1: Loan Rates and FEDFUNDS</a></li>
  <li><a href="#model-2-loan-rates-constant-and-fedfunds" id="toc-model-2-loan-rates-constant-and-fedfunds" class="nav-link" data-scroll-target="#model-2-loan-rates-constant-and-fedfunds">Model 2: Loan Rates, constant and FEDFUNDS</a></li>
  <li><a href="#model-3-loan-rates-and-gs10" id="toc-model-3-loan-rates-and-gs10" class="nav-link" data-scroll-target="#model-3-loan-rates-and-gs10">Model 3: Loan Rates and GS10</a></li>
  <li><a href="#model-4-loan-rates-fedfunds-and-gs10" id="toc-model-4-loan-rates-fedfunds-and-gs10" class="nav-link" data-scroll-target="#model-4-loan-rates-fedfunds-and-gs10">Model 4: Loan Rates, FEDFUNDS and GS10</a></li>
  <li><a href="#model-5-loan-rates-fedfunds-gs10-and-unrate" id="toc-model-5-loan-rates-fedfunds-gs10-and-unrate" class="nav-link" data-scroll-target="#model-5-loan-rates-fedfunds-gs10-and-unrate">Model 5: Loan Rates, FEDFUNDS, GS10 and UNRATE</a></li>
  </ul></li>
  <li><a href="#model-evaluation-1" id="toc-model-evaluation-1" class="nav-link" data-scroll-target="#model-evaluation-1">4.6. Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#out-of-sample-analysis" id="toc-out-of-sample-analysis" class="nav-link" data-scroll-target="#out-of-sample-analysis">4.6.1. Out-of-Sample Analysis</a></li>
  <li><a href="#forecast-performance" id="toc-forecast-performance" class="nav-link" data-scroll-target="#forecast-performance">4.6.2. Forecast Performance</a></li>
  <li><a href="#scenario-analysis" id="toc-scenario-analysis" class="nav-link" data-scroll-target="#scenario-analysis">4.6.3. Scenario Analysis</a></li>
  <li><a href="#stress-testing" id="toc-stress-testing" class="nav-link" data-scroll-target="#stress-testing">4.6.4. Stress Testing</a></li>
  <li><a href="#uncertainty-analysis" id="toc-uncertainty-analysis" class="nav-link" data-scroll-target="#uncertainty-analysis">4.6.5. Uncertainty Analysis</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/validmind/documentation/blob/main/site/notebooks/time_series/loan_rates_forecast_poc.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/validmind/documentation/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="poc-loan-rates-forecast-model" class="level1">
<h1>POC Loan Rates Forecast Model</h1>
</section>
<section id="executive-summary" class="level1">
<h1>1. Executive Summary</h1>
</section>
<section id="model-information" class="level1">
<h1>2. Model Information</h1>
</section>
<section id="conceptual-soundness" class="level1">
<h1>3. Conceptual Soundness</h1>
</section>
<section id="model-development" class="level1">
<h1>4. Model Development</h1>
<section id="data-engineering" class="level2">
<h2 class="anchored" data-anchor-id="data-engineering">4.1. Data Engineering</h2>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">4.1.1. Data Collection</h3>
<section id="setup" class="level4">
<h4 class="anchored" data-anchor-id="setup">Setup</h4>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># System libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ML libraries</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.ar_model <span class="im">import</span> AutoReg</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller, kpss</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch.unitroot <span class="im">import</span> PhillipsPerron, DFGLS</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> argmax</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, precision_recall_curve</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting libraries </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-fred-data" class="level4">
<h4 class="anchored" data-anchor-id="load-fred-data">Load FRED Data</h4>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_fred_csv_files(file_pattern):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use glob to find all files matching the specified pattern</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    file_list <span class="op">=</span> glob.glob(file_pattern)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty list to store individual DataFrames</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    dataframes <span class="op">=</span> []</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate through each file in the file list</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> file_list:</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the CSV file into a DataFrame</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(<span class="bu">file</span>, parse_dates<span class="op">=</span>[<span class="st">'DATE'</span>], index_col<span class="op">=</span><span class="st">'DATE'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the DataFrame to the list of DataFrames</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        dataframes.append(df)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge all the DataFrames in the list into a single DataFrame</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> pd.concat(dataframes, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>file_pattern <span class="op">=</span> <span class="st">'../datasets/fred/*.csv'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> merge_fred_csv_files(file_pattern)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>display(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>GDPC1</th>
      <th>GS5</th>
      <th>GS10</th>
      <th>GS3</th>
      <th>MORTGAGE30US</th>
      <th>UNRATE</th>
      <th>CPIAUCSL</th>
      <th>FEDFUNDS</th>
      <th>GDP</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1947-01-01</th>
      <td>2034.450</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.48</td>
      <td>NaN</td>
      <td>243.164</td>
    </tr>
    <tr>
      <th>1947-02-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.62</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1947-03-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1947-04-01</th>
      <td>2029.024</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.00</td>
      <td>NaN</td>
      <td>245.968</td>
    </tr>
    <tr>
      <th>1947-05-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.95</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2023-04-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2023-04-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.28</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.27</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2023-04-20</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.39</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2023-04-27</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.43</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3551 rows Ã— 9 columns</p>
</div>
</div>
</div>
<p>Preselection of variables.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>selected_cols <span class="op">=</span> [<span class="st">'MORTGAGE30US'</span>, <span class="st">'UNRATE'</span>, <span class="st">'GS10'</span>, <span class="st">'FEDFUNDS'</span>] </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[selected_cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot time series.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_time_series(df, cols_to_plot<span class="op">=</span><span class="va">None</span>, title<span class="op">=</span><span class="st">''</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot multiple time-series in the same axes using seaborn.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param df: DataFrame with time-series data</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param cols_to_plot: List of column names to plot. If None, plot all columns in df.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param title: Title of the plot, default is ''</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cols_to_plot <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        cols_to_plot <span class="op">=</span> df.columns.tolist()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new DataFrame with the columns to plot</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> df[cols_to_plot]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set seaborn plot style</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the time-series data</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> plot_df.columns:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(data<span class="op">=</span>plot_df[col], label<span class="op">=</span>col)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plot_time_series(df, title<span class="op">=</span><span class="st">'All Variables'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="data-description" class="level3">
<h3 class="anchored" data-anchor-id="data-description">4.1.2. Data Description</h3>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 3551 entries, 1947-01-01 to 2023-04-27
Data columns (total 4 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   MORTGAGE30US  2718 non-null   float64
 1   UNRATE        903 non-null    float64
 2   GS10          841 non-null    float64
 3   FEDFUNDS      825 non-null    float64
dtypes: float64(4)
memory usage: 138.7 KB</code></pre>
</div>
</div>
</section>
<section id="data-quality" class="level3">
<h3 class="anchored" data-anchor-id="data-quality">4.1.3. Data Quality</h3>
<section id="frequency-of-series" class="level4">
<h4 class="anchored" data-anchor-id="frequency-of-series">Frequency of Series</h4>
<p>Distribution of frequencies in the data.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_time_difference_frequency(df):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the time differences between consecutive entries</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    time_diff <span class="op">=</span> df.index.to_series().diff().dropna()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the time differences to a suitable unit (e.g., days)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    time_diff_days <span class="op">=</span> time_diff.dt.total_seconds() <span class="op">/</span> (<span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame with the time differences</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    time_diff_df <span class="op">=</span> pd.DataFrame({<span class="st">'Time Differences (Days)'</span>: time_diff_days})</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the frequency distribution of the time differences</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>time_diff_df, x<span class="op">=</span><span class="st">'Time Differences (Days)'</span>, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Time Differences (Days)'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plot_time_difference_frequency(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Identify frequencies for each variable.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> identify_frequencies(df):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Identify the frequency of each series in the DataFrame.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param df: Time-series DataFrame</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: DataFrame with two columns: 'Variable' and 'Frequency'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    frequencies <span class="op">=</span> []</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> df.columns:</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        series <span class="op">=</span> df[column].dropna()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> series.empty:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            freq <span class="op">=</span> pd.infer_freq(series.index)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> freq <span class="op">==</span> <span class="st">'MS'</span> <span class="kw">or</span> freq <span class="op">==</span> <span class="st">'M'</span>:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                label <span class="op">=</span> <span class="st">'Monthly'</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> freq <span class="op">==</span> <span class="st">'Q'</span>:</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                label <span class="op">=</span> <span class="st">'Quarterly'</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> freq <span class="op">==</span> <span class="st">'A'</span>:</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                label <span class="op">=</span> <span class="st">'Yearly'</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                label <span class="op">=</span> freq</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        frequencies.append({<span class="st">'Variable'</span>: column, <span class="st">'Frequency'</span>: label})</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    freq_df <span class="op">=</span> pd.DataFrame(frequencies)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> freq_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>frequencies <span class="op">=</span> identify_frequencies(df)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>display(frequencies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>UNRATE</td>
      <td>Monthly</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GS10</td>
      <td>Monthly</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FEDFUNDS</td>
      <td>Monthly</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Handling frequencies.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.resample(<span class="st">'MS'</span>).last()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>frequencies <span class="op">=</span> identify_frequencies(df)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>display(frequencies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>Monthly</td>
    </tr>
    <tr>
      <th>1</th>
      <td>UNRATE</td>
      <td>Monthly</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GS10</td>
      <td>Monthly</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FEDFUNDS</td>
      <td>Monthly</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="missing-values" class="level4">
<h4 class="anchored" data-anchor-id="missing-values">Missing Values</h4>
<p><strong>Step 1: Identify Missing Values</strong></p>
<p>Total number of missing values.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_missing_values_bar(df):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot a bar chart displaying the total number of missing values per variable (column) in a time-series DataFrame using seaborn.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param df: Time-series DataFrame</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total number of missing values per column</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    missing_values <span class="op">=</span> df.isnull().<span class="bu">sum</span>()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set seaborn plot style</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the bar chart</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    sns.barplot(x<span class="op">=</span>missing_values.index, y<span class="op">=</span>missing_values.values)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Variables (Columns)'</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Number of Missing Values'</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Total Number of Missing Values per Variable'</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plot_missing_values_bar(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Heatmap of missing values.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_missing_values_heatmap(df, start_year<span class="op">=</span><span class="va">None</span>, end_year<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot a heatmap of missing values with actual years in rows using seaborn.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param df: Time-series DataFrame</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param start_year: Start year for zooming in, defaults to None</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param end_year: End year for zooming in, defaults to None</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame based on the specified start_year and end_year</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start_year:</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df.index.year <span class="op">&gt;=</span> start_year]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> end_year:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df.index.year <span class="op">&lt;=</span> end_year]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a boolean mask for missing values</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    missing_mask <span class="op">=</span> df.isnull()</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set seaborn plot style</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the heatmap</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(missing_mask.T, cmap<span class="op">=</span><span class="st">'viridis'</span>, cbar<span class="op">=</span><span class="va">False</span>, xticklabels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add actual years on the x-axis</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df.index.year.unique()</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    xticks <span class="op">=</span> [df.index.get_loc(df.index[df.index.year <span class="op">==</span> year][<span class="dv">0</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    plt.xticks(xticks, years, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Columns'</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Rows (Years)'</span>)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Missing Values Heatmap with Actual Years in Rows'</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_missing_values_heatmap(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Handling Missing Values</strong></p>
<p>Drop missing values.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plot_missing_values_bar(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plot_missing_values_heatmap(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="outliers" class="level4">
<h4 class="anchored" data-anchor-id="outliers">Outliers</h4>
<p><strong>Step 1: Identify Outliers</strong></p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> identify_outliers(df, threshold<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    z_scores <span class="op">=</span> pd.DataFrame(stats.zscore(df), index<span class="op">=</span>df.index, columns<span class="op">=</span>df.columns)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    outliers <span class="op">=</span> z_scores[(z_scores.<span class="bu">abs</span>() <span class="op">&gt;</span> threshold).<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    outlier_table <span class="op">=</span> []</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> outliers.iterrows():</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(row[col]) <span class="op">&gt;</span> threshold:</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                outlier_table.append({<span class="st">"Variable"</span>: col, <span class="st">"z-score"</span>: row[col], <span class="st">"Threshold"</span>: threshold, <span class="st">"Date"</span>: idx})</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(outlier_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>outliers_table <span class="op">=</span> identify_outliers(df, threshold<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>display(outliers_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>z-score</th>
      <th>Threshold</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FEDFUNDS</td>
      <td>3.106442</td>
      <td>3</td>
      <td>1980-03-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>FEDFUNDS</td>
      <td>3.212296</td>
      <td>3</td>
      <td>1980-04-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FEDFUNDS</td>
      <td>3.537417</td>
      <td>3</td>
      <td>1980-12-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FEDFUNDS</td>
      <td>3.582783</td>
      <td>3</td>
      <td>1981-01-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FEDFUNDS</td>
      <td>3.441645</td>
      <td>3</td>
      <td>1981-05-01</td>
    </tr>
    <tr>
      <th>5</th>
      <td>FEDFUNDS</td>
      <td>3.587823</td>
      <td>3</td>
      <td>1981-06-01</td>
    </tr>
    <tr>
      <th>6</th>
      <td>FEDFUNDS</td>
      <td>3.572701</td>
      <td>3</td>
      <td>1981-07-01</td>
    </tr>
    <tr>
      <th>7</th>
      <td>FEDFUNDS</td>
      <td>3.265222</td>
      <td>3</td>
      <td>1981-08-01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>MORTGAGE30US</td>
      <td>3.246766</td>
      <td>3</td>
      <td>1981-09-01</td>
    </tr>
    <tr>
      <th>9</th>
      <td>MORTGAGE30US</td>
      <td>3.271251</td>
      <td>3</td>
      <td>1981-10-01</td>
    </tr>
    <tr>
      <th>10</th>
      <td>MORTGAGE30US</td>
      <td>3.011098</td>
      <td>3</td>
      <td>1982-01-01</td>
    </tr>
    <tr>
      <th>11</th>
      <td>UNRATE</td>
      <td>5.011303</td>
      <td>3</td>
      <td>2020-04-01</td>
    </tr>
    <tr>
      <th>12</th>
      <td>UNRATE</td>
      <td>4.128421</td>
      <td>3</td>
      <td>2020-05-01</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Plot outliers.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_outliers(df, outliers_table, use_subplots<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> use_subplots:</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        n_variables <span class="op">=</span> <span class="bu">len</span>(df.columns)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(n_variables, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span> <span class="op">*</span> n_variables), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(df.columns):</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(data<span class="op">=</span>df, x<span class="op">=</span>df.index, y<span class="op">=</span>col, ax<span class="op">=</span>axes[i], label<span class="op">=</span>col)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>            variable_outliers <span class="op">=</span> outliers_table[outliers_table[<span class="st">"Variable"</span>] <span class="op">==</span> col]</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, row <span class="kw">in</span> variable_outliers.iterrows():</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                date <span class="op">=</span> row[<span class="st">"Date"</span>]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                outlier_value <span class="op">=</span> df.loc[date, col]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                axes[i].scatter(date, outlier_value, marker<span class="op">=</span><span class="st">"o"</span>, s<span class="op">=</span><span class="dv">100</span>, c<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Outlier"</span> <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            axes[i].legend()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>            axes[i].set_ylabel(<span class="st">"Value"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            axes[i].set_title(<span class="ss">f"Time Series with Outliers for </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span>))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(data<span class="op">=</span>df, x<span class="op">=</span>df.index, y<span class="op">=</span>col, label<span class="op">=</span>col)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        plotted_outlier_variables <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, row <span class="kw">in</span> outliers_table.iterrows():</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            date <span class="op">=</span> row[<span class="st">"Date"</span>]</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            variable <span class="op">=</span> row[<span class="st">"Variable"</span>]</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>            outlier_value <span class="op">=</span> df.loc[date, variable]</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> variable <span class="kw">not</span> <span class="kw">in</span> plotted_outlier_variables:</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>                plt.scatter(date, outlier_value, marker<span class="op">=</span><span class="st">"o"</span>, s<span class="op">=</span><span class="dv">100</span>, c<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="ss">f"Outlier (</span><span class="sc">{</span>variable<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>                plotted_outlier_variables.add(variable)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                plt.scatter(date, outlier_value, marker<span class="op">=</span><span class="st">"o"</span>, s<span class="op">=</span><span class="dv">100</span>, c<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">"Time Series with Outliers"</span>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plot_outliers(df, outliers_table, use_subplots<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Handling Outliers</strong></p>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">4.2. Exploratory Data Analysis</h2>
<section id="univariate-analysis" class="level3">
<h3 class="anchored" data-anchor-id="univariate-analysis">4.2.1. Univariate Analysis</h3>
<section id="visual-inspection" class="level4">
<h4 class="anchored" data-anchor-id="visual-inspection">Visual Inspection</h4>
<p>Line plots.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plot_time_series(df, title<span class="op">=</span><span class="st">'All Variables'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="seasonality" class="level4">
<h4 class="anchored" data-anchor-id="seasonality">Seasonality</h4>
<p><strong>Step 1: Compute Seasonal Decomposition</strong></p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_seasonal_decomposition(data, model<span class="op">=</span><span class="st">'additive'</span>):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute seasonal decomposition for all time-series in a DataFrame and store all the components in a new DataFrame.</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param data: DataFrame with time-series data</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param period: Number of observations in each seasonal period</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: DataFrame with seasonal, trend, and residual components for all time-series in the input DataFrame</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty DataFrame to store the components for each time-series</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    decomp_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each column in the input DataFrame and perform seasonal decomposition</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> data.columns:</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> seasonal_decompose(data[col], model<span class="op">=</span>model)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        decomp_df[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_seasonal'</span>] <span class="op">=</span> res.seasonal</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        decomp_df[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_trend'</span>] <span class="op">=</span> res.trend</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        decomp_df[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_residual'</span>] <span class="op">=</span> res.resid</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the index of the decomposed DataFrame to be the same as the input DataFrame</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    decomp_df.index <span class="op">=</span> data.index</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decomp_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>decomp_df <span class="op">=</span> compute_seasonal_decomposition(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2: Visualize Seasonal Decomposition</strong></p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_seasonal_components(decomp_df):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot all seasonal, trend, and residual components for each variable in a DataFrame.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param decomp_df: DataFrame with seasonal, trend, and residual components for each variable</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize a figure with subplots for each variable and component</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="bu">len</span>(decomp_df.columns) <span class="op">//</span> <span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span> <span class="op">*</span> (<span class="bu">len</span>(decomp_df.columns) <span class="op">//</span> <span class="dv">3</span>)))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each variable in the input DataFrame and plot the seasonal, trend, and residual components</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(decomp_df.columns[::<span class="dv">3</span>]):</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">0</span>].plot(decomp_df.index, decomp_df[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>])</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">0</span>].set_title(<span class="ss">f'Seasonal: </span><span class="sc">{</span>col[:<span class="op">-</span><span class="dv">9</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">1</span>].plot(decomp_df.index, decomp_df[<span class="ss">f'</span><span class="sc">{</span>col[:<span class="op">-</span><span class="dv">9</span>]<span class="sc">}</span><span class="ss">_trend'</span>])</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">1</span>].set_title(<span class="ss">f'Trend: </span><span class="sc">{</span>col[:<span class="op">-</span><span class="dv">9</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">2</span>].plot(decomp_df.index, decomp_df[<span class="ss">f'</span><span class="sc">{</span>col[:<span class="op">-</span><span class="dv">9</span>]<span class="sc">}</span><span class="ss">_residual'</span>])</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        axs[i, <span class="dv">2</span>].set_title(<span class="ss">f'Residual: </span><span class="sc">{</span>col[:<span class="op">-</span><span class="dv">9</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the figure title</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">'Seasonal Decomposition'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust the spacing between subplots</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plot_seasonal_components(decomp_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 3: Residual Analysis</strong></p>
</section>
<section id="stationarity" class="level4">
<h4 class="anchored" data-anchor-id="stationarity">Stationarity</h4>
<p><strong>Step 1: Compute Unit Root Tests on Levels</strong></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_stationarity(data, threshold<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Perform multiple stationarity tests on each time series in a DataFrame.</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param data: DataFrame with time-series data</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: DataFrame with test results (Variable, Test, p-value, Threshold, Pass/Fail, Decision)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty DataFrame to store the test results</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    test_results <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Test'</span>, <span class="st">'p-value'</span>, <span class="st">'Threshold'</span>, <span class="st">'Pass/Fail'</span>, <span class="st">'Decision'</span>])</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each column in the input DataFrame and perform stationarity tests</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> data.columns:</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the ADF test</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        adf_result <span class="op">=</span> adfuller(data[col], autolag<span class="op">=</span><span class="st">'AIC'</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        adf_pvalue <span class="op">=</span> adf_result[<span class="dv">1</span>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        adf_pass_fail <span class="op">=</span> adf_pvalue <span class="op">&lt;</span> threshold</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        adf_decision <span class="op">=</span> <span class="st">'Stationary'</span> <span class="cf">if</span> adf_pass_fail <span class="cf">else</span> <span class="st">'Non-stationary'</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>        test_results <span class="op">=</span> test_results.append({</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Variable'</span>: col,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Test'</span>: <span class="st">'ADF'</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p-value'</span>: adf_pvalue,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Threshold'</span>: threshold,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pass/Fail'</span>: adf_pass_fail,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Decision'</span>: adf_decision</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        }, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the KPSS test</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        kpss_result <span class="op">=</span> kpss(data[col], regression<span class="op">=</span><span class="st">'c'</span>, nlags<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        kpss_pvalue <span class="op">=</span> kpss_result[<span class="dv">1</span>]</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        kpss_pass_fail <span class="op">=</span> kpss_pvalue <span class="op">&gt;</span> threshold</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>        kpss_decision <span class="op">=</span> <span class="st">'Stationary'</span> <span class="cf">if</span> kpss_pass_fail <span class="cf">else</span> <span class="st">'Non-stationary'</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        test_results <span class="op">=</span> test_results.append({</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Variable'</span>: col,</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Test'</span>: <span class="st">'KPSS'</span>,</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p-value'</span>: kpss_pvalue,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Threshold'</span>: threshold,</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pass/Fail'</span>: kpss_pass_fail,</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Decision'</span>: kpss_decision</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>        }, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the Phillips-Perron test</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>        pp_result <span class="op">=</span> PhillipsPerron(data[col], trend<span class="op">=</span><span class="st">'ct'</span>)</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>        pp_pvalue <span class="op">=</span> pp_result.pvalue</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>        pp_threshold <span class="op">=</span> threshold</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        pp_pass_fail <span class="op">=</span> pp_pvalue <span class="op">&lt;</span> pp_threshold</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        pp_decision <span class="op">=</span> <span class="st">'Stationary'</span> <span class="cf">if</span> pp_pass_fail <span class="cf">else</span> <span class="st">'Non-stationary'</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        test_results <span class="op">=</span> test_results.append({</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Variable'</span>: col,</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Test'</span>: <span class="st">'PhillipsPerron'</span>,</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p-value'</span>: pp_pvalue,</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Threshold'</span>: pp_threshold,</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pass/Fail'</span>: pp_pass_fail,</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Decision'</span>: pp_decision</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>        }, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Perform the DF-GLS test</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>        dfgls_result <span class="op">=</span> DFGLS(data[col], trend<span class="op">=</span><span class="st">'ct'</span>)</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>        dfgls_pvalue <span class="op">=</span> dfgls_result.pvalue</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>        dfgls_threshold <span class="op">=</span> threshold</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>        dfgls_pass_fail <span class="op">=</span> dfgls_pvalue <span class="op">&lt;</span> dfgls_threshold</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>        dfgls_decision <span class="op">=</span> <span class="st">'Stationary'</span> <span class="cf">if</span> dfgls_pass_fail <span class="cf">else</span> <span class="st">'Non-stationary'</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>        test_results <span class="op">=</span> test_results.append({</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Variable'</span>: col,</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Test'</span>: <span class="st">'DFGLS'</span>,</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p-value'</span>: dfgls_pvalue,</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Threshold'</span>: dfgls_threshold,</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pass/Fail'</span>: dfgls_pass_fail,</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Decision'</span>: dfgls_decision</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>        }, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> test_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>test_stationarity(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>Test</th>
      <th>p-value</th>
      <th>Threshold</th>
      <th>Pass/Fail</th>
      <th>Decision</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>ADF</td>
      <td>0.671948</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MORTGAGE30US</td>
      <td>KPSS</td>
      <td>0.010000</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MORTGAGE30US</td>
      <td>PhillipsPerron</td>
      <td>0.266671</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MORTGAGE30US</td>
      <td>DFGLS</td>
      <td>0.633164</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>4</th>
      <td>UNRATE</td>
      <td>ADF</td>
      <td>0.019395</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>5</th>
      <td>UNRATE</td>
      <td>KPSS</td>
      <td>0.070375</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>6</th>
      <td>UNRATE</td>
      <td>PhillipsPerron</td>
      <td>0.023946</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>7</th>
      <td>UNRATE</td>
      <td>DFGLS</td>
      <td>0.017522</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GS10</td>
      <td>ADF</td>
      <td>0.709954</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GS10</td>
      <td>KPSS</td>
      <td>0.010000</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>10</th>
      <td>GS10</td>
      <td>PhillipsPerron</td>
      <td>0.148107</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>11</th>
      <td>GS10</td>
      <td>DFGLS</td>
      <td>0.505034</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FEDFUNDS</td>
      <td>ADF</td>
      <td>0.105801</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FEDFUNDS</td>
      <td>KPSS</td>
      <td>0.010000</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FEDFUNDS</td>
      <td>PhillipsPerron</td>
      <td>0.048473</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FEDFUNDS</td>
      <td>DFGLS</td>
      <td>0.058910</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 2: Compute Unit Root Tests on First Difference</strong></p>
<p>Take first difference.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_diff <span class="op">=</span> df.diff().dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>test_stationarity(df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/juanvalidmind/Library/Caches/pypoetry/virtualenvs/validmind-eEL8LtKG-py3.10/lib/python3.10/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>Test</th>
      <th>p-value</th>
      <th>Threshold</th>
      <th>Pass/Fail</th>
      <th>Decision</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>ADF</td>
      <td>2.156453e-30</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MORTGAGE30US</td>
      <td>KPSS</td>
      <td>1.000000e-01</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MORTGAGE30US</td>
      <td>PhillipsPerron</td>
      <td>0.000000e+00</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MORTGAGE30US</td>
      <td>DFGLS</td>
      <td>0.000000e+00</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>4</th>
      <td>UNRATE</td>
      <td>ADF</td>
      <td>5.611475e-26</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>5</th>
      <td>UNRATE</td>
      <td>KPSS</td>
      <td>1.000000e-01</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>6</th>
      <td>UNRATE</td>
      <td>PhillipsPerron</td>
      <td>0.000000e+00</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>7</th>
      <td>UNRATE</td>
      <td>DFGLS</td>
      <td>0.000000e+00</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GS10</td>
      <td>ADF</td>
      <td>2.036674e-09</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GS10</td>
      <td>KPSS</td>
      <td>1.000000e-01</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>10</th>
      <td>GS10</td>
      <td>PhillipsPerron</td>
      <td>0.000000e+00</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>11</th>
      <td>GS10</td>
      <td>DFGLS</td>
      <td>1.075000e-01</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FEDFUNDS</td>
      <td>ADF</td>
      <td>6.632874e-05</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FEDFUNDS</td>
      <td>KPSS</td>
      <td>1.000000e-01</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FEDFUNDS</td>
      <td>PhillipsPerron</td>
      <td>1.719033e-22</td>
      <td>0.05</td>
      <td>True</td>
      <td>Stationary</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FEDFUNDS</td>
      <td>DFGLS</td>
      <td>5.444185e-02</td>
      <td>0.05</td>
      <td>False</td>
      <td>Non-stationary</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="ar-analysis" class="level4">
<h4 class="anchored" data-anchor-id="ar-analysis">AR Analysis</h4>
<p><strong>Step 1: Calculate AR Orders</strong></p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ar_orders(dataset, max_order<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This function calculates the autoregressive order of all time series in a dataset.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">    dataset (pd.DataFrame): The dataset containing the time series.</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    max_order (int): The maximum order to consider for the autoregressive models.</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame: A table with the autoregressive order, AIC, and BIC for orders 0 up to max_order.</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty list to store the results</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate over each column (time series) in the dataset</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> dataset.columns:</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        time_series <span class="op">=</span> dataset[col]</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test for stationarity using Augmented Dickey-Fuller test</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        adf_result <span class="op">=</span> adfuller(time_series)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> adf_result[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="fl">0.05</span>:</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            time_series <span class="op">=</span> time_series.diff().dropna()  <span class="co"># Apply first difference to make the series stationary</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test different autoregressive orders and store the AIC and BIC values</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> order <span class="kw">in</span> <span class="bu">range</span>(max_order <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> AutoReg(time_series, lags<span class="op">=</span>order, old_names<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> model.fit()</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add the current time series, order, AIC, and BIC to the results list</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            results.append({<span class="st">'Variable'</span>: col, <span class="st">'AR order'</span>: order, <span class="st">'AIC'</span>: result.aic, <span class="st">'BIC'</span>: result.bic})</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the results list to a DataFrame and return it</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>calculate_ar_orders(df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>AR order</th>
      <th>AIC</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>0</td>
      <td>291.177506</td>
      <td>300.046599</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MORTGAGE30US</td>
      <td>1</td>
      <td>246.637029</td>
      <td>259.935849</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MORTGAGE30US</td>
      <td>2</td>
      <td>223.310101</td>
      <td>241.035426</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MORTGAGE30US</td>
      <td>3</td>
      <td>225.331792</td>
      <td>247.480389</td>
    </tr>
    <tr>
      <th>4</th>
      <td>UNRATE</td>
      <td>0</td>
      <td>835.075578</td>
      <td>843.944671</td>
    </tr>
    <tr>
      <th>5</th>
      <td>UNRATE</td>
      <td>1</td>
      <td>835.941726</td>
      <td>849.240546</td>
    </tr>
    <tr>
      <th>6</th>
      <td>UNRATE</td>
      <td>2</td>
      <td>833.607234</td>
      <td>851.332559</td>
    </tr>
    <tr>
      <th>7</th>
      <td>UNRATE</td>
      <td>3</td>
      <td>835.222318</td>
      <td>857.370915</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GS10</td>
      <td>0</td>
      <td>243.604950</td>
      <td>252.474043</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GS10</td>
      <td>1</td>
      <td>179.889575</td>
      <td>193.188396</td>
    </tr>
    <tr>
      <th>10</th>
      <td>GS10</td>
      <td>2</td>
      <td>155.917382</td>
      <td>173.642706</td>
    </tr>
    <tr>
      <th>11</th>
      <td>GS10</td>
      <td>3</td>
      <td>155.305036</td>
      <td>177.453633</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FEDFUNDS</td>
      <td>0</td>
      <td>992.528777</td>
      <td>1001.397870</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FEDFUNDS</td>
      <td>1</td>
      <td>879.316228</td>
      <td>892.615048</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FEDFUNDS</td>
      <td>2</td>
      <td>858.467020</td>
      <td>876.192344</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FEDFUNDS</td>
      <td>3</td>
      <td>858.142003</td>
      <td>880.290601</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 2: Selection of AR Order</strong></p>
</section>
<section id="ma-analysis" class="level4">
<h4 class="anchored" data-anchor-id="ma-analysis">MA Analysis</h4>
<p><strong>Step 1: Calculate MA Orders</strong></p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ma_orders(dataset, max_order<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This function calculates the moving average order of all time series in a dataset.</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">    dataset (pd.DataFrame): The dataset containing the time series.</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">    max_order (int): The maximum order to consider for the moving average models.</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">    pd.DataFrame: A table with the moving average order, AIC, and BIC for orders 0 up to max_order.</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty list to store the results</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate over each column (time series) in the dataset</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> dataset.columns:</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        time_series <span class="op">=</span> dataset[col]</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test for stationarity using Augmented Dickey-Fuller test</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        adf_result <span class="op">=</span> adfuller(time_series)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> adf_result[<span class="dv">1</span>] <span class="op">&gt;</span> <span class="fl">0.05</span>:</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>            time_series <span class="op">=</span> time_series.diff().dropna()  <span class="co"># Apply first difference to make the series stationary</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test different moving average orders and store the AIC and BIC values</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> order <span class="kw">in</span> <span class="bu">range</span>(max_order <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> ARIMA(time_series, order<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>, order))</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> model.fit()</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add the current time series, order, AIC, and BIC to the results list</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>            results.append({<span class="st">'Variable'</span>: col, <span class="st">'MA order'</span>: order, <span class="st">'AIC'</span>: result.aic, <span class="st">'BIC'</span>: result.bic})</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the results list to a DataFrame and return it</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>calculate_ma_orders(df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>MA order</th>
      <th>AIC</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>MORTGAGE30US</td>
      <td>0</td>
      <td>291.177507</td>
      <td>300.046600</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MORTGAGE30US</td>
      <td>1</td>
      <td>228.313186</td>
      <td>241.616825</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MORTGAGE30US</td>
      <td>2</td>
      <td>227.394618</td>
      <td>245.132804</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MORTGAGE30US</td>
      <td>3</td>
      <td>225.782939</td>
      <td>247.955672</td>
    </tr>
    <tr>
      <th>4</th>
      <td>UNRATE</td>
      <td>0</td>
      <td>835.075578</td>
      <td>843.944671</td>
    </tr>
    <tr>
      <th>5</th>
      <td>UNRATE</td>
      <td>1</td>
      <td>836.126269</td>
      <td>849.429909</td>
    </tr>
    <tr>
      <th>6</th>
      <td>UNRATE</td>
      <td>2</td>
      <td>833.512857</td>
      <td>851.251043</td>
    </tr>
    <tr>
      <th>7</th>
      <td>UNRATE</td>
      <td>3</td>
      <td>835.509496</td>
      <td>857.682228</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GS10</td>
      <td>0</td>
      <td>243.604950</td>
      <td>252.474043</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GS10</td>
      <td>1</td>
      <td>155.604373</td>
      <td>168.908013</td>
    </tr>
    <tr>
      <th>10</th>
      <td>GS10</td>
      <td>2</td>
      <td>152.550224</td>
      <td>170.288410</td>
    </tr>
    <tr>
      <th>11</th>
      <td>GS10</td>
      <td>3</td>
      <td>154.471588</td>
      <td>176.644321</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FEDFUNDS</td>
      <td>0</td>
      <td>992.528777</td>
      <td>1001.397870</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FEDFUNDS</td>
      <td>1</td>
      <td>865.158571</td>
      <td>878.462211</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FEDFUNDS</td>
      <td>2</td>
      <td>864.192973</td>
      <td>881.931159</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FEDFUNDS</td>
      <td>3</td>
      <td>865.935637</td>
      <td>888.108370</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 2: Selection of MA Order</strong></p>
</section>
</section>
<section id="multivariate-analysis" class="level3">
<h3 class="anchored" data-anchor-id="multivariate-analysis">4.2.2. Multivariate Analysis</h3>
<section id="correlations" class="level4">
<h4 class="anchored" data-anchor-id="correlations">Correlations</h4>
<p><strong>Step 1: Compute Correlation Matrix on Levels</strong></p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_corr_heatmap(df):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute correlation matrix</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="op">=</span> df.corr()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot heatmap</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set plot title</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Correlation Matrix Heatmap'</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Corrrelations across Levels.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Compute Correlation Matrix on First Difference</strong></p>
<p>Correlations across First Differences.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot_corr_heatmap(df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 3: Reasoning</strong></p>
</section>
<section id="scatter-plots" class="level4">
<h4 class="anchored" data-anchor-id="scatter-plots">Scatter Plots</h4>
<p><strong>Step 1: Compute Scatter Plots on Levels</strong></p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_scatter_pairs(df):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute pairwise scatter plots</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    sns.pairplot(df, kind<span class="op">=</span><span class="st">'scatter'</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plot_scatter_pairs(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Compute Scatter Plots on First Difference</strong></p>
<p>Compute first difference.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plot_scatter_pairs(df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 3: Reasoning</strong></p>
</section>
<section id="lag-analsyis" class="level4">
<h4 class="anchored" data-anchor-id="lag-analsyis">Lag Analsyis</h4>
<p><strong>Step 1: Compute Correlations at Multiple Lags</strong></p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_heatmap_correlations(df, target_col, independent_vars, num_lags<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the correlation between the target variable and the lags of independent variables in the dataset,</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and plot a heatmap of these correlations.</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param df: DataFrame containing the target variable and independent variables of interest</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param target_col: Column name of the target variable in the DataFrame</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param independent_vars: List of column names of the independent variables in the DataFrame</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">    :param num_lags: Number of lags to calculate (default is 10)</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    correlations <span class="op">=</span> np.zeros((<span class="bu">len</span>(independent_vars), num_lags <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ind_var_col <span class="kw">in</span> <span class="bu">enumerate</span>(independent_vars):</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> lag <span class="kw">in</span> <span class="bu">range</span>(num_lags <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create a new DataFrame with the original and lagged variable</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            temp_df <span class="op">=</span> pd.DataFrame({target_col: df[target_col],</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="ss">f'</span><span class="sc">{</span>ind_var_col<span class="sc">}</span><span class="ss">_lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">'</span>: df[ind_var_col].shift(lag)})</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Drop NaN rows</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>            temp_df <span class="op">=</span> temp_df.dropna()</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate the correlation between the target variable and the lagged independent variable</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>            corr <span class="op">=</span> temp_df[target_col].corr(temp_df[<span class="ss">f'</span><span class="sc">{</span>ind_var_col<span class="sc">}</span><span class="ss">_lag</span><span class="sc">{</span>lag<span class="sc">}</span><span class="ss">'</span>])</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store the correlation in the correlations matrix</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>            correlations[i, lag] <span class="op">=</span> corr</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame with the correlations matrix</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    correlation_df <span class="op">=</span> pd.DataFrame(correlations, columns<span class="op">=</span>[<span class="ss">f'lag_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_lags <span class="op">+</span> <span class="dv">1</span>)], index<span class="op">=</span>independent_vars)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the heatmap</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span>))</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(correlation_df, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Heatmap of Correlations between Target Variable and Lags of Independent Variables'</span>)</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Lags'</span>)</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Independent Variables'</span>)</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>target_var <span class="op">=</span> <span class="st">'MORTGAGE30US'</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>independent_vars <span class="op">=</span> [<span class="st">'GS10'</span>, <span class="st">'UNRATE'</span>, <span class="st">'FEDFUNDS'</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plot_heatmap_correlations(df_diff, target_col<span class="op">=</span>target_var, independent_vars<span class="op">=</span>independent_vars, num_lags<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Reasoning</strong></p>
</section>
</section>
<section id="feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection">4.2.3. Feature Selection</h3>
</section>
</section>
<section id="model-methodology" class="level2">
<h2 class="anchored" data-anchor-id="model-methodology">4.3. Model Methodology</h2>
</section>
<section id="training-data" class="level2">
<h2 class="anchored" data-anchor-id="training-data">4.4. Training Data</h2>
<section id="sampling" class="level3">
<h3 class="anchored" data-anchor-id="sampling">4.4.1. Sampling</h3>
<p><strong>Step 1: Split dataset into Training and Test</strong></p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>split_index <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(df) <span class="op">*</span> <span class="fl">0.8</span>)   <span class="co"># use 80% of the data for training</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_train, df_test <span class="op">=</span> df[:split_index], df[split_index:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2: Create a Stationary Train and Test Dataset</strong></p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply first difference to both training and test df</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df_train_diff <span class="op">=</span> df_train.diff().dropna()</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_test_diff <span class="op">=</span> df_test.diff().dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">4.5. Model Evaluation</h2>
<section id="model-1-loan-rates-and-fedfunds" class="level3">
<h3 class="anchored" data-anchor-id="model-1-loan-rates-and-fedfunds">Model 1: Loan Rates and FEDFUNDS</h3>
<p><strong>Step 1: Fit Model</strong></p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the independent variables with no intercept</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train_diff[<span class="st">'FEDFUNDS'</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent variable </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_1.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:           MORTGAGE30US   R-squared (uncentered):                   0.286
Model:                            OLS   Adj. R-squared (uncentered):              0.284
Method:                 Least Squares   F-statistic:                              198.8
Date:                Wed, 03 May 2023   Prob (F-statistic):                    3.22e-38
Time:                        14:12:19   Log-Likelihood:                         -57.220
No. Observations:                 498   AIC:                                      116.4
Df Residuals:                     497   BIC:                                      120.7
Df Model:                           1                                                  
Covariance Type:            nonrobust                                                  
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
FEDFUNDS       0.2901      0.021     14.100      0.000       0.250       0.330
==============================================================================
Omnibus:                      139.024   Durbin-Watson:                   1.581
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              806.633
Skew:                           1.080   Prob(JB):                    6.95e-176
Kurtosis:                       8.849   Cond. No.                         1.00
==============================================================================

Notes:
[1] RÂ² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p><strong>Step 2: Reasoning</strong></p>
</section>
<section id="model-2-loan-rates-constant-and-fedfunds" class="level3">
<h3 class="anchored" data-anchor-id="model-2-loan-rates-constant-and-fedfunds">Model 2: Loan Rates, constant and FEDFUNDS</h3>
<p><strong>Step 1: Fit Model</strong></p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables for the linear regression model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df_train_diff[<span class="st">'FEDFUNDS'</span>])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent variable </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_2.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           MORTGAGE30US   R-squared:                       0.286
Model:                            OLS   Adj. R-squared:                  0.284
Method:                 Least Squares   F-statistic:                     198.3
Date:                Wed, 03 May 2023   Prob (F-statistic):           3.99e-38
Time:                        14:12:19   Log-Likelihood:                -57.120
No. Observations:                 498   AIC:                             118.2
Df Residuals:                     496   BIC:                             126.7
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0055      0.012     -0.448      0.654      -0.029       0.018
FEDFUNDS       0.2899      0.021     14.082      0.000       0.249       0.330
==============================================================================
Omnibus:                      138.997   Durbin-Watson:                   1.581
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              806.946
Skew:                           1.080   Prob(JB):                    5.94e-176
Kurtosis:                       8.850   Cond. No.                         1.69
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p><strong>Step 2: Reasoning</strong></p>
</section>
<section id="model-3-loan-rates-and-gs10" class="level3">
<h3 class="anchored" data-anchor-id="model-3-loan-rates-and-gs10">Model 3: Loan Rates and GS10</h3>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables for the linear regression model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train_diff[<span class="st">'GS10'</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent variable </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>model_3 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_3.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:           MORTGAGE30US   R-squared (uncentered):                   0.529
Model:                            OLS   Adj. R-squared (uncentered):              0.528
Method:                 Least Squares   F-statistic:                              558.1
Date:                Wed, 03 May 2023   Prob (F-statistic):                    2.80e-83
Time:                        14:12:19   Log-Likelihood:                          46.439
No. Observations:                 498   AIC:                                     -90.88
Df Residuals:                     497   BIC:                                     -86.67
Df Model:                           1                                                  
Covariance Type:            nonrobust                                                  
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
GS10           0.7428      0.031     23.624      0.000       0.681       0.805
==============================================================================
Omnibus:                      216.020   Durbin-Watson:                   1.949
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            27264.604
Skew:                           0.803   Prob(JB):                         0.00
Kurtosis:                      39.213   Cond. No.                         1.00
==============================================================================

Notes:
[1] RÂ² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</section>
<section id="model-4-loan-rates-fedfunds-and-gs10" class="level3">
<h3 class="anchored" data-anchor-id="model-4-loan-rates-fedfunds-and-gs10">Model 4: Loan Rates, FEDFUNDS and GS10</h3>
<p><strong>Step 1: Fit Model</strong></p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables for the linear regression model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train_diff[[<span class="st">'GS10'</span>, <span class="st">'FEDFUNDS'</span>]]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent variable </span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>model_4 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_4.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:           MORTGAGE30US   R-squared (uncentered):                   0.621
Model:                            OLS   Adj. R-squared (uncentered):              0.620
Method:                 Least Squares   F-statistic:                              407.0
Date:                Wed, 03 May 2023   Prob (F-statistic):                   2.45e-105
Time:                        14:12:19   Log-Likelihood:                          100.84
No. Observations:                 498   AIC:                                     -197.7
Df Residuals:                     496   BIC:                                     -189.3
Df Model:                           2                                                  
Covariance Type:            nonrobust                                                  
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
GS10           0.6298      0.030     20.970      0.000       0.571       0.689
FEDFUNDS       0.1756      0.016     11.005      0.000       0.144       0.207
==============================================================================
Omnibus:                      252.158   Durbin-Watson:                   1.918
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             4954.128
Skew:                           1.729   Prob(JB):                         0.00
Kurtosis:                      18.060   Cond. No.                         2.09
==============================================================================

Notes:
[1] RÂ² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p><strong>Step 2: Reasoning</strong></p>
</section>
<section id="model-5-loan-rates-fedfunds-gs10-and-unrate" class="level3">
<h3 class="anchored" data-anchor-id="model-5-loan-rates-fedfunds-gs10-and-unrate">Model 5: Loan Rates, FEDFUNDS, GS10 and UNRATE</h3>
<p><strong>Step 1: Fit Model</strong></p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables for the linear regression model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train_diff[[<span class="st">'GS10'</span>, <span class="st">'FEDFUNDS'</span>, <span class="st">'UNRATE'</span>]]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the dependent variable </span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>model_5 <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the model summary</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_5.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:           MORTGAGE30US   R-squared (uncentered):                   0.622
Model:                            OLS   Adj. R-squared (uncentered):              0.619
Method:                 Least Squares   F-statistic:                              271.0
Date:                Wed, 03 May 2023   Prob (F-statistic):                   4.91e-104
Time:                        14:12:19   Log-Likelihood:                          100.97
No. Observations:                 498   AIC:                                     -195.9
Df Residuals:                     495   BIC:                                     -183.3
Df Model:                           3                                                  
Covariance Type:            nonrobust                                                  
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
GS10           0.6283      0.030     20.805      0.000       0.569       0.688
FEDFUNDS       0.1741      0.016     10.718      0.000       0.142       0.206
UNRATE        -0.0258      0.051     -0.508      0.612      -0.126       0.074
==============================================================================
Omnibus:                      255.442   Durbin-Watson:                   1.911
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             5061.282
Skew:                           1.758   Prob(JB):                         0.00
Kurtosis:                      18.217   Cond. No.                         3.48
==============================================================================

Notes:
[1] RÂ² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<section id="model-selection" class="level4">
<h4 class="anchored" data-anchor-id="model-selection">Model Selection</h4>
<p><strong>Step 1: In-Sample Performance</strong></p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_sample_performance_ols(models):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    evaluation_results <span class="op">=</span> []</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> model.model.exog</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        X_columns <span class="op">=</span> model.model.exog_names</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> model.model.endog</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the predicted values using the model</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the residuals</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        residuals <span class="op">=</span> y <span class="op">-</span> y_pred</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract R-squared and Adjusted R-squared</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>        r2 <span class="op">=</span> model.rsquared</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        adj_r2 <span class="op">=</span> model.rsquared_adj</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the Mean Squared Error (MSE) and Root Mean Squared Error (RMSE)</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        mse <span class="op">=</span> model.mse_resid</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>        rmse <span class="op">=</span> mse <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append the results to the evaluation_results list</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>        evaluation_results.append({</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Model'</span>: <span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Independent Variables'</span>: <span class="st">', '</span>.join(X_columns),</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'R-Squared'</span>: r2,</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Adjusted R-Squared'</span>: adj_r2,</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MSE'</span>: mse,</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'RMSE'</span>: rmse</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the evaluation_results list to a DataFrame</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(evaluation_results)</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_1, model_2, model_3, model_4, model_5]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> in_sample_performance_ols(models)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>display(results_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Model</th>
      <th>Independent Variables</th>
      <th>R-Squared</th>
      <th>Adjusted R-Squared</th>
      <th>MSE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Model_1</td>
      <td>FEDFUNDS</td>
      <td>0.285734</td>
      <td>0.284296</td>
      <td>0.073824</td>
      <td>0.271706</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Model_2</td>
      <td>const, FEDFUNDS</td>
      <td>0.285602</td>
      <td>0.284162</td>
      <td>0.073943</td>
      <td>0.271925</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Model_3</td>
      <td>GS10</td>
      <td>0.528954</td>
      <td>0.528007</td>
      <td>0.048686</td>
      <td>0.220649</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Model_4</td>
      <td>GS10, FEDFUNDS</td>
      <td>0.621400</td>
      <td>0.619873</td>
      <td>0.039210</td>
      <td>0.198015</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Model_5</td>
      <td>GS10, FEDFUNDS, UNRATE</td>
      <td>0.621597</td>
      <td>0.619304</td>
      <td>0.039269</td>
      <td>0.198163</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 2: In-Sample Forecast First Difference</strong></p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_sample_forecast(models, observed_data, separate_subplots<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the observed data and dates</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> observed_data</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> observed_data.index</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> separate_subplots:</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the number of rows and columns for the subplots</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>        n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>        n_rows <span class="op">=</span> n_models <span class="op">//</span> n_cols <span class="op">+</span> (n_models <span class="op">%</span> n_cols <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.ravel()</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data and in-sample predictions for each model</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> axes[i]</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> model.model.exog</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, ax<span class="op">=</span>ax)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the independent variable names</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>            ind_var_names <span class="op">=</span> <span class="st">', '</span>.join(model.model.exog_names)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>ind_var_names<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>            ax.legend()</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove unused subplots</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, n_rows <span class="op">*</span> n_cols):</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>            fig.delaxes(axes[j])</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>        fig.text(<span class="fl">0.04</span>, <span class="fl">0.5</span>, <span class="st">'Value'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="st">'vertical'</span>)</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>)</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the in-sample predictions for each model</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> model.model.exog</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Observed Data and In-sample Predictions'</span>)</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_1, model_2, model_3, model_4, model_5]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>observed_data <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>in_sample_forecast(models, observed_data, separate_subplots<span class="op">=</span><span class="va">True</span>)  <span class="co"># For separate subplots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 3: In-Sample Forecast Levels</strong></p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_sample_forecast_levels(models, original_data, diff_data, separate_subplots<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the observed data (levels) and dates</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> original_data</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> original_data.index</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> separate_subplots:</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the number of rows and columns for the subplots</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        n_rows <span class="op">=</span> n_models <span class="op">//</span> n_cols <span class="op">+</span> (n_models <span class="op">%</span> n_cols <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.ravel()</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data (levels) and in-sample predictions for each model</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> axes[i]</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> model.model.exog</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>            y_diff_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> np.concatenate(([y.iloc[<span class="dv">0</span>]], y.iloc[<span class="dv">0</span>] <span class="op">+</span> np.cumsum(y_diff_pred)))</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, ax<span class="op">=</span>ax)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the independent variable names</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>            ind_var_names <span class="op">=</span> <span class="st">', '</span>.join(model.model.exog_names)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>ind_var_names<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>            ax.legend()</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove unused subplots</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, n_rows <span class="op">*</span> n_cols):</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>            fig.delaxes(axes[j])</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>        fig.text(<span class="fl">0.5</span>, <span class="fl">0.04</span>, <span class="st">'DATE'</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>        fig.text(<span class="fl">0.04</span>, <span class="fl">0.5</span>, <span class="st">'Value'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="st">'vertical'</span>)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data (levels)</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>)</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the in-sample predictions for each model</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> model.model.exog</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>            y_diff_pred <span class="op">=</span> model.predict(X)</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> np.concatenate(([y.iloc[<span class="dv">0</span>]], y.iloc[<span class="dv">0</span>] <span class="op">+</span> np.cumsum(y_diff_pred)))</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'Model_</span><span class="sc">{</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'DATE'</span>)</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Observed Data and In-sample Predictions (Levels)'</span>)</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_1, model_2, model_3, model_4, model_5]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>original_data <span class="op">=</span> df_train[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>diff_data <span class="op">=</span> df_train_diff[<span class="st">'MORTGAGE30US'</span>]</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>in_sample_forecast_levels(models, original_data, diff_data, separate_subplots<span class="op">=</span><span class="va">False</span>)  <span class="co"># For a single plot with all series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="model-evaluation-1" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-1">4.6. Model Evaluation</h2>
<section id="out-of-sample-analysis" class="level3">
<h3 class="anchored" data-anchor-id="out-of-sample-analysis">4.6.1. Out-of-Sample Analysis</h3>
<section id="out-of-sample-performance" class="level4">
<h4 class="anchored" data-anchor-id="out-of-sample-performance">Out-of-Sample Performance</h4>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> out_of_sample_performance(model_list, model_names, test_data, target_col):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize a list to store results</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fitted_model, model_name <span class="kw">in</span> <span class="bu">zip</span>(model_list, model_names):</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the column names of the independent variables from the model</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        independent_vars <span class="op">=</span> fitted_model.model.exog_names</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Separate the target variable and features in the test dataset</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        X_test <span class="op">=</span> test_data[independent_vars]</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        y_test <span class="op">=</span> test_data[target_col]</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict the test data</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> fitted_model.predict(X_test)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the residuals</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        residuals <span class="op">=</span> y_test <span class="op">-</span> y_pred</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the mean squared error and root mean squared error</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        mse <span class="op">=</span> np.mean(residuals <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>        rmse_val <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store the results</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>        model_name_with_vars <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(independent_vars)<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        results.append([model_name_with_vars, mse, rmse_val])</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame to display the results</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results, columns<span class="op">=</span>[<span class="st">'Model'</span>, <span class="st">'MSE'</span>, <span class="st">'RMSE'</span>])</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model_list <span class="op">=</span> [model_3, model_4]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [<span class="st">'model_3'</span>, <span class="st">'model_4'</span>]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> out_of_sample_performance(model_list, model_names<span class="op">=</span>model_names, test_data<span class="op">=</span>df_test_diff, target_col<span class="op">=</span><span class="st">'MORTGAGE30US'</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>display(results_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Model</th>
      <th>MSE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>model_3 (GS10)</td>
      <td>0.024310</td>
      <td>0.155916</td>
    </tr>
    <tr>
      <th>1</th>
      <td>model_4 (GS10, FEDFUNDS)</td>
      <td>0.027384</td>
      <td>0.165482</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="out-of-sample-forecast" class="level4">
<h4 class="anchored" data-anchor-id="out-of-sample-forecast">Out-of-Sample Forecast</h4>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> out_of_sample_forecast(models, model_names, test_data, target_col, separate_subplots<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the observed data and dates</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> test_data[target_col]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> test_data.index</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> separate_subplots:</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the number of rows and columns for the subplots</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>        n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>        n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>        n_rows <span class="op">=</span> n_models <span class="op">//</span> n_cols <span class="op">+</span> (n_models <span class="op">%</span> n_cols <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.ravel()</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data and out-of-sample predictions for each model</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> axes[i]</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>            exog_names <span class="op">=</span> model.model.exog_names</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'const'</span> <span class="kw">in</span> exog_names <span class="kw">and</span> <span class="st">'const'</span> <span class="kw">not</span> <span class="kw">in</span> test_data.columns:</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[[name <span class="cf">for</span> name <span class="kw">in</span> exog_names <span class="cf">if</span> name <span class="op">!=</span> <span class="st">'const'</span>]]</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>                X_test.insert(<span class="dv">0</span>, <span class="st">'const'</span>, <span class="dv">1</span>)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[exog_names]</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, ax<span class="op">=</span>ax)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="st">", "</span><span class="sc">.</span>join(exog_names)<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>            ax.legend()</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove unused subplots</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, n_rows <span class="op">*</span> n_cols):</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>            fig.delaxes(axes[j])</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>        fig.text(<span class="fl">0.04</span>, <span class="fl">0.5</span>, <span class="st">'Value'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="st">'vertical'</span>)</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>)</span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the out-of-sample predictions for each model</span></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>            exog_names <span class="op">=</span> model.model.exog_names</span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'const'</span> <span class="kw">in</span> exog_names <span class="kw">and</span> <span class="st">'const'</span> <span class="kw">not</span> <span class="kw">in</span> test_data.columns:</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[[name <span class="cf">for</span> name <span class="kw">in</span> exog_names <span class="cf">if</span> name <span class="op">!=</span> <span class="st">'const'</span>]]</span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>                X_test.insert(<span class="dv">0</span>, <span class="st">'const'</span>, <span class="dv">1</span>)</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[exog_names]</span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Observed Data and Out-of-sample Predictions'</span>)</span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_3, model_4]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>out_of_sample_forecast(models, model_names<span class="op">=</span>[<span class="st">'model_3'</span>, <span class="st">'model_4'</span>], test_data<span class="op">=</span>df_test_diff, target_col<span class="op">=</span><span class="st">'MORTGAGE30US'</span>, separate_subplots<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> out_of_sample_forecast_levels(models, model_names, test_data, original_data, target_col, separate_subplots<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the observed data and dates</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> test_data[target_col]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    y_orig <span class="op">=</span> original_data[original_data.index.isin(test_data.index)][target_col]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> y_orig.index</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"darkgrid"</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> separate_subplots:</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the number of rows and columns for the subplots</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        n_models <span class="op">=</span> <span class="bu">len</span>(models)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        n_cols <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        n_rows <span class="op">=</span> n_models <span class="op">//</span> n_cols <span class="op">+</span> (n_models <span class="op">%</span> n_cols <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> axes.ravel()</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data and out-of-sample predictions for each model</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> axes[i]</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_orig, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>            exog_names <span class="op">=</span> model.model.exog_names</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'const'</span> <span class="kw">in</span> exog_names <span class="kw">and</span> <span class="st">'const'</span> <span class="kw">not</span> <span class="kw">in</span> test_data.columns:</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[[name <span class="cf">for</span> name <span class="kw">in</span> exog_names <span class="cf">if</span> name <span class="op">!=</span> <span class="st">'const'</span>]]</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>                X_test.insert(<span class="dv">0</span>, <span class="st">'const'</span>, <span class="dv">1</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[exog_names]</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>            y_pred_diff <span class="op">=</span> model.predict(X_test)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> y_pred_diff <span class="op">+</span> y_orig.shift(<span class="dv">1</span>).values</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, ax<span class="op">=</span>ax)</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="st">", "</span><span class="sc">.</span>join(exog_names)<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>            ax.legend()</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove unused subplots</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, n_rows <span class="op">*</span> n_cols):</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>            fig.delaxes(axes[j])</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>        fig.text(<span class="fl">0.04</span>, <span class="fl">0.5</span>, <span class="st">'Value'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="st">'vertical'</span>)</span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set up the plot</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the observed data</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_orig, label<span class="op">=</span><span class="st">'Observed'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'lightgrey'</span>)</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the out-of-sample predictions for each model</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models):</span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>            exog_names <span class="op">=</span> model.model.exog_names</span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'const'</span> <span class="kw">in</span> exog_names <span class="kw">and</span> <span class="st">'const'</span> <span class="kw">not</span> <span class="kw">in</span> test_data.columns:</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[[name <span class="cf">for</span> name <span class="kw">in</span> exog_names <span class="cf">if</span> name <span class="op">!=</span> <span class="st">'const'</span>]]</span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>                X_test.insert(<span class="dv">0</span>, <span class="st">'const'</span>, <span class="dv">1</span>)</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>                X_test <span class="op">=</span> test_data[exog_names]</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>            y_pred_diff <span class="op">=</span> model.predict(X_test)</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> y_pred_diff <span class="op">+</span> y_orig.shift(<span class="dv">1</span>).values</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a>            sns.lineplot(x<span class="op">=</span>x, y<span class="op">=</span>y_pred, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model_names[i]<span class="sc">}</span><span class="ss">'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Customize the plot</span></span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Value'</span>)</span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Observed Data and Out-of-sample Predictions'</span>)</span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_3, model_4]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [<span class="st">'model_3'</span>, <span class="st">'model_4'</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>original_data <span class="op">=</span> df_test</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>out_of_sample_forecast_levels(models, model_names, test_data<span class="op">=</span>df_test_diff, original_data<span class="op">=</span>original_data, target_col<span class="op">=</span><span class="st">'MORTGAGE30US'</span>, separate_subplots<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="loan_rates_forecast_poc_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="forecast-performance" class="level3">
<h3 class="anchored" data-anchor-id="forecast-performance">4.6.2. Forecast Performance</h3>
<section id="one-step-ahead-forecast" class="level4">
<h4 class="anchored" data-anchor-id="one-step-ahead-forecast">One-Step Ahead Forecast</h4>
</section>
<section id="five-step-ahead-forecast" class="level4">
<h4 class="anchored" data-anchor-id="five-step-ahead-forecast">Five-Step Ahead Forecast</h4>
</section>
</section>
<section id="scenario-analysis" class="level3">
<h3 class="anchored" data-anchor-id="scenario-analysis">4.6.3. Scenario Analysis</h3>
<section id="parallel-interest-rates-shocks" class="level4">
<h4 class="anchored" data-anchor-id="parallel-interest-rates-shocks">Parallel Interest Rates Shocks</h4>
</section>
</section>
<section id="stress-testing" class="level3">
<h3 class="anchored" data-anchor-id="stress-testing">4.6.4. Stress Testing</h3>
</section>
<section id="uncertainty-analysis" class="level3">
<h3 class="anchored" data-anchor-id="uncertainty-analysis">4.6.5. Uncertainty Analysis</h3>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><em>Â© Copyright 2023 ValidMind Inc All Rights Reserved.</em></div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/validmind/documentation">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/validmind/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>