<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ValidMind â€“ cre_rate_model_offvm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../validmind.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../guide/ValidMind-logo-color.svg" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../guide/overview.html">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/guide.html">
 <span class="menu-text">Guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/developers.html">
 <span class="menu-text">Developers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/faq.html">
 <span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/support.html">
 <span class="menu-text">Support</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cremf-mortgage-rate-model-off-validmind" id="toc-cremf-mortgage-rate-model-off-validmind" class="nav-link active" data-scroll-target="#cremf-mortgage-rate-model-off-validmind">CRE/MF Mortgage Rate Model Off-ValidMind</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a>
  <ul class="collapse">
  <li><a href="#visual-inspection" id="toc-visual-inspection" class="nav-link" data-scroll-target="#visual-inspection">Visual Inspection</a></li>
  </ul></li>
  <li><a href="#model-development" id="toc-model-development" class="nav-link" data-scroll-target="#model-development">4. Model Development</a></li>
  <li><a href="#development-data-and-platform" id="toc-development-data-and-platform" class="nav-link" data-scroll-target="#development-data-and-platform">4.1. Development Data and Platform</a>
  <ul class="collapse">
  <li><a href="#data-quality-and-relevance" id="toc-data-quality-and-relevance" class="nav-link" data-scroll-target="#data-quality-and-relevance">4.1.2. Data Quality and Relevance</a></li>
  <li><a href="#data-process-adjustments-and-treatment" id="toc-data-process-adjustments-and-treatment" class="nav-link" data-scroll-target="#data-process-adjustments-and-treatment">4.1.3. Data Process, Adjustments and Treatment</a></li>
  <li><a href="#c.-seasonality-analysis" id="toc-c.-seasonality-analysis" class="nav-link" data-scroll-target="#c.-seasonality-analysis">C. Seasonality Analysis</a></li>
  </ul></li>
  <li><a href="#methodology-selection-and-development" id="toc-methodology-selection-and-development" class="nav-link" data-scroll-target="#methodology-selection-and-development">4.2. Methodology Selection and Development</a>
  <ul class="collapse">
  <li><a href="#variable-analysis" id="toc-variable-analysis" class="nav-link" data-scroll-target="#variable-analysis">4.2.4 Variable Analysis</a></li>
  <li><a href="#a.1.-univariate-analysis" id="toc-a.1.-univariate-analysis" class="nav-link" data-scroll-target="#a.1.-univariate-analysis">A.1. Univariate Analysis</a>
  <ul class="collapse">
  <li><a href="#visual-inspection-1" id="toc-visual-inspection-1" class="nav-link" data-scroll-target="#visual-inspection-1"><strong>Visual Inspection</strong></a></li>
  </ul></li>
  <li><a href="#a.2-multivariave-analysis" id="toc-a.2-multivariave-analysis" class="nav-link" data-scroll-target="#a.2-multivariave-analysis">A.2 Multivariave Analysis</a>
  <ul class="collapse">
  <li><a href="#visual-inspection-2" id="toc-visual-inspection-2" class="nav-link" data-scroll-target="#visual-inspection-2"><strong>Visual Inspection</strong></a></li>
  </ul></li>
  <li><a href="#b.-variable-selection" id="toc-b.-variable-selection" class="nav-link" data-scroll-target="#b.-variable-selection">B. Variable Selection</a></li>
  <li><a href="#b.1-selection-process" id="toc-b.1-selection-process" class="nav-link" data-scroll-target="#b.1-selection-process">B.1 Selection Process</a>
  <ul class="collapse">
  <li><a href="#arima-analysis" id="toc-arima-analysis" class="nav-link" data-scroll-target="#arima-analysis"><strong>ARIMA Analysis</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/validmind/documentation/blob/main/site/notebooks/time_series/cre_rate_model_offvm.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/validmind/documentation/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="cremf-mortgage-rate-model-off-validmind" class="level1">
<h1>CRE/MF Mortgage Rate Model Off-ValidMind</h1>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data libraries </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> missingno <span class="im">as</span> msno</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ML libraries</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> argmax</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> kpss</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch.unitroot <span class="im">import</span> PhillipsPerron</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch.unitroot <span class="im">import</span> ZivotAndrews</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> arch.unitroot <span class="im">import</span> DFGLS</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> pacf, acf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> lilliefors</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.stattools <span class="im">import</span> durbin_watson</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> acorr_ljungbox</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.sandbox.stats.runs <span class="im">import</span> runstest_1samp</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting libraries</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.gridspec <span class="im">as</span> gridspec</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.gofplots <span class="im">import</span> qqplot</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level1">
<h1>Load Data</h1>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"../datasets/lending_club_loan_rates.csv"</span>, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'Unnamed: 0'</span>: <span class="st">'Date'</span>})</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(pd.to_datetime(df[<span class="st">'Date'</span>]))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">"Date"</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_rate_A</th>
      <th>loan_rate_B</th>
      <th>loan_rate_C</th>
      <th>loan_rate_D</th>
      <th>FEDFUNDS</th>
      <th>diff1_loan_rate_A</th>
      <th>diff1_loan_rate_B</th>
      <th>diff1_loan_rate_C</th>
      <th>diff1_loan_rate_D</th>
      <th>diff1_FEDFUNDS</th>
      <th>diff2_FEDFUNDS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-08-01</th>
      <td>7.766667</td>
      <td>9.497692</td>
      <td>10.947500</td>
      <td>12.267000</td>
      <td>5.02</td>
      <td>0.060000</td>
      <td>0.134359</td>
      <td>0.207500</td>
      <td>-0.467444</td>
      <td>-0.24</td>
      <td>-0.25</td>
    </tr>
    <tr>
      <th>2007-09-01</th>
      <td>7.841429</td>
      <td>9.276667</td>
      <td>10.829167</td>
      <td>12.436667</td>
      <td>4.94</td>
      <td>0.074762</td>
      <td>-0.221026</td>
      <td>-0.118333</td>
      <td>0.169667</td>
      <td>-0.08</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>2007-10-01</th>
      <td>7.830000</td>
      <td>9.433333</td>
      <td>10.825926</td>
      <td>12.737368</td>
      <td>4.76</td>
      <td>-0.011429</td>
      <td>0.156667</td>
      <td>-0.003241</td>
      <td>0.300702</td>
      <td>-0.18</td>
      <td>-0.10</td>
    </tr>
    <tr>
      <th>2007-11-01</th>
      <td>7.779091</td>
      <td>9.467778</td>
      <td>10.967037</td>
      <td>12.609444</td>
      <td>4.49</td>
      <td>-0.050909</td>
      <td>0.034444</td>
      <td>0.141111</td>
      <td>-0.127924</td>
      <td>-0.27</td>
      <td>-0.09</td>
    </tr>
    <tr>
      <th>2007-12-01</th>
      <td>7.695833</td>
      <td>9.387500</td>
      <td>10.805000</td>
      <td>12.478889</td>
      <td>4.24</td>
      <td>-0.083258</td>
      <td>-0.080278</td>
      <td>-0.162037</td>
      <td>-0.130556</td>
      <td>-0.25</td>
      <td>0.02</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="visual-inspection" class="level3">
<h3 class="anchored" data-anchor-id="visual-inspection">Visual Inspection</h3>
<p>Time Series Plots.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FEDFUNDS plot</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.figsize"</span>: (<span class="dv">15</span>, <span class="dv">5</span>)})</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>df[<span class="st">"FEDFUNDS"</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"FEDFUNDS"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Rate"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Loan rates plot</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>loan_rates <span class="op">=</span> df[[<span class="st">"loan_rate_A"</span>, <span class="st">"loan_rate_B"</span>, <span class="st">"loan_rate_C"</span>, <span class="st">"loan_rate_D"</span>]]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.figsize"</span>: (<span class="dv">15</span>, <span class="dv">5</span>)})</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>loan_rates)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Loan Rates"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Rate"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Diff loan rates plot</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>diff_loan_rates <span class="op">=</span> df[[<span class="st">"diff1_loan_rate_A"</span>, <span class="st">"diff1_loan_rate_B"</span>, <span class="st">"diff1_loan_rate_C"</span>, <span class="st">"diff1_loan_rate_D"</span>]]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.figsize"</span>: (<span class="dv">15</span>, <span class="dv">5</span>)})</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>diff_loan_rates)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diff Loan Rates"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Rate"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-4-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="model-development" class="level1">
<h1>4. Model Development</h1>
</section>
<section id="development-data-and-platform" class="level1">
<h1>4.1. Development Data and Platform</h1>
<section id="data-quality-and-relevance" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-and-relevance">4.1.2. Data Quality and Relevance</h2>
</section>
<section id="data-process-adjustments-and-treatment" class="level2">
<h2 class="anchored" data-anchor-id="data-process-adjustments-and-treatment">4.1.3. Data Process, Adjustments and Treatment</h2>
<p>## A. Missing Values Analysis</p>
<p><strong>Step 1: Calculate the percentage of missing values in each column</strong></p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> df.isnull().<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>missing_values_df <span class="op">=</span> pd.DataFrame({<span class="st">"column_name"</span>: missing_values.index, <span class="st">"missing_percentage"</span>: missing_values.values})</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>missing_values_df <span class="op">=</span> missing_values_df.sort_values(<span class="st">"missing_percentage"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2: Display the missing values percentage in a table format</strong></p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>display(missing_values_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>column_name</th>
      <th>missing_percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>loan_rate_A</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>loan_rate_B</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>loan_rate_C</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>loan_rate_D</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FEDFUNDS</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>diff1_loan_rate_A</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>diff1_loan_rate_B</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>diff1_loan_rate_C</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>diff1_loan_rate_D</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>diff1_FEDFUNDS</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>diff2_FEDFUNDS</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 3: Visualize the missing values</strong></p>
<p>Create a bar plot to show the missing values percentage per column.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">"missing_percentage"</span>, y<span class="op">=</span><span class="st">"column_name"</span>, data<span class="op">=</span>missing_values_df, orient<span class="op">=</span><span class="st">"h"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Percentage of Missing Values per Column"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Percentage"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Column Name"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Create a matrix plot to show the pattern of missing values in the dataset.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>msno.matrix(df)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Missing Values Matrix"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1000x600 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 4: Analyze the patterns of missing values</strong></p>
<p>Based on the bar plot and matrix plot, analyze if the missing values are random or if there are specific patterns in the data.</p>
<p><strong>Step 5: Handle missing values</strong></p>
<p>Based on the analysis, decide how to handle the missing values.</p>
<p>## B. Outliers Analysis</p>
<p><strong>Step 1: Visualize the dataset using box plots</strong></p>
<p>Visualize the data using box plots to get an initial sense of the presence of outliers.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for loan rates</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>loan_rates <span class="op">=</span> df[[<span class="st">"loan_rate_A"</span>, <span class="st">"loan_rate_B"</span>, <span class="st">"loan_rate_C"</span>, <span class="st">"loan_rate_D"</span>]]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.figsize"</span>: (<span class="dv">10</span>, <span class="dv">5</span>)})</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>loan_rates)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Box Plots of Loan Rates"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Loan Rates"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for FEDFUNDS and diff FEDFUNDS</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df[<span class="st">"FEDFUNDS"</span>], ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Box Plot of FEDFUNDS"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"FEDFUNDS"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Values"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df[<span class="st">"diff1_FEDFUNDS"</span>], ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Box Plot of Diff FEDFUNDS"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Diff FEDFUNDS"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Values"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for diff loan rates</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>diff_loan_rates <span class="op">=</span> df[[<span class="st">"diff1_loan_rate_A"</span>, <span class="st">"diff1_loan_rate_B"</span>, <span class="st">"diff1_loan_rate_C"</span>, <span class="st">"diff1_loan_rate_D"</span>]]</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.figsize"</span>: (<span class="dv">10</span>, <span class="dv">5</span>)})</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>diff_loan_rates)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Box Plots of Diff Loan Rates"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Diff Loan Rates"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-9-output-3.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 2: Calculate Z-scores</strong></p>
<p>Calculate the Z-scores for each column in your dataset to identify data points that are far from the mean.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>z_scores <span class="op">=</span> np.<span class="bu">abs</span>(stats.zscore(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 3: Set a threshold and identify outliers</strong></p>
<p>Set a threshold (e.g., 3) to identify data points with Z-scores higher than the threshold.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> np.where(z_scores <span class="op">&gt;</span> threshold)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>outliers_df <span class="op">=</span> pd.DataFrame({<span class="st">"row"</span>: outliers[<span class="dv">0</span>], <span class="st">"column"</span>: outliers[<span class="dv">1</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 4: Analyze the outliers</strong></p>
<p>Analyze the outliers by looking at their frequency, index, and corresponding column.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>outliers_count <span class="op">=</span> outliers_df.groupby([<span class="st">"row"</span>, <span class="st">"column"</span>]).size().reset_index(name<span class="op">=</span><span class="st">"count"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>outliers_info <span class="op">=</span> outliers_count.merge(outliers_df, on<span class="op">=</span>[<span class="st">"row"</span>, <span class="st">"column"</span>], how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the column names and dates to the outliers_info DataFrame</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>outliers_info[<span class="st">"column_name"</span>] <span class="op">=</span> outliers_info[<span class="st">"column"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: df.columns[x])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>outliers_info[<span class="st">"date"</span>] <span class="op">=</span> outliers_info[<span class="st">"row"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: df.index[x])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder, sort by column_name, and display the DataFrame</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>outliers_info <span class="op">=</span> outliers_info[[<span class="st">"date"</span>, <span class="st">"column_name"</span>, <span class="st">"count"</span>]].sort_values(by<span class="op">=</span><span class="st">"column_name"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>display(outliers_info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th>column_name</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2007-08-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2007-09-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2007-10-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2007-11-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2007-12-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2008-01-01</td>
      <td>FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2008-10-01</td>
      <td>diff1_FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2008-11-01</td>
      <td>diff1_FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2008-02-01</td>
      <td>diff1_FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2010-10-01</td>
      <td>diff1_loan_rate_A</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2008-10-01</td>
      <td>diff1_loan_rate_A</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2008-12-01</td>
      <td>diff1_loan_rate_A</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2010-02-01</td>
      <td>diff1_loan_rate_A</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2010-11-01</td>
      <td>diff1_loan_rate_A</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2010-02-01</td>
      <td>diff1_loan_rate_B</td>
      <td>1</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2010-11-01</td>
      <td>diff1_loan_rate_B</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2011-05-01</td>
      <td>diff1_loan_rate_B</td>
      <td>1</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2013-07-01</td>
      <td>diff1_loan_rate_C</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2010-11-01</td>
      <td>diff1_loan_rate_C</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2011-05-01</td>
      <td>diff1_loan_rate_C</td>
      <td>1</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2012-03-01</td>
      <td>diff1_loan_rate_D</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2011-05-01</td>
      <td>diff1_loan_rate_D</td>
      <td>1</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2014-05-01</td>
      <td>diff1_loan_rate_D</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2008-10-01</td>
      <td>diff2_FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2008-02-01</td>
      <td>diff2_FEDFUNDS</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2008-03-01</td>
      <td>diff2_FEDFUNDS</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot for loan rates with outliers marked</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>loan_rates <span class="op">=</span> df[[<span class="st">"loan_rate_A"</span>, <span class="st">"loan_rate_B"</span>, <span class="st">"loan_rate_C"</span>, <span class="st">"loan_rate_D"</span>]]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>loan_rates_outliers <span class="op">=</span> outliers_info[outliers_info[<span class="st">"column_name"</span>].<span class="bu">str</span>.contains(<span class="st">"loan_rate"</span>)]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>loan_rates.plot(ax<span class="op">=</span>ax)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>loan_rates_outliers.<span class="bu">apply</span>(<span class="kw">lambda</span> x: ax.annotate(<span class="st">'Outlier'</span>, xy<span class="op">=</span>(x.date, df.loc[x.date][x.column_name]), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                                                fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'red'</span>, rotation<span class="op">=</span><span class="dv">45</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Time Series of Loan Rates with Outliers Marked"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot for FEDFUNDS with outliers marked</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>fed_funds_outliers <span class="op">=</span> outliers_info[outliers_info[<span class="st">"column_name"</span>] <span class="op">==</span> <span class="st">"FEDFUNDS"</span>]</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"FEDFUNDS"</span>].plot(ax<span class="op">=</span>ax)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>fed_funds_outliers.<span class="bu">apply</span>(<span class="kw">lambda</span> x: ax.annotate(<span class="st">'Outlier'</span>, xy<span class="op">=</span>(x.date, df.loc[x.date][<span class="st">"FEDFUNDS"</span>]), </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                                               fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'red'</span>, rotation<span class="op">=</span><span class="dv">45</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Time Series of FEDFUNDS with Outliers Marked"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot for diff loan rates with outliers marked</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>diff_loan_rates <span class="op">=</span> df[[<span class="st">"diff1_loan_rate_A"</span>, <span class="st">"diff1_loan_rate_B"</span>, <span class="st">"diff1_loan_rate_C"</span>, <span class="st">"diff1_loan_rate_D"</span>]]</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>diff_loan_rates_outliers <span class="op">=</span> outliers_info[outliers_info[<span class="st">"column_name"</span>].<span class="bu">str</span>.contains(<span class="st">"diff1_loan_rate"</span>)]</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>diff_loan_rates.plot(ax<span class="op">=</span>ax)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>diff_loan_rates_outliers.<span class="bu">apply</span>(<span class="kw">lambda</span> x: ax.annotate(<span class="st">'Outlier'</span>, xy<span class="op">=</span>(x.date, df.loc[x.date][x.column_name]), </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                                                     fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'red'</span>, rotation<span class="op">=</span><span class="dv">45</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Time Series of Diff Loan Rates with Outliers Marked"</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series plot for diff FEDFUNDS with outliers marked</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>diff_fed_funds_outliers <span class="op">=</span> outliers_info[outliers_info[<span class="st">"column_name"</span>] <span class="op">==</span> <span class="st">"diff1_FEDFUNDS"</span>]</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"diff1_FEDFUNDS"</span>].plot(ax<span class="op">=</span>ax)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>diff_fed_funds_outliers.<span class="bu">apply</span>(<span class="kw">lambda</span> x: ax.annotate(<span class="st">'Outlier'</span>, xy<span class="op">=</span>(x.date, df.loc[x.date][<span class="st">"diff1_FEDFUNDS"</span>]), </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                                                    fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'red'</span>, rotation<span class="op">=</span><span class="dv">45</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Time Series of Diff FEDFUNDS with Outliers Marked"</span>)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Values"</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-13-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-13-output-4.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="c.-seasonality-analysis" class="level2">
<h2 class="anchored" data-anchor-id="c.-seasonality-analysis">C. Seasonality Analysis</h2>
<p><strong>Step 1: Seasonal decomposition</strong></p>
<p>Perform seasonal decomposition on each time series.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> <span class="dv">12</span>  <span class="co"># Assuming monthly data, adjust the frequency accordingly</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>loan_rate_decompositions <span class="op">=</span> {}</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> loan_rates.columns:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    loan_rate_decompositions[col] <span class="op">=</span> seasonal_decompose(df[col], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span>freq)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>fed_funds_decomposition <span class="op">=</span> seasonal_decompose(df[<span class="st">"FEDFUNDS"</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span>freq)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>diff_loan_rate_decompositions <span class="op">=</span> {}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> diff_loan_rates.columns:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    diff_loan_rate_decompositions[col] <span class="op">=</span> seasonal_decompose(df[col], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span>freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2: Visualize seasonal decomposition</strong></p>
<p>Create plots for seasonal components.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_decomposition_components(series_decompositions, title):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(series_decompositions)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span>n, ncols<span class="op">=</span><span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">3</span> <span class="op">*</span> n))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> [axes]  <span class="co"># Make sure axes is a list even when there's only one subplot</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row_axes, (col, decomposition) <span class="kw">in</span> <span class="bu">zip</span>(axes, series_decompositions.items()):</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ax, component, comp_title <span class="kw">in</span> <span class="bu">zip</span>(row_axes, [decomposition.observed, decomposition.trend, decomposition.seasonal, decomposition.resid],</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                            [<span class="st">"Observed"</span>, <span class="st">"Trend"</span>, <span class="st">"Seasonal"</span>, <span class="st">"Residual"</span>]):</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            component.plot(ax<span class="op">=</span>ax)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f"</span><span class="sc">{</span>comp_title<span class="sc">}</span><span class="ss"> Component of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            ax.set_ylabel(<span class="st">"Values"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(title, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>plot_decomposition_components(loan_rate_decompositions, <span class="st">"Decomposition of Loan Rates"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>plot_decomposition_components({<span class="st">"FEDFUNDS"</span>: fed_funds_decomposition}, <span class="st">"Decomposition of FEDFUNDS"</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>plot_decomposition_components(diff_loan_rate_decompositions, <span class="st">"Decomposition of Diff Loan Rates and Diff FEDFUNDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-15-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Create ACF plots.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>all_variables <span class="op">=</span> [df[<span class="st">'loan_rate_A'</span>], df[<span class="st">'loan_rate_B'</span>], df[<span class="st">'loan_rate_C'</span>], df[<span class="st">'loan_rate_D'</span>], df[<span class="st">'FEDFUNDS'</span>], </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                 df[<span class="st">'diff1_loan_rate_A'</span>], df[<span class="st">'diff1_loan_rate_B'</span>], df[<span class="st">'diff1_loan_rate_C'</span>], df[<span class="st">'diff1_loan_rate_D'</span>], </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                 df[<span class="st">'diff1_FEDFUNDS'</span>], df[<span class="st">'diff2_FEDFUNDS'</span>]]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with subplots</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">11</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">4</span><span class="op">*</span><span class="dv">11</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ACF for each variable</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, variable <span class="kw">in</span> <span class="bu">enumerate</span>(all_variables):</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    plot_acf(variable, ax<span class="op">=</span>ax[i], lags<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="st">"ACF Plot for </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(variable.name))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout of the subplots</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Step 3: Residuals Analysis</strong></p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to perform residual analysis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residual_analysis(residuals, variable_name):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    residuals <span class="op">=</span> residuals.dropna()  <span class="co"># drop NaN values</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> ax.flatten()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># QQ plot</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    qqplot(residuals, line<span class="op">=</span><span class="st">'s'</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].set_title(<span class="ss">f'QQ Plot of Residuals (</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Histogram with KDE</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    sns.distplot(residuals, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>].set_title(<span class="ss">f'Histogram with KDE of Residuals (</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Residual series dot plot</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(data<span class="op">=</span>residuals, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'red'</span>, ax<span class="op">=</span>ax[<span class="dv">2</span>])</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">2</span>].set_title(<span class="ss">f'Residual Series Dot Plot (</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ACF plot</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    plot_acf(residuals, ax<span class="op">=</span>ax[<span class="dv">3</span>], lags<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">3</span>].set_title(<span class="ss">f'ACF Plot of Residuals (</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform residual analysis for each variable</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> loan_rate_decompositions.keys():</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    residual_analysis(loan_rate_decompositions[variable_name].resid, variable_name)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform residual analysis for FEDFUNDS</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>residual_analysis(fed_funds_decomposition.resid, <span class="st">"FEDFUNDS"</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform residual analysis for each difference variable</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> diff_loan_rate_decompositions.keys():</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    residual_analysis(diff_loan_rate_decompositions[variable_name].resid, variable_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-14.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-16.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="cre_rate_model_offvm_files/figure-html/cell-17-output-18.png" class="img-fluid"></p>
</div>
</div>
<p>Test if Residuals are Normaly Distributed.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Nan values before computing any test statistics.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> loan_rates.columns:</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    loan_rate_decompositions[col].trend.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    loan_rate_decompositions[col].seasonal.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    loan_rate_decompositions[col].resid.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>fed_funds_decomposition.trend.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>fed_funds_decomposition.seasonal.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>fed_funds_decomposition.resid.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> diff_loan_rates.columns:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    diff_loan_rate_decompositions[col].trend.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    diff_loan_rate_decompositions[col].seasonal.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    diff_loan_rate_decompositions[col].resid.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_normality_statistics(data):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    ks_stat, ks_p <span class="op">=</span> stats.kstest(data, <span class="st">'norm'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    sw_stat, sw_p <span class="op">=</span> stats.shapiro(data)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    lf_stat, lf_p <span class="op">=</span> lilliefors(data)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    jb_stat, jb_p <span class="op">=</span> stats.jarque_bera(data)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Test"</span>: [</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Kolmogorov-Smirnov"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Shapiro-Wilk"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Lilliefors"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Jarque-Bera"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Statistic"</span>: [ks_stat, sw_stat, lf_stat, jb_stat],</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"P-value"</span>: [ks_p, sw_p, lf_p, jb_p],</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty DataFrame to store the results</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>normality_statistics_results <span class="op">=</span> pd.DataFrame()</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normality statistics for each variable</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> loan_rate_decompositions.keys():</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> loan_rate_decompositions[variable_name].resid</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    normality_stats <span class="op">=</span> compute_normality_statistics(data)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    normality_stats[<span class="st">"Variable"</span>] <span class="op">=</span> variable_name</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    normality_statistics_results <span class="op">=</span> normality_statistics_results.append(normality_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normality statistics for FEDFUNDS</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> fed_funds_decomposition.resid</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>normality_stats <span class="op">=</span> compute_normality_statistics(data)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>normality_stats[<span class="st">"Variable"</span>] <span class="op">=</span> <span class="st">"FEDFUNDS"</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>normality_statistics_results <span class="op">=</span> normality_statistics_results.append(normality_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute normality statistics for each difference variable</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> diff_loan_rate_decompositions.keys():</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> diff_loan_rate_decompositions[variable_name].resid</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    normality_stats <span class="op">=</span> compute_normality_statistics(data)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    normality_stats[<span class="st">"Variable"</span>] <span class="op">=</span> variable_name</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    normality_statistics_results <span class="op">=</span> normality_statistics_results.append(normality_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_normality_statistics(normality_statistics_results, p_value_threshold<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a Pass/Fail column based on the p-value threshold</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    normality_statistics_results[<span class="st">'Pass/Fail'</span>] <span class="op">=</span> normality_statistics_results[<span class="st">'P-value'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> p: <span class="st">'Pass'</span> <span class="cf">if</span> p <span class="op">&gt;=</span> p_value_threshold <span class="cf">else</span> <span class="st">'Fail'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the results as a table</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    display(normality_statistics_results)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>test_normality_statistics(normality_statistics_results, p_value_threshold<span class="op">=</span><span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Test</th>
      <th>Statistic</th>
      <th>P-value</th>
      <th>Variable</th>
      <th>Pass/Fail</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.361205</td>
      <td>4.090343e-15</td>
      <td>loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Shapiro-Wilk</td>
      <td>0.964680</td>
      <td>2.367732e-03</td>
      <td>loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lilliefors</td>
      <td>0.090317</td>
      <td>2.188144e-02</td>
      <td>loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jarque-Bera</td>
      <td>22.683894</td>
      <td>1.186465e-05</td>
      <td>loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.316534</td>
      <td>1.237558e-11</td>
      <td>loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Shapiro-Wilk</td>
      <td>0.950467</td>
      <td>1.692832e-04</td>
      <td>loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lilliefors</td>
      <td>0.112750</td>
      <td>1.031154e-03</td>
      <td>loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Jarque-Bera</td>
      <td>24.607237</td>
      <td>4.535305e-06</td>
      <td>loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.343031</td>
      <td>1.229136e-13</td>
      <td>loan_rate_C</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Shapiro-Wilk</td>
      <td>0.992633</td>
      <td>7.564428e-01</td>
      <td>loan_rate_C</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Lilliefors</td>
      <td>0.047168</td>
      <td>7.618809e-01</td>
      <td>loan_rate_C</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Jarque-Bera</td>
      <td>0.206857</td>
      <td>9.017404e-01</td>
      <td>loan_rate_C</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.312985</td>
      <td>2.225322e-11</td>
      <td>loan_rate_D</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Shapiro-Wilk</td>
      <td>0.989167</td>
      <td>4.321428e-01</td>
      <td>loan_rate_D</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Lilliefors</td>
      <td>0.045615</td>
      <td>8.004312e-01</td>
      <td>loan_rate_D</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Jarque-Bera</td>
      <td>1.373671</td>
      <td>5.031658e-01</td>
      <td>loan_rate_D</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.430685</td>
      <td>1.396740e-21</td>
      <td>FEDFUNDS</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Shapiro-Wilk</td>
      <td>0.759088</td>
      <td>4.823187e-13</td>
      <td>FEDFUNDS</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Lilliefors</td>
      <td>0.191270</td>
      <td>1.000000e-03</td>
      <td>FEDFUNDS</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Jarque-Bera</td>
      <td>255.448548</td>
      <td>3.388852e-56</td>
      <td>FEDFUNDS</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.361380</td>
      <td>3.954988e-15</td>
      <td>diff1_loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Shapiro-Wilk</td>
      <td>0.943480</td>
      <td>5.220129e-05</td>
      <td>diff1_loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Lilliefors</td>
      <td>0.106437</td>
      <td>2.682603e-03</td>
      <td>diff1_loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Jarque-Bera</td>
      <td>32.392802</td>
      <td>9.246818e-08</td>
      <td>diff1_loan_rate_A</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.359857</td>
      <td>5.300637e-15</td>
      <td>diff1_loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Shapiro-Wilk</td>
      <td>0.893433</td>
      <td>5.663049e-08</td>
      <td>diff1_loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Lilliefors</td>
      <td>0.137282</td>
      <td>1.000000e-03</td>
      <td>diff1_loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Jarque-Bera</td>
      <td>122.026511</td>
      <td>3.178922e-27</td>
      <td>diff1_loan_rate_B</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.376455</td>
      <td>2.017554e-16</td>
      <td>diff1_loan_rate_C</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Shapiro-Wilk</td>
      <td>0.970360</td>
      <td>7.531957e-03</td>
      <td>diff1_loan_rate_C</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Lilliefors</td>
      <td>0.086871</td>
      <td>3.264423e-02</td>
      <td>diff1_loan_rate_C</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Jarque-Bera</td>
      <td>12.705219</td>
      <td>1.742195e-03</td>
      <td>diff1_loan_rate_C</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Kolmogorov-Smirnov</td>
      <td>0.331651</td>
      <td>9.369166e-13</td>
      <td>diff1_loan_rate_D</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Shapiro-Wilk</td>
      <td>0.926674</td>
      <td>4.010225e-06</td>
      <td>diff1_loan_rate_D</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Lilliefors</td>
      <td>0.110326</td>
      <td>1.665161e-03</td>
      <td>diff1_loan_rate_D</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Jarque-Bera</td>
      <td>104.263860</td>
      <td>2.287655e-23</td>
      <td>diff1_loan_rate_D</td>
      <td>Fail</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Test if Residuals are Autocorrelated.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_autocorrelation_statistics(data, lags<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    lb_results <span class="op">=</span> acorr_ljungbox(data, lags<span class="op">=</span>lags, return_df<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    lb_stat <span class="op">=</span> lb_results[<span class="st">'lb_stat'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    lb_p_value <span class="op">=</span> lb_results[<span class="st">'lb_pvalue'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    bp_results <span class="op">=</span> acorr_ljungbox(data, lags<span class="op">=</span>lags, boxpierce<span class="op">=</span><span class="va">True</span>, return_df<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    bp_stat <span class="op">=</span> bp_results[<span class="st">'lb_stat'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    bp_p_value <span class="op">=</span> bp_results[<span class="st">'lb_pvalue'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    runs_stat, runs_p_value <span class="op">=</span> runstest_1samp(data)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Test"</span>: [                <span class="st">"Ljung-Box"</span>,                <span class="st">"Runs Test"</span>,                <span class="st">"Box-Pierce Test"</span>,            ],</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Statistic"</span>: [                lb_stat,                runs_stat,                bp_stat,            ],</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"P-value"</span>: [                lb_p_value,                runs_p_value,                bp_p_value,            ],</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty DataFrame to store the results</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_statistics_results <span class="op">=</span> pd.DataFrame()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation statistics for each variable</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> loan_rate_decompositions.keys():</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> loan_rate_decompositions[variable_name].resid.dropna()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    autocorrelation_stats <span class="op">=</span> compute_autocorrelation_statistics(data)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    autocorrelation_stats[<span class="st">"Variable"</span>] <span class="op">=</span> variable_name</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    autocorrelation_statistics_results <span class="op">=</span> autocorrelation_statistics_results.append(autocorrelation_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation statistics for FEDFUNDS</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> fed_funds_decomposition.resid.dropna()</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>autocorrelation_stats <span class="op">=</span> compute_autocorrelation_statistics(data)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>autocorrelation_stats[<span class="st">"Variable"</span>] <span class="op">=</span> <span class="st">"FEDFUNDS"</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>autocorrelation_statistics_results <span class="op">=</span> autocorrelation_statistics_results.append(autocorrelation_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute autocorrelation statistics for each difference variable</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> variable_name <span class="kw">in</span> diff_loan_rate_decompositions.keys():</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> diff_loan_rate_decompositions[variable_name].resid.dropna()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    autocorrelation_stats <span class="op">=</span> compute_autocorrelation_statistics(data)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    autocorrelation_stats[<span class="st">"Variable"</span>] <span class="op">=</span> variable_name</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    autocorrelation_statistics_results <span class="op">=</span> autocorrelation_statistics_results.append(autocorrelation_stats, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>autocorrelation_statistics_results <span class="op">=</span> autocorrelation_statistics_results.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_autocorrelation_statistics(autocorrelation_statistics_results, p_value_threshold<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    autocorrelation_statistics_results[<span class="st">'Threshold'</span>] <span class="op">=</span> p_value_threshold</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    autocorrelation_statistics_results[<span class="st">'P-value'</span>] <span class="op">=</span> pd.to_numeric(autocorrelation_statistics_results[<span class="st">'P-value'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    autocorrelation_statistics_results[<span class="st">'Pass/Fail'</span>] <span class="op">=</span> autocorrelation_statistics_results[<span class="st">'P-value'</span>].<span class="bu">apply</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> p: <span class="st">'Pass'</span> <span class="cf">if</span> p <span class="op">&gt;=</span> p_value_threshold <span class="cf">else</span> <span class="st">'Fail'</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    display(autocorrelation_statistics_results)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>test_autocorrelation_statistics(autocorrelation_statistics_results, p_value_threshold<span class="op">=</span><span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Test</th>
      <th>Statistic</th>
      <th>P-value</th>
      <th>Variable</th>
      <th>Threshold</th>
      <th>Pass/Fail</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ljung-Box</td>
      <td>116.663720</td>
      <td>2.401553e-20</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Runs Test</td>
      <td>-5.648902</td>
      <td>1.614762e-08</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Box-Pierce Test</td>
      <td>116.663720</td>
      <td>2.401553e-20</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ljung-Box</td>
      <td>204.098406</td>
      <td>2.253253e-38</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Runs Test</td>
      <td>-6.375888</td>
      <td>1.819052e-10</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Box-Pierce Test</td>
      <td>204.098406</td>
      <td>2.253253e-38</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Ljung-Box</td>
      <td>125.601717</td>
      <td>3.678593e-22</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Runs Test</td>
      <td>-5.657398</td>
      <td>1.536855e-08</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Box-Pierce Test</td>
      <td>125.601717</td>
      <td>3.678593e-22</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Ljung-Box</td>
      <td>89.525260</td>
      <td>6.651950e-15</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Runs Test</td>
      <td>-6.008704</td>
      <td>1.870119e-09</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Box-Pierce Test</td>
      <td>89.525260</td>
      <td>6.651950e-15</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Ljung-Box</td>
      <td>169.890971</td>
      <td>2.922023e-31</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Runs Test</td>
      <td>-6.518261</td>
      <td>7.112729e-11</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Box-Pierce Test</td>
      <td>169.890971</td>
      <td>2.922023e-31</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Ljung-Box</td>
      <td>31.658078</td>
      <td>4.564856e-04</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Runs Test</td>
      <td>-0.934551</td>
      <td>3.500195e-01</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Box-Pierce Test</td>
      <td>31.658078</td>
      <td>4.564856e-04</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Ljung-Box</td>
      <td>94.434755</td>
      <td>7.038946e-16</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Runs Test</td>
      <td>-0.627961</td>
      <td>5.300294e-01</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Box-Pierce Test</td>
      <td>94.434755</td>
      <td>7.038946e-16</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Ljung-Box</td>
      <td>54.151940</td>
      <td>4.546097e-08</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Runs Test</td>
      <td>-3.261335</td>
      <td>1.108888e-03</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Box-Pierce Test</td>
      <td>54.151940</td>
      <td>4.546097e-08</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Ljung-Box</td>
      <td>32.703162</td>
      <td>3.054971e-04</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Runs Test</td>
      <td>-1.632116</td>
      <td>1.026551e-01</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Box-Pierce Test</td>
      <td>32.703162</td>
      <td>3.054971e-04</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 3: Test for seasonality using the Augmented Dickey-Fuller (ADF) test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 4: Analyze the seasonality test results</strong></p>
<p><strong>Step 5: Interpret the results</strong></p>
<p>Based on the p-values from the ADF test, you can infer whether the time series are stationary or not. If the p-value is less than 0.05 (or your chosen significance level), you can reject the null hypothesis and conclude that the series is stationary. Otherwise, you fail to reject the null hypothesis and cannot conclude that the series is stationary.</p>
<p><strong>Step 6: Handle seasonality</strong></p>
</section>
</section>
<section id="methodology-selection-and-development" class="level1">
<h1>4.2. Methodology Selection and Development</h1>
<section id="variable-analysis" class="level2">
<h2 class="anchored" data-anchor-id="variable-analysis">4.2.4 Variable Analysis</h2>
<p>## A. Feature Analysis</p>
</section>
<section id="a.1.-univariate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="a.1.-univariate-analysis">A.1. Univariate Analysis</h2>
<section id="visual-inspection-1" class="level3">
<h3 class="anchored" data-anchor-id="visual-inspection-1"><strong>Visual Inspection</strong></h3>
</section>
</section>
<section id="a.2-multivariave-analysis" class="level2">
<h2 class="anchored" data-anchor-id="a.2-multivariave-analysis">A.2 Multivariave Analysis</h2>
<section id="visual-inspection-2" class="level3">
<h3 class="anchored" data-anchor-id="visual-inspection-2"><strong>Visual Inspection</strong></h3>
</section>
</section>
<section id="b.-variable-selection" class="level2">
<h2 class="anchored" data-anchor-id="b.-variable-selection">B. Variable Selection</h2>
</section>
<section id="b.1-selection-process" class="level2">
<h2 class="anchored" data-anchor-id="b.1-selection-process">B.1 Selection Process</h2>
<section id="arima-analysis" class="level3">
<h3 class="anchored" data-anchor-id="arima-analysis"><strong>ARIMA Analysis</strong></h3>
<p><strong>Step 1: Stationarity Analysis</strong></p>
<p>The first step in any time series analysis is to visualize the data and check for stationarity. Stationarity is important because most time series models, including ARIMA, assume that the underlying data is stationary.</p>
<p>Unit Root Tests.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_unit_root_statistics(df):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> apply_tests(series):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ADF Test</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        adf_result <span class="op">=</span> adfuller(series)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        adf_test_stat <span class="op">=</span> adf_result[<span class="dv">0</span>]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        adf_p_value <span class="op">=</span> adf_result[<span class="dv">1</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># KPSS Test</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        kpss_result <span class="op">=</span> kpss(series, nlags<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        kpss_test_stat <span class="op">=</span> kpss_result[<span class="dv">0</span>]</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        kpss_p_value <span class="op">=</span> kpss_result[<span class="dv">1</span>]</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PP Test</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        pp <span class="op">=</span> PhillipsPerron(series)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        pp_test_stat <span class="op">=</span> pp.stat</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        pp_p_value <span class="op">=</span> pp.pvalue</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zivot-Andrews Test</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        za <span class="op">=</span> ZivotAndrews(series)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        za_test_stat <span class="op">=</span> za.stat</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        za_p_value <span class="op">=</span> za.pvalue</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series({</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ADF'</span>: adf_test_stat, <span class="st">'ADF p-value'</span>: adf_p_value,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'KPSS'</span>: kpss_test_stat, <span class="st">'KPSS p-value'</span>: kpss_p_value,</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'PP'</span>: pp_test_stat, <span class="st">'PP p-value'</span>: pp_p_value,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ZA'</span>: za_test_stat, <span class="st">'ZA p-value'</span>: za_p_value,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.<span class="bu">apply</span>(apply_tests)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>unit_root_statistics <span class="op">=</span> compute_unit_root_statistics(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2018: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is smaller than the p-value returned.

  warnings.warn(
/Users/andres/Library/Caches/pypoetry/virtualenvs/validmind-Jp3s24zK-py3.8/lib/python3.8/site-packages/statsmodels/tsa/stattools.py:2022: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  warnings.warn(</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>unit_root_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>loan_rate_A</th>
      <th>loan_rate_B</th>
      <th>loan_rate_C</th>
      <th>loan_rate_D</th>
      <th>FEDFUNDS</th>
      <th>diff1_loan_rate_A</th>
      <th>diff1_loan_rate_B</th>
      <th>diff1_loan_rate_C</th>
      <th>diff1_loan_rate_D</th>
      <th>diff1_FEDFUNDS</th>
      <th>diff2_FEDFUNDS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ADF</th>
      <td>-1.917289</td>
      <td>-3.159930</td>
      <td>-2.530667</td>
      <td>-1.617159</td>
      <td>-0.168543</td>
      <td>-1.031383e+01</td>
      <td>-8.632056e+00</td>
      <td>-8.618071e+00</td>
      <td>-4.103447e+00</td>
      <td>-3.632288</td>
      <td>-3.327780</td>
    </tr>
    <tr>
      <th>ADF p-value</th>
      <td>0.323972</td>
      <td>0.022424</td>
      <td>0.108190</td>
      <td>0.474219</td>
      <td>0.942169</td>
      <td>3.134761e-18</td>
      <td>5.720336e-14</td>
      <td>6.211940e-14</td>
      <td>9.558947e-04</td>
      <td>0.005173</td>
      <td>0.013681</td>
    </tr>
    <tr>
      <th>KPSS</th>
      <td>1.012357</td>
      <td>0.263073</td>
      <td>0.809961</td>
      <td>1.564146</td>
      <td>0.375746</td>
      <td>8.592937e-02</td>
      <td>1.514857e-01</td>
      <td>3.335876e-01</td>
      <td>1.887051e-01</td>
      <td>1.153749</td>
      <td>0.061353</td>
    </tr>
    <tr>
      <th>KPSS p-value</th>
      <td>0.010000</td>
      <td>0.100000</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.087609</td>
      <td>1.000000e-01</td>
      <td>1.000000e-01</td>
      <td>1.000000e-01</td>
      <td>1.000000e-01</td>
      <td>0.010000</td>
      <td>0.100000</td>
    </tr>
    <tr>
      <th>PP</th>
      <td>-2.027462</td>
      <td>-2.446084</td>
      <td>-2.264992</td>
      <td>-1.853613</td>
      <td>-3.970772</td>
      <td>-1.034179e+01</td>
      <td>-8.657786e+00</td>
      <td>-9.063228e+00</td>
      <td>-9.725544e+00</td>
      <td>-5.639326</td>
      <td>-21.677880</td>
    </tr>
    <tr>
      <th>PP p-value</th>
      <td>0.274663</td>
      <td>0.129150</td>
      <td>0.183507</td>
      <td>0.354187</td>
      <td>0.001572</td>
      <td>2.673442e-18</td>
      <td>4.915171e-14</td>
      <td>4.504048e-15</td>
      <td>9.295675e-17</td>
      <td>0.000001</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ZA</th>
      <td>-3.498670</td>
      <td>-5.246346</td>
      <td>-4.681009</td>
      <td>-4.566136</td>
      <td>-4.263683</td>
      <td>-1.068546e+01</td>
      <td>-8.970778e+00</td>
      <td>-9.255829e+00</td>
      <td>-4.753945e+00</td>
      <td>-5.147877</td>
      <td>-5.228518</td>
    </tr>
    <tr>
      <th>ZA p-value</th>
      <td>0.680477</td>
      <td>0.011857</td>
      <td>0.074135</td>
      <td>0.100013</td>
      <td>0.208163</td>
      <td>1.000000e-05</td>
      <td>1.000000e-05</td>
      <td>1.000000e-05</td>
      <td>6.055853e-02</td>
      <td>0.017935</td>
      <td>0.012958</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_unit_root_statistics(test_results, threshold<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    formatted_results <span class="op">=</span> []</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> test_results.columns:</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for test_name in ['ADF', 'KPSS', 'PP', 'ZA', 'DFGLS']:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> test_name <span class="kw">in</span> [<span class="st">'ADF'</span>, <span class="st">'KPSS'</span>, <span class="st">'PP'</span>, <span class="st">'ZA'</span>]:</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            test_stat <span class="op">=</span> test_results.loc[test_name, column]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>            p_value <span class="op">=</span> test_results.loc[<span class="ss">f'</span><span class="sc">{</span>test_name<span class="sc">}</span><span class="ss"> p-value'</span>, column]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>            pass_fail <span class="op">=</span> <span class="st">'Pass'</span> <span class="cf">if</span> p_value <span class="op">&gt;</span> threshold <span class="cf">else</span> <span class="st">'Fail'</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>            formatted_results.append({</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Test'</span>: test_name,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Statistic'</span>: test_stat,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">'P-value'</span>: p_value,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Variable'</span>: column,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Threshold'</span>: threshold,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Pass/Fail'</span>: pass_fail</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(formatted_results)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>formatted_results <span class="op">=</span> test_unit_root_statistics(unit_root_statistics)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>display(formatted_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Test</th>
      <th>Statistic</th>
      <th>P-value</th>
      <th>Variable</th>
      <th>Threshold</th>
      <th>Pass/Fail</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ADF</td>
      <td>-1.917289</td>
      <td>3.239719e-01</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>1</th>
      <td>KPSS</td>
      <td>1.012357</td>
      <td>1.000000e-02</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP</td>
      <td>-2.027462</td>
      <td>2.746634e-01</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ZA</td>
      <td>-3.498670</td>
      <td>6.804771e-01</td>
      <td>loan_rate_A</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ADF</td>
      <td>-3.159930</td>
      <td>2.242441e-02</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>5</th>
      <td>KPSS</td>
      <td>0.263073</td>
      <td>1.000000e-01</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PP</td>
      <td>-2.446084</td>
      <td>1.291496e-01</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ZA</td>
      <td>-5.246346</td>
      <td>1.185734e-02</td>
      <td>loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ADF</td>
      <td>-2.530667</td>
      <td>1.081899e-01</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>9</th>
      <td>KPSS</td>
      <td>0.809961</td>
      <td>1.000000e-02</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>10</th>
      <td>PP</td>
      <td>-2.264992</td>
      <td>1.835073e-01</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ZA</td>
      <td>-4.681009</td>
      <td>7.413460e-02</td>
      <td>loan_rate_C</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ADF</td>
      <td>-1.617159</td>
      <td>4.742193e-01</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>13</th>
      <td>KPSS</td>
      <td>1.564146</td>
      <td>1.000000e-02</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>14</th>
      <td>PP</td>
      <td>-1.853613</td>
      <td>3.541874e-01</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>15</th>
      <td>ZA</td>
      <td>-4.566136</td>
      <td>1.000130e-01</td>
      <td>loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ADF</td>
      <td>-0.168543</td>
      <td>9.421688e-01</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>17</th>
      <td>KPSS</td>
      <td>0.375746</td>
      <td>8.760949e-02</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>18</th>
      <td>PP</td>
      <td>-3.970772</td>
      <td>1.571534e-03</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ZA</td>
      <td>-4.263683</td>
      <td>2.081630e-01</td>
      <td>FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ADF</td>
      <td>-10.313828</td>
      <td>3.134761e-18</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>21</th>
      <td>KPSS</td>
      <td>0.085929</td>
      <td>1.000000e-01</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>22</th>
      <td>PP</td>
      <td>-10.341787</td>
      <td>2.673442e-18</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ZA</td>
      <td>-10.685459</td>
      <td>1.000000e-05</td>
      <td>diff1_loan_rate_A</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>24</th>
      <td>ADF</td>
      <td>-8.632056</td>
      <td>5.720336e-14</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>25</th>
      <td>KPSS</td>
      <td>0.151486</td>
      <td>1.000000e-01</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>26</th>
      <td>PP</td>
      <td>-8.657786</td>
      <td>4.915171e-14</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>27</th>
      <td>ZA</td>
      <td>-8.970778</td>
      <td>1.000000e-05</td>
      <td>diff1_loan_rate_B</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>28</th>
      <td>ADF</td>
      <td>-8.618071</td>
      <td>6.211940e-14</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>29</th>
      <td>KPSS</td>
      <td>0.333588</td>
      <td>1.000000e-01</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>30</th>
      <td>PP</td>
      <td>-9.063228</td>
      <td>4.504048e-15</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>31</th>
      <td>ZA</td>
      <td>-9.255829</td>
      <td>1.000000e-05</td>
      <td>diff1_loan_rate_C</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>32</th>
      <td>ADF</td>
      <td>-4.103447</td>
      <td>9.558947e-04</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>33</th>
      <td>KPSS</td>
      <td>0.188705</td>
      <td>1.000000e-01</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>34</th>
      <td>PP</td>
      <td>-9.725544</td>
      <td>9.295675e-17</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>35</th>
      <td>ZA</td>
      <td>-4.753945</td>
      <td>6.055853e-02</td>
      <td>diff1_loan_rate_D</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>36</th>
      <td>ADF</td>
      <td>-3.632288</td>
      <td>5.172913e-03</td>
      <td>diff1_FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>37</th>
      <td>KPSS</td>
      <td>1.153749</td>
      <td>1.000000e-02</td>
      <td>diff1_FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>38</th>
      <td>PP</td>
      <td>-5.639326</td>
      <td>1.045285e-06</td>
      <td>diff1_FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>39</th>
      <td>ZA</td>
      <td>-5.147877</td>
      <td>1.793470e-02</td>
      <td>diff1_FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>40</th>
      <td>ADF</td>
      <td>-3.327780</td>
      <td>1.368147e-02</td>
      <td>diff2_FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>41</th>
      <td>KPSS</td>
      <td>0.061353</td>
      <td>1.000000e-01</td>
      <td>diff2_FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
    <tr>
      <th>42</th>
      <td>PP</td>
      <td>-21.677880</td>
      <td>0.000000e+00</td>
      <td>diff2_FEDFUNDS</td>
      <td>0.01</td>
      <td>Fail</td>
    </tr>
    <tr>
      <th>43</th>
      <td>ZA</td>
      <td>-5.228518</td>
      <td>1.295767e-02</td>
      <td>diff2_FEDFUNDS</td>
      <td>0.01</td>
      <td>Pass</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Step 2: Identify the order of the AR model</strong></p>
<p>The order of the autoregressive (AR) model can be determined by looking at the partial autocorrelation function (PACF) plot. The PACF shows the correlation between a time series and its lagged values after accounting for the correlation at all shorter lags.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_ar_order(column, max_lag):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    pacf_values, pacf_confidence_intervals <span class="op">=</span> pacf(column, nlags<span class="op">=</span>max_lag, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">"ywmle"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lag, pacf_value, ci <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="bu">len</span>(pacf_values)), pacf_values, pacf_confidence_intervals):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pacf_value <span class="op">&lt;=</span> ci[<span class="dv">1</span>]:</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> lag <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>max_lag <span class="op">=</span> <span class="dv">10</span>  <span class="co"># Maximum lag to consider</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>ar_orders <span class="op">=</span> {}</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    ar_order <span class="op">=</span> find_ar_order(df[col], max_lag)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    ar_orders[col] <span class="op">=</span> ar_order</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame from the ar_orders dictionary</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>ar_orders_df <span class="op">=</span> pd.DataFrame.from_dict(ar_orders, orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'AR_order'</span>])</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>ar_orders_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>ar_orders_df.columns <span class="op">=</span> [<span class="st">'Column'</span>, <span class="st">'AR_order'</span>]</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the DataFrame</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>display(ar_orders_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Column</th>
      <th>AR_order</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>loan_rate_A</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>loan_rate_B</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>loan_rate_C</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>loan_rate_D</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FEDFUNDS</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>diff1_loan_rate_A</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>diff1_loan_rate_B</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>diff1_loan_rate_C</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>diff1_loan_rate_D</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>diff1_FEDFUNDS</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>diff2_FEDFUNDS</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><em>Â© Copyright 2023 ValidMind Inc All Rights Reserved.</em></div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/validmind/documentation">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/validmind/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>