<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ValidMind - Probability of Default Model using ValidMind</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../validmind.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-S46CKWPNSS"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-S46CKWPNSS', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../guide/ValidMind-logo-color.svg" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../guide/get-started.html" rel="" target="">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/guide.html" rel="" target="">
 <span class="menu-text">Guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/get-started-developer-framework.html" rel="" target="">
 <span class="menu-text">Developer Framework</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/faq.html" rel="" target="">
 <span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guide/support.html" rel="" target="">
 <span class="menu-text">Support</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#step-1-connect-to-validmind-project" id="toc-step-1-connect-to-validmind-project" class="nav-link active" data-scroll-target="#step-1-connect-to-validmind-project">Step 1: Connect to ValidMind Project</a></li>
  <li><a href="#step-2-import-raw-data" id="toc-step-2-import-raw-data" class="nav-link" data-scroll-target="#step-2-import-raw-data">Step 2: Import Raw Data</a></li>
  <li><a href="#step-3-data-description" id="toc-step-3-data-description" class="nav-link" data-scroll-target="#step-3-data-description">Step 3: Data Description</a>
  <ul class="collapse">
  <li><a href="#describe-raw-dataset" id="toc-describe-raw-dataset" class="nav-link" data-scroll-target="#describe-raw-dataset">Describe Raw Dataset</a></li>
  <li><a href="#identify-missing-values" id="toc-identify-missing-values" class="nav-link" data-scroll-target="#identify-missing-values">Identify Missing Values</a></li>
  </ul></li>
  <li><a href="#step-4-data-preparation" id="toc-step-4-data-preparation" class="nav-link" data-scroll-target="#step-4-data-preparation">Step 4: Data Preparation</a>
  <ul class="collapse">
  <li><a href="#identify-target-variable" id="toc-identify-target-variable" class="nav-link" data-scroll-target="#identify-target-variable">Identify Target Variable</a></li>
  <li><a href="#remove-unused-variables" id="toc-remove-unused-variables" class="nav-link" data-scroll-target="#remove-unused-variables">Remove Unused Variables</a></li>
  <li><a href="#remove-variables-with-large-number-of-missing-values" id="toc-remove-variables-with-large-number-of-missing-values" class="nav-link" data-scroll-target="#remove-variables-with-large-number-of-missing-values">Remove Variables with Large Number of Missing Values</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a></li>
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers">Outliers</a></li>
  </ul></li>
  <li><a href="#step-5-training-data" id="toc-step-5-training-data" class="nav-link" data-scroll-target="#step-5-training-data">Step 5: Training Data</a>
  <ul class="collapse">
  <li><a href="#sampling" id="toc-sampling" class="nav-link" data-scroll-target="#sampling">Sampling</a></li>
  <li><a href="#class-imbalance" id="toc-class-imbalance" class="nav-link" data-scroll-target="#class-imbalance">Class Imbalance</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">Feature Selection</a></li>
  </ul></li>
  <li><a href="#step-8-feature-engineering" id="toc-step-8-feature-engineering" class="nav-link" data-scroll-target="#step-8-feature-engineering">Step 8: Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#encoding-of-numerical-features" id="toc-encoding-of-numerical-features" class="nav-link" data-scroll-target="#encoding-of-numerical-features">Encoding of Numerical Features</a></li>
  <li><a href="#woe-and-iv" id="toc-woe-and-iv" class="nav-link" data-scroll-target="#woe-and-iv">WoE and IV</a></li>
  <li><a href="#group-buckets" id="toc-group-buckets" class="nav-link" data-scroll-target="#group-buckets">Group Buckets</a></li>
  <li><a href="#add-woe-as-features" id="toc-add-woe-as-features" class="nav-link" data-scroll-target="#add-woe-as-features">Add WoE as Features</a></li>
  <li><a href="#scorecard-development" id="toc-scorecard-development" class="nav-link" data-scroll-target="#scorecard-development">Scorecard Development</a></li>
  </ul></li>
  <li><a href="#model-training" id="toc-model-training" class="nav-link" data-scroll-target="#model-training">Model Training</a>
  <ul class="collapse">
  <li><a href="#feature-statistical-significance" id="toc-feature-statistical-significance" class="nav-link" data-scroll-target="#feature-statistical-significance">Feature Statistical Significance</a></li>
  <li><a href="#feature-importance" id="toc-feature-importance" class="nav-link" data-scroll-target="#feature-importance">Feature Importance</a></li>
  <li><a href="#feature-importance-vs-significance" id="toc-feature-importance-vs-significance" class="nav-link" data-scroll-target="#feature-importance-vs-significance">Feature Importance vs Significance</a></li>
  <li><a href="#drop-features" id="toc-drop-features" class="nav-link" data-scroll-target="#drop-features">Drop Features</a></li>
  <li><a href="#fit-glm-model" id="toc-fit-glm-model" class="nav-link" data-scroll-target="#fit-glm-model">Fit GLM Model</a></li>
  <li><a href="#fit-decision-tree-model" id="toc-fit-decision-tree-model" class="nav-link" data-scroll-target="#fit-decision-tree-model">Fit Decision Tree Model</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#model-performance-metrics" id="toc-model-performance-metrics" class="nav-link" data-scroll-target="#model-performance-metrics">Model Performance Metrics</a></li>
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion Matrix</a></li>
  <li><a href="#roc-auc-curve" id="toc-roc-auc-curve" class="nav-link" data-scroll-target="#roc-auc-curve">ROC-AUC Curve</a></li>
  <li><a href="#gini-coefficients" id="toc-gini-coefficients" class="nav-link" data-scroll-target="#gini-coefficients">GINI Coefficients</a></li>
  <li><a href="#scorecard-development-1" id="toc-scorecard-development-1" class="nav-link" data-scroll-target="#scorecard-development-1">Scorecard Development</a></li>
  <li><a href="#map-model-fit-coefficients-to-scores" id="toc-map-model-fit-coefficients-to-scores" class="nav-link" data-scroll-target="#map-model-fit-coefficients-to-scores">Map Model Fit Coefficients to Scores</a></li>
  </ul></li>
  <li><a href="#appendix-1" id="toc-appendix-1" class="nav-link" data-scroll-target="#appendix-1">Appendix 1</a>
  <ul class="collapse">
  <li><a href="#model-risk-assessment" id="toc-model-risk-assessment" class="nav-link" data-scroll-target="#model-risk-assessment">Model Risk Assessment</a>
  <ul class="collapse">
  <li><a href="#model-fit-metric-risk-scores" id="toc-model-fit-metric-risk-scores" class="nav-link" data-scroll-target="#model-fit-metric-risk-scores"><strong>Model Fit Metric</strong> Risk Scores</a></li>
  <li><a href="#model-performance-metric-risk-scores" id="toc-model-performance-metric-risk-scores" class="nav-link" data-scroll-target="#model-performance-metric-risk-scores"><strong>Model Performance Metric</strong> Risk Scores</a></li>
  <li><a href="#model-risk-assessment-1" id="toc-model-risk-assessment-1" class="nav-link" data-scroll-target="#model-risk-assessment-1"><strong>Model Risk Assessment</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#appendix-2" id="toc-appendix-2" class="nav-link" data-scroll-target="#appendix-2">Appendix 2</a>
  <ul class="collapse">
  <li><a href="#step-8-univariate-analysis" id="toc-step-8-univariate-analysis" class="nav-link" data-scroll-target="#step-8-univariate-analysis">Step 8: Univariate Analysis</a>
  <ul class="collapse">
  <li><a href="#histograms-of-numerical-features" id="toc-histograms-of-numerical-features" class="nav-link" data-scroll-target="#histograms-of-numerical-features">Histograms of Numerical Features</a></li>
  <li><a href="#high-cardinality-of-categorical-features" id="toc-high-cardinality-of-categorical-features" class="nav-link" data-scroll-target="#high-cardinality-of-categorical-features">High Cardinality of Categorical Features</a></li>
  <li><a href="#bar-plots-of-categorical-features" id="toc-bar-plots-of-categorical-features" class="nav-link" data-scroll-target="#bar-plots-of-categorical-features">Bar Plots of Categorical Features</a></li>
  <li><a href="#default-ratios-by-categorical-feature" id="toc-default-ratios-by-categorical-feature" class="nav-link" data-scroll-target="#default-ratios-by-categorical-feature">Default Ratios by Categorical Feature</a></li>
  </ul></li>
  <li><a href="#step-9-multivariate-analysis" id="toc-step-9-multivariate-analysis" class="nav-link" data-scroll-target="#step-9-multivariate-analysis">Step 9: Multivariate Analysis</a>
  <ul class="collapse">
  <li><a href="#bivariate-bar-plots-of-default-ratios" id="toc-bivariate-bar-plots-of-default-ratios" class="nav-link" data-scroll-target="#bivariate-bar-plots-of-default-ratios">Bivariate Bar Plots of Default Ratios</a></li>
  <li><a href="#scatter-plots-by-default-status" id="toc-scatter-plots-by-default-status" class="nav-link" data-scroll-target="#scatter-plots-by-default-status">Scatter Plots by Default Status</a></li>
  <li><a href="#bivariate-histograms" id="toc-bivariate-histograms" class="nav-link" data-scroll-target="#bivariate-histograms">Bivariate Histograms</a></li>
  </ul></li>
  <li><a href="#step-10-feature-engineering" id="toc-step-10-feature-engineering" class="nav-link" data-scroll-target="#step-10-feature-engineering">Step 10: Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#add-dummy-catergorical-variables" id="toc-add-dummy-catergorical-variables" class="nav-link" data-scroll-target="#add-dummy-catergorical-variables">Add Dummy Catergorical Variables</a></li>
  <li><a href="#weight-of-evidence-woe-binning" id="toc-weight-of-evidence-woe-binning" class="nav-link" data-scroll-target="#weight-of-evidence-woe-binning">Weight of Evidence (WoE) Binning</a></li>
  </ul></li>
  <li><a href="#step-11-model-training" id="toc-step-11-model-training" class="nav-link" data-scroll-target="#step-11-model-training">Step 11: Model Training</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Probability of Default Model using ValidMind</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li>Step 1: Connect Notebook to ValidMind Project</li>
<li>Step 2: Import Raw Data</li>
<li>Step 3: Data Description</li>
<li>Step 4: Data Preparation</li>
<li>Step 5: Data Description on Preprocessed Data</li>
<li>Step 6: Univariate Analysis</li>
<li>Step 7: Multivariate Analysis</li>
<li>Step 8: Model Training</li>
</ul>
<section id="step-1-connect-to-validmind-project" class="level2">
<h2 class="anchored" data-anchor-id="step-1-connect-to-validmind-project">Step 1: Connect to ValidMind Project</h2>
<section id="import-libraries" class="level4">
<h4 class="anchored" data-anchor-id="import-libraries">Import Libraries</h4>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load API key and secret from environment variables</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext dotenv</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>dotenv .env</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, RepeatedStratifiedKFold, cross_val_score</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, roc_auc_score, confusion_matrix, precision_recall_curve, auc</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> f_classif</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2_contingency</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connect-notebook-to-validmind-project" class="level4">
<h4 class="anchored" data-anchor-id="connect-notebook-to-validmind-project">Connect Notebook to ValidMind Project</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> validmind <span class="im">as</span> vm</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>vm.init(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  api_host <span class="op">=</span> <span class="st">"http://localhost:3000/api/v1/tracking"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  api_key <span class="op">=</span> <span class="st">"2494c3838f48efe590d531bfe225d90b"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  api_secret <span class="op">=</span> <span class="st">"4f692f8161f128414fef542cab2a4e74834c75d01b3a8e088a1834f2afcfe838"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  project <span class="op">=</span> <span class="st">"cliwzqjgv00001fy6869rlav9"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-2-import-raw-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2-import-raw-data">Step 2: Import Raw Data</h2>
<section id="import-lending-club-dataset" class="level4">
<h4 class="anchored" data-anchor-id="import-lending-club-dataset">Import Lending Club Dataset</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the path to the zip file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> <span class="st">'/Users/juanvalidmind/Dev/datasets/lending club/data_2007_2014/loan_data_2007_2014.csv'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># filepath = '/Users/juanvalidmind/Dev/datasets/lending club/data_2007_2011/lending_club_loan_data_2007_2011.csv'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-3-data-description" class="level2">
<h2 class="anchored" data-anchor-id="step-3-data-description">Step 3: Data Description</h2>
<section id="describe-raw-dataset" class="level3">
<h3 class="anchored" data-anchor-id="describe-raw-dataset">Describe Raw Dataset</h3>
<p><strong>Create VM Dataset and Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.vm_models.test_context <span class="im">import</span> TestContext</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.TabularDescriptionTables <span class="im">import</span> TabularDescriptionTables</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularDescriptionTables(test_context)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="identify-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="identify-missing-values">Identify Missing Values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.MissingValuesBarPlot <span class="im">import</span> MissingValuesBarPlot</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"threshold"</span>: <span class="dv">80</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"xticks_fontsize"</span>: <span class="dv">8</span>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> MissingValuesBarPlot(test_context, params)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-4-data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="step-4-data-preparation">Step 4: Data Preparation</h2>
<section id="identify-target-variable" class="level3">
<h3 class="anchored" data-anchor-id="identify-target-variable">Identify Target Variable</h3>
<p><strong>Definition of Default</strong></p>
<p>We categorizing <code>Fully Paid</code> loans as “default = 0” and <code>Charged Off</code> loans as “default = 1”. This binary classification is suitable for developing a credit scorecard, as it enables distinction between applicants likely to fulfill their credit obligations (low risk) and those likely to fail (high risk).</p>
<p>Loans with <code>Current</code> status, which represents ongoing loans with an unresolved outcome, should be excluded from the model, as their final repayment status is still unknown and thus not suitable for a retrospective risk analysis.</p>
<p><strong>Add <code>default</code> Variable</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_target_column(df, target_column):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assuming the column name is 'loan_status'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    df[target_column] <span class="op">=</span> df[<span class="st">'loan_status'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">0</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">"Fully Paid"</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">"Charged Off"</span> <span class="cf">else</span> np.nan)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove rows where the target column is NaN</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[target_column])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert target column to integer</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    df[target_column] <span class="op">=</span> df[target_column].astype(<span class="bu">int</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'default'</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> add_target_column(df, target_column)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop 'loan_status' variable </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span><span class="st">'loan_status'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="remove-unused-variables" class="level3">
<h3 class="anchored" data-anchor-id="remove-unused-variables">Remove Unused Variables</h3>
<p>Remove all the <strong>Demographic</strong> and <strong>Customer Behavioural</strong> features which is of no use for default analysis for credit approval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>unused_variables <span class="op">=</span> [<span class="st">"id"</span>, <span class="st">"member_id"</span>, <span class="st">"funded_amnt"</span>, <span class="st">"emp_title"</span>, <span class="st">"url"</span>, <span class="st">"desc"</span>, <span class="st">"application_type"</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"title"</span>, <span class="st">"zip_code"</span>, <span class="st">"delinq_2yrs"</span>, <span class="st">"mths_since_last_delinq"</span>, <span class="st">"mths_since_last_record"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"revol_bal"</span>, <span class="st">"total_rec_prncp"</span>, <span class="st">"total_rec_late_fee"</span>, <span class="st">"recoveries"</span>, <span class="st">"out_prncp_inv"</span>, <span class="st">"out_prncp"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"collection_recovery_fee"</span>, <span class="st">"next_pymnt_d"</span>, <span class="st">"initial_list_status"</span>, <span class="st">"pub_rec"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"collections_12_mths_ex_med"</span>, <span class="st">"policy_code"</span>, <span class="st">"acc_now_delinq"</span>, <span class="st">"pymnt_plan"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"tot_coll_amt"</span>, <span class="st">"tot_cur_bal"</span>, <span class="st">"total_rev_hi_lim"</span>, <span class="st">"last_pymnt_d"</span>, <span class="st">"last_credit_pull_d"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'earliest_cr_line'</span>, <span class="st">'issue_d'</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>unused_variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="remove-variables-with-large-number-of-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="remove-variables-with-large-number-of-missing-values">Remove Variables with Large Number of Missing Values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> variables_with_min_missing(df, min_missing_percentage):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the percentage of missing values in each column</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    missing_percentages <span class="op">=</span> df.isnull().mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the variables where the percentage of missing values is greater than the specified minimum</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    variables_to_drop <span class="op">=</span> missing_percentages[missing_percentages <span class="op">&gt;</span> min_missing_percentage].index.tolist()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Also add any columns where all values are missing</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    variables_to_drop.extend(df.columns[df.isnull().<span class="bu">all</span>()].tolist())</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove duplicates (if any)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    variables_to_drop <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(variables_to_drop))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> variables_to_drop</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>min_missing_count <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>variables_to_drop <span class="op">=</span> variables_with_min_missing(df, min_missing_count)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>variables_to_drop, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>df.dropna(axis<span class="op">=</span><span class="dv">0</span>, subset<span class="op">=</span>[<span class="st">"emp_length"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>df.dropna(axis<span class="op">=</span><span class="dv">0</span>, subset<span class="op">=</span>[<span class="st">"revol_util"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_term_column(df, column):</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to remove 'months' string from the 'term' column and convert it to categorical</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the column exists in the dataframe</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> column <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"The column '</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">' does not exist in the dataframe."</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">str</span>.replace(<span class="st">' months'</span>, <span class="st">''</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to categorical</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].astype(<span class="st">'object'</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_rate_columns(df, column):</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Clean interest rate column. Remove the '%' sign and convert to numeric.</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">    df (pandas.DataFrame): DataFrame to be processed.</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">    column (str): Name of the interest rate column to be cleaned.</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">str</span>.replace(<span class="st">'%'</span>, <span class="st">''</span>)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> pd.to_numeric(df[column])</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_emp_length_column(df, column):</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to clean 'emp_length' column and convert it to categorical.</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the column exists in the dataframe</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> column <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"The column '</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">' does not exist in the dataframe."</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].replace(<span class="st">'n/a'</span>, np.nan)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">str</span>.replace(<span class="st">'&lt; 1 year'</span>, <span class="bu">str</span>(<span class="dv">0</span>))</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.sub(<span class="st">'\D'</span>, <span class="st">''</span>, <span class="bu">str</span>(x)))</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    df[column].fillna(value <span class="op">=</span> <span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to categorical</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].astype(<span class="st">'object'</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_inq_last_6mths(df, column):</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co">    Function to convert 'inq_last_6mths' column into categorical.</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the column exists in the dataframe</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> column <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"The column '</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">' does not exist in the dataframe."</span>)</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to categorical</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].astype(<span class="st">'category'</span>)</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>clean_emp_length_column(df, <span class="st">'emp_length'</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>clean_term_column(df, <span class="st">'term'</span>)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>clean_inq_last_6mths(df, <span class="st">'inq_last_6mths'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="outliers" class="level3">
<h3 class="anchored" data-anchor-id="outliers">Outliers</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_numerical_columns(df):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>        numerical_columns <span class="op">=</span> df.select_dtypes(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            include<span class="op">=</span>[<span class="st">"int"</span>, <span class="st">"float"</span>, <span class="st">"uint"</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        ).columns.tolist()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> numerical_columns</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_categorical_columns(df):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        categorical_columns <span class="op">=</span> df.select_dtypes(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            include<span class="op">=</span>[<span class="st">"object"</span>, <span class="st">"category"</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        ).columns.tolist()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> categorical_columns</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_outliers(series, threshold<span class="op">=</span><span class="fl">1.5</span>):</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    Q1 <span class="op">=</span> series.quantile(<span class="fl">0.25</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    Q3 <span class="op">=</span> series.quantile(<span class="fl">0.75</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="op">=</span> Q1 <span class="op">-</span> threshold <span class="op">*</span> IQR</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="op">=</span> Q3 <span class="op">+</span> threshold <span class="op">*</span> IQR</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series[(series <span class="op">&lt;</span> lower_bound) <span class="op">|</span> (series <span class="op">&gt;</span> upper_bound)]</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_iqr_outliers(df, target_column, threshold<span class="op">=</span><span class="fl">1.5</span>):</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> df.select_dtypes(include<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    num_cols.remove(target_column)  <span class="co"># Exclude target_column from numerical columns</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> num_cols:</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        outliers <span class="op">=</span> compute_outliers(df[col], threshold)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[<span class="op">~</span>df[col].isin(outliers)]</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> remove_iqr_outliers(df, target_column, threshold<span class="op">=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.IQROutliersPlots <span class="im">import</span> IQROutliersPlots</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> get_numerical_columns(df)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"num_features"</span>: num_features,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"threshold"</span>: <span class="fl">1.5</span>}</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> IQROutliersPlots(test_context, params)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-5-training-data" class="level2">
<h2 class="anchored" data-anchor-id="step-5-training-data">Step 5: Training Data</h2>
<section id="sampling" class="level3">
<h3 class="anchored" data-anchor-id="sampling">Sampling</h3>
<p>We employ stratified sampling to create our training and testing sets. Stratified sampling is particularly important in this context. When the <code>stratify = y</code> parameter is set, it ensures that the distribution of the target variable (<code>y</code>) in the test set is the same as that in the original dataset.</p>
<p>This is crucial for maintaining a consistent representation of the target variable classes, especially important in scenarios where the classes are imbalanced, which is often the case in credit risk scorecards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Split data into train and test </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(target_column, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[target_column]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                                    random_state <span class="op">=</span> <span class="dv">42</span>, stratify <span class="op">=</span> y)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate X_train with y_train to form df_train</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.concat([X_train, y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate X_test with y_test to form df_test</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> pd.concat([X_test, y_test], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="class-imbalance" class="level3">
<h3 class="anchored" data-anchor-id="class-imbalance">Class Imbalance</h3>
<p>Class imbalance is a common issue in credit risk scorecards and datasets like the Lending Club’s. This imbalance arises when the number of defaulting loans (negative class) is significantly smaller than the number of loans that are paid off (positive class). Such imbalance can lead to biased models that favor the majority class, thus affecting predictive performance.</p>
<p>Special techniques like oversampling, undersampling, or cost-sensitive learning are often needed to ensure that the minority class is appropriately represented during model training.</p>
<p><strong>Update VM Dataset and Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.ClassImbalance <span class="im">import</span> ClassImbalance</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ClassImbalance(test_context)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection">Feature Selection</h3>
<section id="chi-squared-test-on-categorical-features" class="level4">
<h4 class="anchored" data-anchor-id="chi-squared-test-on-categorical-features">Chi-Squared Test on Categorical Features</h4>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.ChiSquaredFeaturesTable <span class="im">import</span> ChiSquaredFeaturesTable</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>cat_features <span class="op">=</span> get_categorical_columns(df_train)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"cat_features"</span>: cat_features,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"p_threshold"</span>: <span class="fl">0.05</span>}</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ChiSquaredFeaturesTable(test_context, params)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="anova-test-on-numerical-features" class="level4">
<h4 class="anchored" data-anchor-id="anova-test-on-numerical-features">ANOVA Test on Numerical Features</h4>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.ANOVAOneWayTable <span class="im">import</span> ANOVAOneWayTable</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> get_numerical_columns(df_train)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"num_features"</span>: num_features,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"p_threshold"</span>: <span class="fl">0.05</span>}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ANOVAOneWayTable(test_context, params)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="heatmap-correlation-of-numerical-features" class="level4">
<h4 class="anchored" data-anchor-id="heatmap-correlation-of-numerical-features">Heatmap Correlation of Numerical Features</h4>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.HeatmapFeatureCorrelations <span class="im">import</span> HeatmapFeatureCorrelations</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"declutter"</span>: <span class="va">False</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> HeatmapFeatureCorrelations(test_context, params)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="correlations-of-numerical-features-with-target-variable" class="level4">
<h4 class="anchored" data-anchor-id="correlations-of-numerical-features-with-target-variable">Correlations of Numerical Features with Target Variable</h4>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.FeatureTargetCorrelationPlot <span class="im">import</span> FeatureTargetCorrelationPlot</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"declutter"</span>: <span class="va">False</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> FeatureTargetCorrelationPlot(test_context, params)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="selection-of-features" class="level4">
<h4 class="anchored" data-anchor-id="selection-of-features">Selection of Features</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>drop_categorical_features <span class="op">=</span> [<span class="st">'addr_state'</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>drop_numerical_features <span class="op">=</span> [<span class="st">'total_rec_int'</span>, <span class="st">'loan_amnt'</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'funded_amnt_inv'</span>, <span class="st">'dti'</span>, <span class="st">'revol_util'</span>, <span class="st">'total_pymnt'</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'total_pymnt_inv'</span>, <span class="st">'last_pymnt_amnt'</span>,]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>df_train.drop(columns <span class="op">=</span> drop_categorical_features <span class="op">+</span> drop_numerical_features, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test </span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>df_test.drop(columns <span class="op">=</span> drop_categorical_features <span class="op">+</span> drop_numerical_features, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="step-8-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="step-8-feature-engineering">Step 8: Feature Engineering</h2>
<section id="encoding-of-numerical-features" class="level3">
<h3 class="anchored" data-anchor-id="encoding-of-numerical-features">Encoding of Numerical Features</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_numerical_features(df):</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># term</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'term'</span>] <span class="op">=</span> df[<span class="st">'term'</span>].replace({<span class="st">' 36'</span>: <span class="st">'36M'</span>, <span class="st">' 60'</span>: <span class="st">'60M'</span>})</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># emp_length_int</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'emp_length'</span>] <span class="op">=</span> df[<span class="st">'emp_length'</span>].replace(<span class="st">'10+'</span>, <span class="st">'10'</span>)  <span class="co"># Replace '10+' with '10'</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'emp_length'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'emp_length'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)  <span class="co"># Convert to numeric</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'emp_length'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">999</span>]</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'emp_length_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'emp_length'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'emp_length'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inq_last_6mths</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'inq_last_6mths'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>]</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'inq_last_6mths_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'inq_last_6mths'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'inq_last_6mths'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total_acc</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'total_acc'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">999</span>]</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'total_acc_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'total_acc'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'total_acc'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annual_inc</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'annual_inc'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'annual_inc_1000'</span>] <span class="op">=</span> df[<span class="st">'annual_inc'</span>]<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">250</span>, <span class="dv">1000</span>, <span class="dv">10000</span>]</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'annual_inc_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'annual_inc_1000'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'annual_inc'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'annual_inc_1000'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># int_rate</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'int_rate'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>]</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'int_rate_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'int_rate'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'int_rate'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># installment</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'installment'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">750</span>, <span class="dv">1000</span>, <span class="dv">1500</span>]</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'installment_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'installment'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'installment'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># open_acc</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'open_acc'</span>].replace(<span class="st">"N/A"</span>, <span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'open_acc'</span>].fillna(<span class="op">-</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'open_acc_bucket'</span>] <span class="op">=</span> pd.cut(df[<span class="st">'open_acc'</span>], bins<span class="op">=</span>bins, right<span class="op">=</span><span class="va">False</span>, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span><span class="st">'open_acc'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> encode_numerical_features(df_train)</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> encode_numerical_features(df_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_categorical_features(df):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the column names of features with the data type "category"</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    categorical_features <span class="op">=</span> df.select_dtypes(include<span class="op">=</span><span class="st">'category'</span>).columns.tolist()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> categorical_features</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_categorical_to_object(df):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the categorical features</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    categorical_features <span class="op">=</span> find_categorical_features(df)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the categorical features to object type</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    df[categorical_features] <span class="op">=</span> df[categorical_features].astype(<span class="bu">str</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> convert_categorical_to_object(df_train)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> convert_categorical_to_object(df_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularDescriptionTables(test_context)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="woe-and-iv" class="level3">
<h3 class="anchored" data-anchor-id="woe-and-iv">WoE and IV</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.WOEIVTable <span class="im">import</span> WOEIVTable</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update vm dataset and test context</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                              target_column<span class="op">=</span>target_column)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Configure test parameters</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"order_by"</span>: [<span class="st">"Feature"</span>, <span class="st">"WoE"</span>]</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Run test</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> WOEIVTable(test_context, params<span class="op">=</span>params)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>woe_iv_df <span class="op">=</span> metric.result.metric.value[<span class="st">'woe_iv'</span>]</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="group-buckets" class="level3">
<h3 class="anchored" data-anchor-id="group-buckets">Group Buckets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> coarse_classing(df, mappings):</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a copy of the DataFrame to avoid modifying the original</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    df_new <span class="op">=</span> df.copy()</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each feature and merge set</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, merge_sets <span class="kw">in</span> mappings.items():</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> merge_set <span class="kw">in</span> merge_sets:</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Merge the specified categories into a new category</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            df_new[feature] <span class="op">=</span> df_new[feature].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"[</span><span class="sc">{</span><span class="st">','</span><span class="sc">.</span>join(merge_set)<span class="sc">}</span><span class="ss">]"</span> <span class="cf">if</span> x <span class="kw">in</span> merge_set <span class="cf">else</span> x)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_new</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary of features and the sets to merge</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>mappings <span class="op">=</span> {</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sub_grade'</span>: [[<span class="st">'B2'</span>,<span class="st">'B3'</span>,<span class="st">'B4'</span>,<span class="st">'B5'</span>,<span class="st">'C3'</span>,<span class="st">'D1'</span>], [<span class="st">'C1'</span>,<span class="st">'C2'</span>,<span class="st">'C4'</span>,<span class="st">'C5'</span>], [<span class="st">'D3'</span>,<span class="st">'D4'</span>,<span class="st">'D5'</span>,<span class="st">'E3'</span>,<span class="st">'G4'</span>], [<span class="st">'E1'</span>,<span class="st">'E2'</span>,<span class="st">'E4'</span>,<span class="st">'E5'</span>,<span class="st">'F1'</span>,<span class="st">'F2'</span>,<span class="st">'F3'</span>,<span class="st">'F4'</span>,<span class="st">'G1'</span>,<span class="st">'G2'</span>,<span class="st">'G3'</span>,<span class="st">'G5'</span>,<span class="st">'F5'</span>]],</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grade'</span>: [[<span class="st">'F'</span>,<span class="st">'G'</span>]],</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'purpose'</span>: [[<span class="st">'wedding'</span>,<span class="st">'major_purchase'</span>], [<span class="st">'credit_card'</span>,<span class="st">'car'</span>], [<span class="st">'debt_consolidation'</span>,<span class="st">'other'</span>,<span class="st">'vacation'</span>], [<span class="st">'medical'</span>,<span class="st">'moving'</span>,<span class="st">'house'</span>,<span class="st">'educational'</span>], [<span class="st">'renewable_energy'</span>,<span class="st">'small_business'</span>]],</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'home_ownership'</span>: [[<span class="st">'MORTGAGE'</span>,<span class="st">'OWN'</span>,<span class="st">'RENT'</span>]],</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'annual_inc_bucket'</span>: [[<span class="st">'[250, 1000)'</span>,<span class="st">'[100, 150)'</span>,<span class="st">'[150, 250)'</span>,<span class="st">'[1000, 10000)'</span>], [<span class="st">'[50, 75)'</span>,<span class="st">'[40, 50)'</span>], [<span class="st">'[10, 20)'</span>,<span class="st">'[0, 10)'</span>]],</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'emp_length_bucket'</span>: [[<span class="st">'[2, 3)'</span>,<span class="st">'[40, 50)'</span>,<span class="st">'[3, 5)'</span>,<span class="st">'[1, 2)'</span>,<span class="st">'[0, 1)'</span>,<span class="st">'[5, 8)'</span>,<span class="st">'[8, 10)'</span>]],</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'inq_last_6mths_bucket'</span>: [[<span class="st">'[4, 5)'</span>,<span class="st">'[1, 2)'</span>], [<span class="st">'[5, 10)'</span>,<span class="st">'[3, 4)'</span>]],</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'installment_bucket'</span>: [[<span class="st">'[300, 400)'</span>,<span class="st">'[200, 300)'</span>,<span class="st">'[0, 100)'</span>], [<span class="st">'[400, 500)'</span>, <span class="st">'[500, 750)'</span>]],</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_acc_bucket'</span>: [[<span class="st">'[20, 25)'</span>,<span class="st">'[30, 35)'</span>,<span class="st">'[15, 20)'</span>,<span class="st">'[45, 50)'</span>,<span class="st">'[40, 45)'</span>,<span class="st">'[35, 40)'</span>,<span class="st">'[10, 15)'</span>,<span class="st">'[5, 10)'</span>]],</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'open_acc_bucket'</span>: [[<span class="st">'[5, 8)'</span>,<span class="st">'[8, 10)'</span>,<span class="st">'[10, 100)'</span>,<span class="st">'[4, 5)'</span>], [<span class="st">'[1, 2)'</span>,<span class="st">'[2, 3)'</span>]]</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> coarse_classing(df_train, mappings)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_train[<span class="op">~</span>df_train[<span class="st">'home_ownership'</span>].isin([<span class="st">'OTHER'</span>, <span class="st">'NONE'</span>])]</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>df_train.drop(columns<span class="op">=</span><span class="st">"home_ownership"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Update df_test</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> coarse_classing(df_test, mappings)</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df_test[<span class="op">~</span>df_test[<span class="st">'home_ownership'</span>].isin([<span class="st">'OTHER'</span>, <span class="st">'NONE'</span>])]</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>df_test.drop(columns<span class="op">=</span><span class="st">"home_ownership"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shorten_category_names(df, max_length<span class="op">=</span><span class="dv">20</span>, suffix<span class="op">=</span><span class="st">"..."</span>):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a copy of the DataFrame to avoid modifying the original</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    df_new <span class="op">=</span> df.copy()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate over each column in the DataFrame</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> df_new.columns:</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the column has the "object" data type</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_new[feature].dtype.name <span class="op">==</span> <span class="st">'object'</span>:</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Shorten long category names</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            df_new[feature] <span class="op">=</span> df_new[feature].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[:max_length] <span class="op">+</span> suffix <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">&gt;</span> max_length <span class="cf">else</span> x)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_new</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> shorten_category_names(df_train, max_length<span class="op">=</span><span class="dv">15</span>, suffix<span class="op">=</span><span class="st">"..."</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> shorten_category_names(df_test, max_length<span class="op">=</span><span class="dv">15</span>, suffix<span class="op">=</span><span class="st">"..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update vm dataset and test context</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                              target_column<span class="op">=</span>target_column)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Configure test parameters</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"order_by"</span>: [<span class="st">"Feature"</span>, <span class="st">"WoE"</span>]</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Run test</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> WOEIVTable(test_context, params<span class="op">=</span>params)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>woe_iv_df <span class="op">=</span> metric.result.metric.value[<span class="st">'woe_iv'</span>]</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.WOEIVPlots <span class="im">import</span> WOEIVPlots</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update vm dataset and test context</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                              target_column<span class="op">=</span>target_column)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label_rotation"</span>: <span class="dv">90</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Run test</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> WOEIVPlots(test_context, params<span class="op">=</span>params)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="add-woe-as-features" class="level3">
<h3 class="anchored" data-anchor-id="add-woe-as-features">Add WoE as Features</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> woe_encoder(woe_df, original_df, target):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initiate an empty DataFrame</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    woe_encoded_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each feature-category and get the corresponding WoE value</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> woe_df[<span class="st">'Feature'</span>].unique():</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> category <span class="kw">in</span> woe_df[woe_df[<span class="st">'Feature'</span>] <span class="op">==</span> feature][<span class="st">'Category'</span>].unique():</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>            woe_value <span class="op">=</span> woe_df[(woe_df[<span class="st">'Feature'</span>] <span class="op">==</span> feature) <span class="op">&amp;</span> (woe_df[<span class="st">'Category'</span>] <span class="op">==</span> category)][<span class="st">'WoE'</span>].values[<span class="dv">0</span>]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>            original_df.loc[original_df[feature] <span class="op">==</span> category, feature] <span class="op">=</span> woe_value</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the feature to float type</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        original_df[feature] <span class="op">=</span> original_df[feature].astype(<span class="bu">float</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating a new dataframe with WoE values</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature <span class="kw">in</span> woe_df[<span class="st">'Feature'</span>].unique():</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        woe_encoded_df <span class="op">=</span> pd.concat([woe_encoded_df, original_df[feature]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the target column to the new DataFrame</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    woe_encoded_df[target] <span class="op">=</span> original_df[target]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> woe_encoded_df</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> woe_encoder(woe_iv_df, df_train, target<span class="op">=</span><span class="st">'default'</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> woe_encoder(woe_iv_df, df_test, target<span class="op">=</span><span class="st">'default'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularDescriptionTables(test_context)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.FeatureTargetCorrelationPlot <span class="im">import</span> FeatureTargetCorrelationPlot</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"declutter"</span>: <span class="va">False</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> FeatureTargetCorrelationPlot(test_context, params)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"declutter"</span>: <span class="va">False</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> HeatmapFeatureCorrelations(test_context, params)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train[target_column]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> df_train.drop(target_column, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant to X_train for intercept term</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.concat([X_train, y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Update df_test</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test[target_column]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> df_test.drop(target_column, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> sm.add_constant(X_test)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> pd.concat([X_test, y_test], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df_test.reindex(labels<span class="op">=</span>df_train.columns, axis<span class="op">=</span><span class="dv">1</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.GLM(y_train, X_train, family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>model_fit_glm <span class="op">=</span> model.fit()</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the statistics</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_fit_glm.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_auc(y_true, y_scores):</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the Area Under the Curve (AUC)."""</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    auc <span class="op">=</span> roc_auc_score(y_true, y_scores)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> auc</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_gini(y_true, y_scores):</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes the Gini coefficient."""</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    auc <span class="op">=</span> compute_auc(y_true, y_scores)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    gini <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>auc <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gini</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_metrics(model, X_train, y_train, X_test, y_test):</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Computes and prints AUC and GINI for train and test sets."""</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    metrics_dict <span class="op">=</span> {<span class="st">"Dataset"</span>: [<span class="st">"Train"</span>, <span class="st">"Test"</span>],</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"AUC"</span>: [],</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"GINI"</span>: []}</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dataset, X, y <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">"Train"</span>, <span class="st">"Test"</span>], [X_train, X_test], [y_train, y_test]):</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get predicted probabilities</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>        y_scores <span class="op">=</span> model.predict(X)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute AUC and GINI</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>        auc <span class="op">=</span> compute_auc(y, y_scores)</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>        gini <span class="op">=</span> compute_gini(y, y_scores)</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the metrics to the dictionary</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>        metrics_dict[<span class="st">"AUC"</span>].append(auc)</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>        metrics_dict[<span class="st">"GINI"</span>].append(gini)</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert dictionary to DataFrame for nicer display</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    metrics_df <span class="op">=</span> pd.DataFrame(metrics_dict)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> metrics_df</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> compute_metrics(model_fit_glm, X_train, y_train, X_test, y_test)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>display(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_roc_curve(y_true, y_scores):</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, _ <span class="op">=</span> roc_curve(y_true, y_scores)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'darkorange'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'ROC curve (area = </span><span class="sc">%0.2f</span><span class="st">)'</span> <span class="op">%</span> roc_auc)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Receiver Operating Characteristic (ROC)'</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function using y_test and y_scores</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>plot_roc_curve(y_test, y_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Cerate VM dataset</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>vm_train_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>vm_test_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_test,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Create VM model</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>vm_model_glm <span class="op">=</span> vm.init_model(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_fit_glm, </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.ConfusionMatrix <span class="im">import</span> ConfusionMatrix</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span> vm_model_glm)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ConfusionMatrix(test_context)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.ROCCurve <span class="im">import</span> ROCCurve</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span> vm_model_glm)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ROCCurve(test_context)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p>More plots on performance in-sample out of sample.</p>
</section>
<section id="scorecard-development" class="level3">
<h3 class="anchored" data-anchor-id="scorecard-development">Scorecard Development</h3>
<section id="distribution-of-probability-of-default" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-probability-of-default">Distribution of Probability of Default</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_pd(model_fit, X_train):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict probabilities</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="op">=</span> model_fit.predict(X_train)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The probabilities are a 2D array with probabilities for the two classes.</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We are interested in the probability of default, which is the second column.</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    pd <span class="op">=</span> probabilities</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add PD as a new column in X_train</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    X_train[<span class="st">'PD'</span>] <span class="op">=</span> pd</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>X_train_pd <span class="op">=</span> compute_pd(model_fit_glm, X_train)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>df_train_pd <span class="op">=</span> pd.concat([X_train_pd, y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update df_test</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>X_test_pd <span class="op">=</span> compute_pd(model_fit_glm, X_test)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>df_test_pd <span class="op">=</span> pd.concat([X_test_pd, y_test], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pd_histogram(df_train, df_test, pd_col, target_col):</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate PD based on target column for training data</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    pd_train_0 <span class="op">=</span> df_train[df_train[target_col] <span class="op">==</span> <span class="dv">0</span>][pd_col]</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    pd_train_1 <span class="op">=</span> df_train[df_train[target_col] <span class="op">==</span> <span class="dv">1</span>][pd_col]</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate PD based on target column for testing data</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    pd_test_0 <span class="op">=</span> df_test[df_test[target_col] <span class="op">==</span> <span class="dv">0</span>][pd_col]</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    pd_test_1 <span class="op">=</span> df_test[df_test[target_col] <span class="op">==</span> <span class="dv">1</span>][pd_col]</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create subplot</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>, subplot_titles<span class="op">=</span>(<span class="st">"Train Data"</span>, <span class="st">"Test Data"</span>))</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create histograms for training data</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    trace_train_0 <span class="op">=</span> go.Histogram(x<span class="op">=</span>pd_train_0, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    trace_train_1 <span class="op">=</span> go.Histogram(x<span class="op">=</span>pd_train_1, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create histograms for testing data</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    trace_test_0 <span class="op">=</span> go.Histogram(x<span class="op">=</span>pd_test_0, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    trace_test_1 <span class="op">=</span> go.Histogram(x<span class="op">=</span>pd_test_1, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add traces to the subplots</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update layout to overlay the histograms in each subplot</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(barmode<span class="op">=</span><span class="st">'overlay'</span>, title_text<span class="op">=</span><span class="st">'Histogram of Probability of Default'</span>)</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the figure</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>plot_pd_histogram(df_train_pd,</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>                  df_test_pd, </span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>                  pd_col<span class="op">=</span><span class="st">'PD'</span>, </span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>                  target_col<span class="op">=</span>target_column)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_cumulative_pd(df_train, df_test, pd_col, target_col):</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate PD based on target column for training data</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    pd_train_0 <span class="op">=</span> np.sort(df_train[df_train[target_col] <span class="op">==</span> <span class="dv">0</span>][pd_col])</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    pd_train_1 <span class="op">=</span> np.sort(df_train[df_train[target_col] <span class="op">==</span> <span class="dv">1</span>][pd_col])</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate PD based on target column for testing data</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    pd_test_0 <span class="op">=</span> np.sort(df_test[df_test[target_col] <span class="op">==</span> <span class="dv">0</span>][pd_col])</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    pd_test_1 <span class="op">=</span> np.sort(df_test[df_test[target_col] <span class="op">==</span> <span class="dv">1</span>][pd_col])</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate cumulative distributions</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    cumulative_pd_train_0 <span class="op">=</span> np.cumsum(pd_train_0) <span class="op">/</span> np.<span class="bu">sum</span>(pd_train_0)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    cumulative_pd_train_1 <span class="op">=</span> np.cumsum(pd_train_1) <span class="op">/</span> np.<span class="bu">sum</span>(pd_train_1)</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    cumulative_pd_test_0 <span class="op">=</span> np.cumsum(pd_test_0) <span class="op">/</span> np.<span class="bu">sum</span>(pd_test_0)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    cumulative_pd_test_1 <span class="op">=</span> np.cumsum(pd_test_1) <span class="op">/</span> np.<span class="bu">sum</span>(pd_test_1)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create subplot</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>, subplot_titles<span class="op">=</span>(<span class="st">"Train Data"</span>, <span class="st">"Test Data"</span>))</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create line plots for training data</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    trace_train_0 <span class="op">=</span> go.Scatter(x<span class="op">=</span>pd_train_0, y<span class="op">=</span>cumulative_pd_train_0, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    trace_train_1 <span class="op">=</span> go.Scatter(x<span class="op">=</span>pd_train_1, y<span class="op">=</span>cumulative_pd_train_1, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create line plots for testing data</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    trace_test_0 <span class="op">=</span> go.Scatter(x<span class="op">=</span>pd_test_0, y<span class="op">=</span>cumulative_pd_test_0, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    trace_test_1 <span class="op">=</span> go.Scatter(x<span class="op">=</span>pd_test_1, y<span class="op">=</span>cumulative_pd_test_1, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add traces to the subplots</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update layout</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(title_text<span class="op">=</span><span class="st">'Cumulative Probability of Default'</span>)</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the figure</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>plot_cumulative_pd(df_train_pd,</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>                  df_test_pd, </span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>                  pd_col<span class="op">=</span><span class="st">'PD'</span>, </span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>                  target_col<span class="op">=</span>target_column)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="distribution-of-credit-scores" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-credit-scores">Distribution of Credit Scores</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_credit_score(model_fit, X_train, target_score, target_odds, pdo):</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get logistic regression coefficients</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> model_fit.params.values</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get intercept (alpha)</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="op">=</span> model_fit.params[<span class="dv">0</span>]  <span class="co"># Intercept is the first parameter in statsmodels</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate factor</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    factor <span class="op">=</span> pdo <span class="op">/</span> np.log(<span class="dv">2</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate offset</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> target_score <span class="op">-</span> (factor <span class="op">*</span> np.log(target_odds))</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize an empty list to store scores</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop over each row in the training data</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> X_train.iterrows():</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize score for current row</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>        score_i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add contribution of each feature to the score</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(beta)):</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>            WoE_i <span class="op">=</span> row[i <span class="op">+</span> <span class="dv">1</span>]  <span class="co"># WoE for feature i, assuming intercept is in the first column</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>            score_i <span class="op">+=</span> (beta[i] <span class="op">*</span> WoE_i <span class="op">+</span> alpha <span class="op">/</span> <span class="bu">len</span>(beta)) <span class="op">*</span> factor <span class="op">+</span> offset <span class="op">/</span> <span class="bu">len</span>(beta)</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add score to the list of scores</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>        scores.append(score_i)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add scores as a new column in X_train</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    X_train[<span class="st">'score'</span>] <span class="op">=</span> scores</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target_score, target_odds, and pdo</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>target_score <span class="op">=</span> <span class="dv">600</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>target_odds <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>pdo <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute credit scores and add to df_train</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>X_train_scores <span class="op">=</span> compute_credit_score(model_fit_glm, X_train_pd, target_score, target_odds, pdo)</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>df_train_scores <span class="op">=</span> pd.concat([X_train_scores, y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Update df_test </span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>X_test_scores <span class="op">=</span> compute_credit_score(model_fit_glm, X_test_pd, target_score, target_odds, pdo)</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>df_test_scores <span class="op">=</span> pd.concat([X_test_scores, y_test], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_score_histogram(df_train, df_test, score_col, target_col):</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate scores based on target column for training data</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    scores_train_0 <span class="op">=</span> df_train[df_train[target_col] <span class="op">==</span> <span class="dv">0</span>][score_col]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    scores_train_1 <span class="op">=</span> df_train[df_train[target_col] <span class="op">==</span> <span class="dv">1</span>][score_col]</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate scores based on target column for testing data</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    scores_test_0 <span class="op">=</span> df_test[df_test[target_col] <span class="op">==</span> <span class="dv">0</span>][score_col]</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    scores_test_1 <span class="op">=</span> df_test[df_test[target_col] <span class="op">==</span> <span class="dv">1</span>][score_col]</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create subplot</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>, subplot_titles<span class="op">=</span>(<span class="st">"Train Data"</span>, <span class="st">"Test Data"</span>))</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create histograms for training data</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    trace_train_0 <span class="op">=</span> go.Histogram(x<span class="op">=</span>scores_train_0, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    trace_train_1 <span class="op">=</span> go.Histogram(x<span class="op">=</span>scores_train_1, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Train </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create histograms for testing data</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    trace_test_0 <span class="op">=</span> go.Histogram(x<span class="op">=</span>scores_test_0, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 0'</span>)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    trace_test_1 <span class="op">=</span> go.Histogram(x<span class="op">=</span>scores_test_1, opacity<span class="op">=</span><span class="fl">0.75</span>, name<span class="op">=</span><span class="ss">f'Test </span><span class="sc">{</span>target_col<span class="sc">}</span><span class="ss"> = 1'</span>)</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add traces to the subplots</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_train_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_0, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace_test_1, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update layout to overlay the histograms in each subplot</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(barmode<span class="op">=</span><span class="st">'overlay'</span>, title_text<span class="op">=</span><span class="st">'Histogram of Scores'</span>)</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the figure</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>plot_score_histogram(df_train_scores, </span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>                     df_test_scores, </span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>                     score_col<span class="op">=</span><span class="st">'score'</span>, </span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>                     target_col<span class="op">=</span>target_column)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p>Method B.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_credit_scores(model, scaling_factor<span class="op">=</span><span class="va">None</span>, base_points<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set default values if not provided</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scaling_factor <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        scaling_factor <span class="op">=</span> <span class="dv">20</span> <span class="op">/</span> np.log(<span class="dv">2</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> base_points <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>        base_points <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the coefficients from the model</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    coefficients <span class="op">=</span> model.params.values</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the feature names from the model</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> model.params.index</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate odds ratios</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    odds_ratios <span class="op">=</span> np.exp(coefficients).reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the scores for each coefficient</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scaling_factor <span class="op">*</span> np.log(odds_ratios)</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> base_points <span class="op">-</span> scores</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame to store feature names and their corresponding scores</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>    feature_scores <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: selected_features, <span class="st">'Score'</span>: scores})</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the DataFrame in descending order of scores</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>    feature_scores <span class="op">=</span> feature_scores.sort_values(by<span class="op">=</span><span class="st">'Score'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_scores</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> calculate_credit_scores(model_fit_glm)</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>display(scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="model-training" class="level2">
<h2 class="anchored" data-anchor-id="model-training">Model Training</h2>
<p>Separating Features and Target Variables for Training and Test Sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> df_train.drop(target_column, axis<span class="op">=</span><span class="dv">1</span>)  </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train[target_column]  </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> df_test.drop(target_column, axis<span class="op">=</span><span class="dv">1</span>)  </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test[target_column]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"features"</span>: <span class="va">None</span>, </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"declutter"</span>: <span class="va">False</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> HeatmapFeatureCorrelations(test_context, params)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> get_numerical_columns(df_train)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"declutter"</span>: <span class="va">True</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"features"</span>: <span class="va">None</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">13</span>}</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> FeatureTargetCorrelationPlot(test_context, params)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>vm_df <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>X_train)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularDescriptionTables(test_context)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<section id="feature-statistical-significance" class="level3">
<h3 class="anchored" data-anchor-id="feature-statistical-significance">Feature Statistical Significance</h3>
<p>Train a GLM Logistic Regression Model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant to X_train for intercept term</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X_train = sm.add_constant(X_train)</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.GLM(y_train, X_train, family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>model_fit <span class="op">=</span> model.fit()</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the statistics</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_fit.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Run VM Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.statsmodels.RegressionModelsCoeffs <span class="im">import</span> RegressionModelsCoeffs</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VM test and train datasets</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>vm_train_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>vm_test_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_test,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Create VM model</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>vm_model_reg <span class="op">=</span> vm.init_model(</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_fit, </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>list_of_models <span class="op">=</span> [vm_model_reg]</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(models<span class="op">=</span>list_of_models)</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Run test</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> RegressionModelsCoeffs(test_context)</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p>Statistical Significance of Features.</p>
<p><strong>Run VM Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.statsmodels.RegressionFeatureSignificance <span class="im">import</span> RegressionFeatureSignificance</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"p_threshold"</span>: <span class="fl">0.1</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">"fontsize"</span>: <span class="dv">12</span>}</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> RegressionFeatureSignificance(test_context, params)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="feature-importance" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance">Feature Importance</h3>
<p>Build a Decision Tree model to calculate feature importance on all preliminary features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the model</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>tree_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>tree_model_fit <span class="op">=</span> tree_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.PermutationFeatureImportance <span class="im">import</span> PermutationFeatureImportance</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Create VM model</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>vm_model_pfi <span class="op">=</span> vm.init_model(</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> tree_model_fit, </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span>vm_model_pfi)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"fontsize"</span>: <span class="va">None</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">"figure_height"</span>: <span class="dv">1000</span>}</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> PermutationFeatureImportance(test_context, params)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="feature-importance-vs-significance" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance-vs-significance">Feature Importance vs Significance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.statsmodels.FeatureImportanceAndSignificance <span class="im">import</span> FeatureImportanceAndSignificance</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(models<span class="op">=</span>[vm_model_reg, vm_model_pfi])</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"fontsize"</span>: <span class="dv">12</span>,</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"p_threshold"</span>: <span class="fl">0.05</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"significant_only"</span>: <span class="va">False</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"figure_height"</span>: <span class="dv">1000</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bar_width"</span>: <span class="fl">0.4</span>}</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> FeatureImportanceAndSignificance(test_context, params)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="drop-features" class="level3">
<h3 class="anchored" data-anchor-id="drop-features">Drop Features</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>drop_features <span class="op">=</span> [<span class="st">'total_acc'</span>, <span class="st">'purpose__house'</span>, <span class="st">'purpose__medical'</span>, <span class="st">'home_ownership__OTHER'</span>, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'purpose__vacation'</span>, <span class="st">'purpose__renewable_energy'</span>, <span class="st">'grade__F'</span>, </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'purpose__major_purchase'</span>, <span class="st">'purpose__wedding'</span>, <span class="st">'purpose__home_improvement'</span>, <span class="st">'grade__G'</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'purpose__moving'</span>, <span class="st">'purpose__other'</span>, <span class="st">'verification_status__Source Verified'</span>]</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>X_train.drop(drop_features, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>X_test.drop(drop_features, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># If y_train and y_test are Series objects, convert them to DataFrame</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(y_train, pd.Series):</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y_train.to_frame()</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(y_test, pd.Series):</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y_test.to_frame()</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate X_train with y_train and X_test with y_test</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.concat([X_train, y_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> pd.concat([X_test, y_test], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="fit-glm-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-glm-model">Fit GLM Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update VM dataset</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>vm_train_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>vm_test_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_test,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                        target_column<span class="op">=</span>target_column)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Fit model</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;X_train = sm.add_constant(X_train) #BUG: need to fix model.py to support models with intercept</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.GLM(y_train, X_train, family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>model_fit_glm <span class="op">=</span> model.fit()</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_fit_glm.summary())</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add constant to the input data if necessary</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test = sm.add_constant(X_test) #BUG: fix model.py to support intercepts in regression models </span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model_fit_glm.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Compute Metric Risk Scores</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Define Metric Risk Thresholds</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Compute Metric Risk Scoring</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Create VM model</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>vm_model_glm <span class="op">=</span> vm.init_model(</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_fit_glm, </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="fit-decision-tree-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-decision-tree-model">Fit Decision Tree Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Fit Decision Tree model</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>model_fit_tree <span class="op">=</span> tree_model.fit(X_train, y_train)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Create VM model</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>vm_model_tree <span class="op">=</span> vm.init_model(</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_fit_tree, </span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation</h2>
<section id="model-performance-metrics" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-metrics">Model Performance Metrics</h3>
<p><strong>Define Model Risk Scoring Thresholds</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> risk_scoring_thresholds(metric_ranges):</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty list to store rows</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> []</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate through each metric in the dictionary</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> metric, (min_value, max_value) <span class="kw">in</span> metric_ranges.items():</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the color ranges and round the values</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>        red_range <span class="op">=</span> [<span class="bu">round</span>(min_value, <span class="dv">2</span>), <span class="bu">round</span>(min_value <span class="op">+</span> (max_value <span class="op">-</span> min_value) <span class="op">/</span> <span class="dv">3</span>, <span class="dv">2</span>)]</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>        amber_range <span class="op">=</span> [<span class="bu">round</span>(min_value <span class="op">+</span> (max_value <span class="op">-</span> min_value) <span class="op">/</span> <span class="dv">3</span>, <span class="dv">2</span>), <span class="bu">round</span>(min_value <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (max_value <span class="op">-</span> min_value) <span class="op">/</span> <span class="dv">3</span>, <span class="dv">2</span>)]</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>        green_range <span class="op">=</span> [<span class="bu">round</span>(min_value <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (max_value <span class="op">-</span> min_value) <span class="op">/</span> <span class="dv">3</span>, <span class="dv">2</span>), <span class="bu">round</span>(max_value, <span class="dv">2</span>)]</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append metric and its corresponding ranges to the rows list</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>        rows.append([metric, red_range, amber_range, green_range])</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dataframe from the rows list</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> pd.DataFrame(rows, columns<span class="op">=</span>[<span class="st">"Metric"</span>, <span class="st">"RED"</span>, <span class="st">"AMBER"</span>, <span class="st">"GREEN"</span>])</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>metric_ranges <span class="op">=</span> {</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>: [<span class="fl">0.1</span>, <span class="fl">0.9</span>],</span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ROC-AUC"</span>: [<span class="fl">0.1</span>, <span class="fl">0.9</span>],</span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision"</span>: [<span class="fl">0.1</span>, <span class="fl">0.9</span>],</span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Recall"</span>: [<span class="fl">0.1</span>, <span class="fl">0.9</span>],</span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"F1"</span>: [<span class="fl">0.1</span>, <span class="fl">0.9</span>]</span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>risk_thresholds <span class="op">=</span> risk_scoring_thresholds(metric_ranges)</span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>display(risk_thresholds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="confusion-matrix" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.ConfusionMatrix <span class="im">import</span> ConfusionMatrix</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span> vm_model_glm)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ConfusionMatrix(test_context)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="roc-auc-curve" class="level3">
<h3 class="anchored" data-anchor-id="roc-auc-curve">ROC-AUC Curve</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.ROCCurve <span class="im">import</span> ROCCurve</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span> vm_model_glm)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> ROCCurve(test_context)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.model_validation.sklearn.MinimumROCAUCScore <span class="im">import</span> MinimumROCAUCScore</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(model<span class="op">=</span> vm_model_glm)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> MinimumROCAUCScore(test_context)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="gini-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="gini-coefficients">GINI Coefficients</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gini(true, pred):</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate Gini coefficient given true and predicted labels"""</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    gini_score <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> roc_auc_score(true, pred) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gini_score</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>gini_coefficient <span class="op">=</span> gini(y_test, y_pred)</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>(<span class="ss">f"Gini Coefficient: </span><span class="sc">{</span>gini_coefficient<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="scorecard-development-1" class="level3">
<h3 class="anchored" data-anchor-id="scorecard-development-1">Scorecard Development</h3>
</section>
<section id="map-model-fit-coefficients-to-scores" class="level3">
<h3 class="anchored" data-anchor-id="map-model-fit-coefficients-to-scores">Map Model Fit Coefficients to Scores</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_scores(model, scaling_factor<span class="op">=</span><span class="va">None</span>, base_points<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set default values if not provided</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scaling_factor <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>        scaling_factor <span class="op">=</span> <span class="dv">20</span> <span class="op">/</span> np.log(<span class="dv">2</span>)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> base_points <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>        base_points <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the coefficients from the model</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    coefficients <span class="op">=</span> model.params.values</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the feature names from the model</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> model.params.index</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate odds ratios</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>    odds_ratios <span class="op">=</span> np.exp(coefficients).reshape(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the scores for each coefficient</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scaling_factor <span class="op">*</span> np.log(odds_ratios)</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> base_points <span class="op">-</span> scores</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame to store feature names and their corresponding scores</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>    feature_scores <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: selected_features, <span class="st">'Score'</span>: scores})</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the DataFrame in descending order of scores</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>    feature_scores <span class="op">=</span> feature_scores.sort_values(by<span class="op">=</span><span class="st">'Score'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_scores</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> calculate_scores(model_fit)</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>display(scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="appendix-1" class="level1">
<h1>Appendix 1</h1>
<section id="model-risk-assessment" class="level2">
<h2 class="anchored" data-anchor-id="model-risk-assessment">Model Risk Assessment</h2>
<section id="model-fit-metric-risk-scores" class="level3">
<h3 class="anchored" data-anchor-id="model-fit-metric-risk-scores"><strong>Model Fit Metric</strong> Risk Scores</h3>
<p><strong>Define Metric Risk Thresholds</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>model_fit_risk_thresholds <span class="op">=</span> {</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D-Squared"</span>: {</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.4</span>],</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.4</span>, <span class="fl">0.7</span>],</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.7</span>, <span class="fl">1.0</span>]</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ratio of Significant Features"</span>: {</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="dv">40</span>],</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="dv">40</span>, <span class="dv">70</span>],</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="dv">70</span>, <span class="dv">100</span>]</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Compute Metric Risk Scores</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_model_fit_risk_scores(model_fit_glm):</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Risk Measure 1: D Squared</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    d_squared <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (model_fit_glm.deviance <span class="op">/</span> model_fit_glm.null_deviance)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Risk Measure 2: Percentage of features with p-value less than 0.05</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>    pvalues <span class="op">=</span> model_fit_glm.pvalues</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>    significant_features <span class="op">=</span> np.<span class="bu">sum</span>(pvalues <span class="op">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    total_features <span class="op">=</span> pvalues.shape[<span class="dv">0</span>]</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>    percent_significant_features <span class="op">=</span> (significant_features <span class="op">/</span> total_features)</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create DataFrame</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Metric Risk Measure"</span>: [<span class="st">"D-Squared"</span>, <span class="st">"Ratio of Significant Features"</span>],</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Description"</span>: [</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"D-Squared: Proportion of the variability in the response variable explained by the model."</span>,</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Ratio of Significant Features: Percentage of features with a p-value less than 0.05."</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Metric Risk Score"</span>: [d_squared, percent_significant_features],</span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>    risk_scores <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round to 1 decimal place</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>    risk_scores[<span class="st">"Metric Risk Score"</span>] <span class="op">=</span> risk_scores[<span class="st">"Metric Risk Score"</span>].<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> risk_scores</span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a>model_fit_risk_scores <span class="op">=</span> regression_model_fit_risk_scores(model_fit_glm)</span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a>display(model_fit_risk_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="model-performance-metric-risk-scores" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-metric-risk-scores"><strong>Model Performance Metric</strong> Risk Scores</h3>
<p><strong>Define Metric Risk Thresholds</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>model_performance_risk_thresholds <span class="op">=</span> {</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accuracy"</span>: {</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.5</span>],</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.5</span>, <span class="fl">0.75</span>],</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.75</span>, <span class="fl">1.0</span>]</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ROC-AUC"</span>: {</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.6</span>],</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.6</span>, <span class="fl">0.85</span>],</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.85</span>, <span class="fl">1.0</span>]</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Precision"</span>: {</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.4</span>],</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.4</span>, <span class="fl">0.6</span>],</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.6</span>, <span class="fl">1.0</span>]</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Recall"</span>: {</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.4</span>],</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.4</span>, <span class="fl">0.6</span>],</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.6</span>, <span class="fl">1.0</span>]</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"F1"</span>: {</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red"</span>: [<span class="dv">0</span>, <span class="fl">0.4</span>],</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"amber"</span>: [<span class="fl">0.4</span>, <span class="fl">0.6</span>],</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"green"</span>: [<span class="fl">0.6</span>, <span class="fl">1.0</span>]</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Compute Metric Risk Scores</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, accuracy_score, precision_score, recall_score, f1_score</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_performance_risk_scores(y_true, y_pred_probs, threshold<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Threshold the probabilities to get the binary predictions</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> (y_pred_probs <span class="op">&gt;</span> threshold).astype(<span class="bu">int</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the metrics</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> accuracy_score(y_true, y_pred)</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> roc_auc_score(y_true, y_pred_probs)</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>    precision <span class="op">=</span> precision_score(y_true, y_pred)</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>    recall <span class="op">=</span> recall_score(y_true, y_pred)</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> f1_score(y_true, y_pred)</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>    metrics_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Metric Risk Measure"</span>: [<span class="st">"Accuracy"</span>, <span class="st">"ROC-AUC"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"F1"</span>],</span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Description"</span>: [</span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Proportion of the total number of predictions that were correct."</span>,</span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Aggregate measure of performance across all possible classification thresholds."</span>,</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Proportion of positive identifications that were actually correct."</span>,</span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Proportion of actual positives that were identified correctly."</span>,</span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Harmonic mean of precision and recall, it tries to find the balance between precision and recall."</span></span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Metric Risk Score"</span>: [accuracy, roc_auc, precision, recall, f1],</span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> metrics_df</span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model_fit_glm.predict(X_test)</span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a>model_performance_risk_scores <span class="op">=</span> regression_performance_risk_scores(y_test, y_pred)</span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a>display(model_performance_risk_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="model-risk-assessment-1" class="level3">
<h3 class="anchored" data-anchor-id="model-risk-assessment-1"><strong>Model Risk Assessment</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metric_risk_assessment(risk_thresholds, test_results):</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare thresholds and test_results data</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    thresholds_df <span class="op">=</span> pd.DataFrame(risk_thresholds).T.reset_index()</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    thresholds_df.columns <span class="op">=</span> [<span class="st">'Metric Risk Measure'</span>, <span class="st">'RED'</span>, <span class="st">'AMBER'</span>, <span class="st">'GREEN'</span>]</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    test_results_df <span class="op">=</span> test_results.rename(columns<span class="op">=</span>{<span class="st">"Risk Measure"</span>: <span class="st">"Metric Risk Measure"</span>, <span class="st">"Risk Score"</span>: <span class="st">"Metric Risk Score"</span>})</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a "GREY" column to the thresholds DataFrame and initialize it with "Fail"</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    thresholds_df[<span class="st">"GREY"</span>] <span class="op">=</span> <span class="st">"Fail"</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace the range values in the thresholds DataFrame with "Pass" or "Fail"</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> thresholds_df.index:</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>        metric <span class="op">=</span> thresholds_df.loc[row, <span class="st">"Metric Risk Measure"</span>]</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>        test_result <span class="op">=</span> test_results_df[test_results_df[<span class="st">"Metric Risk Measure"</span>] <span class="op">==</span> metric][<span class="st">"Metric Risk Score"</span>].values[<span class="dv">0</span>]</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>        grey_pass <span class="op">=</span> <span class="va">True</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'RED'</span>, <span class="st">'AMBER'</span>, <span class="st">'GREEN'</span>]:</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>            range_values <span class="op">=</span> thresholds_df.loc[row, col]</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>            range_start, range_end <span class="op">=</span> extract_range(range_values)</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> range_start <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> range_end <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> range_start <span class="op">&lt;=</span> test_result <span class="op">&lt;=</span> range_end:</span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>                    thresholds_df.loc[row, col] <span class="op">=</span> <span class="st">"Pass"</span></span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a>                    grey_pass <span class="op">=</span> <span class="va">False</span></span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a>                    thresholds_df.loc[row, col] <span class="op">=</span> <span class="st">"Fail"</span></span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> grey_pass:</span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a>            thresholds_df.loc[row, <span class="st">"GREY"</span>] <span class="op">=</span> <span class="st">"Pass"</span></span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Consolidate the risk levels into a single column</span></span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a>    risk_levels <span class="op">=</span> [<span class="st">'GREY'</span>, <span class="st">'RED'</span>, <span class="st">'AMBER'</span>, <span class="st">'GREEN'</span>]</span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a>    risk_scoring_table <span class="op">=</span> pd.concat([test_results_df, thresholds_df[risk_levels]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb144-33"><a href="#cb144-33" aria-hidden="true" tabindex="-1"></a>    risk_scoring_table[<span class="st">'Metric Risk Assessment'</span>] <span class="op">=</span> risk_scoring_table[risk_levels].<span class="bu">apply</span>(</span>
<span id="cb144-34"><a href="#cb144-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: <span class="bu">next</span>((level <span class="cf">for</span> level <span class="kw">in</span> risk_levels <span class="cf">if</span> x[level] <span class="op">==</span> <span class="st">"Pass"</span>), <span class="va">None</span>),</span>
<span id="cb144-35"><a href="#cb144-35" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb144-36"><a href="#cb144-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb144-37"><a href="#cb144-37" aria-hidden="true" tabindex="-1"></a>    risk_scoring_table.drop(columns<span class="op">=</span>risk_levels, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb144-38"><a href="#cb144-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-39"><a href="#cb144-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder the columns to desired order</span></span>
<span id="cb144-40"><a href="#cb144-40" aria-hidden="true" tabindex="-1"></a>    risk_scoring_table <span class="op">=</span> risk_scoring_table[[<span class="st">'Metric Risk Measure'</span>, <span class="st">'Description'</span>, <span class="st">'Metric Risk Score'</span>, <span class="st">'Metric Risk Assessment'</span>]]</span>
<span id="cb144-41"><a href="#cb144-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-42"><a href="#cb144-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> risk_scoring_table</span>
<span id="cb144-43"><a href="#cb144-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-44"><a href="#cb144-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_range(value):</span>
<span id="cb144-45"><a href="#cb144-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(value, (<span class="bu">list</span>, <span class="bu">tuple</span>)) <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb144-46"><a href="#cb144-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value[<span class="dv">0</span>], value[<span class="dv">1</span>]</span>
<span id="cb144-47"><a href="#cb144-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb144-48"><a href="#cb144-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb144-49"><a href="#cb144-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-50"><a href="#cb144-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> color_cells(val):</span>
<span id="cb144-51"><a href="#cb144-51" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {<span class="st">"GREEN"</span>: <span class="st">"green"</span>, <span class="st">"AMBER"</span>: <span class="st">"yellow"</span>, <span class="st">"RED"</span>: <span class="st">"red"</span>, <span class="st">"GREY"</span>: <span class="st">"grey"</span>}</span>
<span id="cb144-52"><a href="#cb144-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'background-color: </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> colors[val]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute risk assessments for all metrics</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>model_fit_risk_assessment <span class="op">=</span> metric_risk_assessment(model_fit_risk_thresholds, model_fit_risk_scores)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>model_performance_risk_assessment <span class="op">=</span> metric_risk_assessment(model_performance_risk_thresholds, model_performance_risk_scores)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>model_risk_assessment <span class="op">=</span> pd.concat([model_performance_risk_assessment, model_fit_risk_assessment]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>model_risk_assessment.style.applymap(color_cells, subset<span class="op">=</span>[<span class="st">'Metric Risk Assessment'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="appendix-2" class="level1">
<h1>Appendix 2</h1>
<section id="step-8-univariate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-8-univariate-analysis">Step 8: Univariate Analysis</h2>
<section id="histograms-of-numerical-features" class="level3">
<h3 class="anchored" data-anchor-id="histograms-of-numerical-features">Histograms of Numerical Features</h3>
<p><strong>Update VM Dataset and Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.TabularNumericalHistograms <span class="im">import</span> TabularNumericalHistograms</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularNumericalHistograms(test_context)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If 'df' is your DataFrame and 'column_name' is the name of the column</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>unique_values <span class="op">=</span> df[<span class="st">'inq_last_6mths'</span>].unique()</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unique_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="high-cardinality-of-categorical-features" class="level3">
<h3 class="anchored" data-anchor-id="high-cardinality-of-categorical-features">High Cardinality of Categorical Features</h3>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.HighCardinality <span class="im">import</span> HighCardinality</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> HighCardinality(test_context)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="bar-plots-of-categorical-features" class="level3">
<h3 class="anchored" data-anchor-id="bar-plots-of-categorical-features">Bar Plots of Categorical Features</h3>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.TabularCategoricalBarPlots <span class="im">import</span> TabularCategoricalBarPlots</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> TabularCategoricalBarPlots(test_context)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="default-ratios-by-categorical-feature" class="level3">
<h3 class="anchored" data-anchor-id="default-ratios-by-categorical-feature">Default Ratios by Categorical Feature</h3>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.DefaultRateBarPlots <span class="im">import</span> DefaultRatioBarPlots</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure the metric</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"default_column"</span>: target_column,</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"columns"</span>: <span class="va">None</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> DefaultRatioBarPlots(test_context, params<span class="op">=</span>params)</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-9-multivariate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-9-multivariate-analysis">Step 9: Multivariate Analysis</h2>
<section id="bivariate-bar-plots-of-default-ratios" class="level3">
<h3 class="anchored" data-anchor-id="bivariate-bar-plots-of-default-ratios">Bivariate Bar Plots of Default Ratios</h3>
<p><strong>Update VM Dataset and Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.BivariateFeaturesBarPlots <span class="im">import</span> BivariateFeaturesBarPlots</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Pass target column to validmind dataset</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train, </span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>                              target_column<span class="op">=</span>target_column)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure the metric</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>features_pairs <span class="op">=</span> {<span class="st">'home_ownership'</span>: <span class="st">'grade'</span>, </span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'purpose'</span>: <span class="st">'grade'</span>,</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'grade'</span>: <span class="st">'verification_status'</span>}</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features_pairs"</span>: features_pairs,</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> BivariateFeaturesBarPlots(test_context, params<span class="op">=</span>params)</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>metric.run()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="scatter-plots-by-default-status" class="level3">
<h3 class="anchored" data-anchor-id="scatter-plots-by-default-status">Scatter Plots by Default Status</h3>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.BivariateScatterPlots <span class="im">import</span> BivariateScatterPlots</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>features_pairs <span class="op">=</span> {<span class="st">'int_rate'</span>: <span class="st">'annual_inc'</span>, </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'funded_amnt_inv'</span>: <span class="st">'dti'</span>, </span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'annual_inc'</span>: <span class="st">'funded_amnt_inv'</span>,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'loan_amnt'</span>: <span class="st">'int_rate'</span>,</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'int_rate'</span>: <span class="st">'annual_inc'</span>,</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'earliest_cr_line'</span>: <span class="st">'int_rate'</span>}</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features_pairs"</span>: features_pairs,</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"target_filter"</span>: <span class="va">None</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> BivariateScatterPlots(test_context, params<span class="op">=</span>params)</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>metric.run()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="bivariate-histograms" class="level3">
<h3 class="anchored" data-anchor-id="bivariate-histograms">Bivariate Histograms</h3>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.BivariateHistograms <span class="im">import</span> BivariateHistograms</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>features_pairs <span class="op">=</span> {<span class="st">'int_rate'</span>: <span class="st">'annual_inc'</span>, </span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'funded_amnt_inv'</span>: <span class="st">'dti'</span>, </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'annual_inc'</span>: <span class="st">'funded_amnt_inv'</span>,</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'loan_amnt'</span>: <span class="st">'int_rate'</span>,</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'int_rate'</span>: <span class="st">'annual_inc'</span>,</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'earliest_cr_line'</span>: <span class="st">'int_rate'</span>}</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features_pairs"</span>: features_pairs,</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"target_filter"</span>: <span class="va">None</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> BivariateHistograms(test_context, params<span class="op">=</span>params)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>metric.run()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.PearsonCorrelationMatrix <span class="im">import</span> PearsonCorrelationMatrix</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> PearsonCorrelationMatrix(test_context)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
<section id="step-10-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="step-10-feature-engineering">Step 10: Feature Engineering</h2>
<section id="add-dummy-catergorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="add-dummy-catergorical-variables">Add Dummy Catergorical Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_dummy_variables(df, columns_list):</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate dummy variables for specified columns in the DataFrame,</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co">    concatenate them with the original DataFrame.</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co">    df (pandas.DataFrame): DataFrame to be processed.</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="co">    columns_list (list): List of column names to be processed.</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> columns_list:</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>        dummies <span class="op">=</span> pd.get_dummies(df[column], prefix<span class="op">=</span>column <span class="op">+</span> <span class="st">":"</span>, drop_first<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.concat([df, dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_train = add_dummy_variables(df_train, ['grade', 'home_ownership', 'verification_status', 'purpose'])</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df_test = add_dummy_variables(df_test, ['grade', 'home_ownership', 'verification_status', 'purpose'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the X_test DataFrame to match the column structure of the X_train DataFrame</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df_test = df_test.reindex(labels=df_train.columns, axis=1, fill_value=0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
<section id="weight-of-evidence-woe-binning" class="level3">
<h3 class="anchored" data-anchor-id="weight-of-evidence-woe-binning">Weight of Evidence (WoE) Binning</h3>
<p>From a modelling perspective, the <strong>WoE</strong> allows us to transform raw variables into a format which provides a more robust base for statistical analysis. Specifically, the WoE measures the predictive power of an individual class of a categorical variable, distinguishing between ‘good’ (non-defaulters) and ‘bad’ (defaulters) risks. This is accomplished by comparing the distribution of ‘good’ and ‘bad’ risks within a specific category to the overall ‘good’/‘bad’ distribution. If the ‘good’/‘bad’ ratio of a particular category is significantly divergent from the overall ratio, it suggests that category is a strong predictor of credit risk.</p>
<p><strong>Information Value (IV)</strong>, on the other hand, is a fundamental metric we use to quantify the predictive power of each input variable in our scorecards. The IV is calculated by taking the sum of the differences between the WoE of each category and the overall WoE, multiplied by the WoE of that category. In other words, IV measures the total amount of ‘information’ or predictive power a variable brings to the model. For example, variables with an IV between 0.1 and 0.3 provide a weak predictive power, those between 0.3 and 0.5 a medium predictive power, and those with an IV greater than 0.5 have strong predictive power. Therefore, we utilize the IV to prioritize variables for inclusion in the model and to ensure the model’s stability and accuracy.</p>
<section id="woe-and-iv-for-categorical-variables" class="level4">
<h4 class="anchored" data-anchor-id="woe-and-iv-for-categorical-variables">WoE and IV for Categorical Variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">#categorical_woe_iv_df = calculate_woe_iv(df_train, target_column, categorical_features)</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co">#display(categorical_woe_iv_df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p><strong>Update VM Dataset and Run Test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> validmind.tests.data_validation.WOEIVPlots <span class="im">import</span> WoEandIVPlots</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Update vm dataset and test context</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>vm_df_train <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>df_train, </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>                              target_column<span class="op">=</span>target_column)</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>test_context <span class="op">=</span> TestContext(dataset<span class="op">=</span>vm_df_train)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Configure test parameters</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"features"</span>: categorical_features,</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"label_rotation"</span>: <span class="dv">90</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;Run test</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> WoEandIVPlots(test_context, params<span class="op">=</span>params)</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>metric.run()</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>metric.result.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="step-11-model-training" class="level2">
<h2 class="anchored" data-anchor-id="step-11-model-training">Step 11: Model Training</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we define the preprocessing steps</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> [<span class="st">'pub_rec'</span>, <span class="st">'revol_util'</span>, <span class="st">'funded_amnt_inv'</span>, <span class="st">'int_rate'</span>, <span class="st">'dti'</span>, <span class="st">'annual_inc'</span>, <span class="st">'loan_amnt'</span>, <span class="st">'earliest_cr_line'</span>]</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'term'</span>, <span class="st">'grade'</span>, <span class="st">'purpose'</span>, <span class="st">'annual_inc_range'</span>, <span class="st">'loan_amnt_range'</span>]</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>numeric_transformer <span class="op">=</span> StandardScaler()</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'num'</span>, numeric_transformer, numeric_features),</span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cat'</span>, categorical_transformer, categorical_features)])</span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Append classifier to preprocessing pipeline.</span></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have a full prediction pipeline.</span></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'classifier'</span>, LogisticRegression(solver<span class="op">=</span><span class="st">'lbfgs'</span>, max_iter<span class="op">=</span><span class="dv">1000</span>))])</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>clf.fit(X_train, y_train)</span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now evaluate on the test set</span></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"model score: </span><span class="sc">%.3f</span><span class="st">"</span> <span class="op">%</span> clf.score(X_test, y_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we define the preprocessing steps</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> [<span class="st">'pub_rec'</span>, <span class="st">'revol_util'</span>, <span class="st">'funded_amnt_inv'</span>, <span class="st">'int_rate'</span>, <span class="st">'dti'</span>, <span class="st">'annual_inc'</span>, <span class="st">'loan_amnt'</span>, <span class="st">'earliest_cr_line'</span>]</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'term'</span>, <span class="st">'grade'</span>, <span class="st">'purpose'</span>, <span class="st">'annual_inc_range'</span>, <span class="st">'loan_amnt_range'</span>, <span class="st">'installment'</span>]  <span class="co"># Added 'installment'</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle categorical features</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>df_encoded <span class="op">=</span> pd.get_dummies(df_multivariate, columns<span class="op">=</span>categorical_features)</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_encoded.drop(<span class="st">'loan_status'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_encoded[<span class="st">'loan_status'</span>]</span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent values</span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> sm.add_constant(X_train)</span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model</span></span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a>glm_model_fit <span class="op">=</span> sm.GLM(y_train, X_train, family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> glm_model_fit.fit()</span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary</span></span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on the test set</span></span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> sm.add_constant(X_test)  <span class="co"># Adding a constant to the test data</span></span>
<span id="cb180-32"><a href="#cb180-32" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> results.predict(X_test)</span>
<span id="cb180-33"><a href="#cb180-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-34"><a href="#cb180-34" aria-hidden="true" tabindex="-1"></a><span class="co"># You can then further analyze y_pred to measure model performance on the test set.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p>Scale variable X.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> scale</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale your variables</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scale(X)</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent values</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> sm.add_constant(X_scaled)</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.GLM(y, X_scaled, family<span class="op">=</span>sm.families.Binomial())</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary</span></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>
<p>####&nbsp;ValidMind Models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize training and testing datasets for model A</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>vm_train_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>X_train, <span class="bu">type</span><span class="op">=</span><span class="st">"generic"</span>, target_column<span class="op">=</span><span class="st">'loan_status'</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>vm_test_ds <span class="op">=</span> vm.init_dataset(dataset<span class="op">=</span>X_test, <span class="bu">type</span><span class="op">=</span><span class="st">"generic"</span>, target_column<span class="op">=</span><span class="st">'loan_status'</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize model A</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>vm_model_A <span class="op">=</span> vm.init_model(</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> glm_model_fit, </span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    train_ds<span class="op">=</span>vm_train_ds, </span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    test_ds<span class="op">=</span>vm_test_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>: </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><em>© Copyright 2023 ValidMind Inc All Rights Reserved.</em></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://validmind.com/privacy-policy/">Privacy Policy</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://validmind.com/terms-of-use/">Terms of Use</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/validmind/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>